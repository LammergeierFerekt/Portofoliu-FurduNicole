var ng=Object.defineProperty;var pu=d=>{throw TypeError(d)};var rg=(d,t,e)=>t in d?ng(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var O=(d,t,e)=>rg(d,typeof t!="symbol"?t+"":t,e),gc=(d,t,e)=>t.has(d)||pu("Cannot "+e);var r=(d,t,e)=>(gc(d,t,"read from private field"),e?e.call(d):t.get(d)),y=(d,t,e)=>t.has(d)?pu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,e),g=(d,t,e,s)=>(gc(d,t,"write to private field"),s?s.call(d,e):t.set(d,e),e),w=(d,t,e)=>(gc(d,t,"access private method"),e);var se=(d,t,e,s)=>({set _(i){g(d,t,i,e)},get _(){return r(d,t,s)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();var po={};po.d=(d,t)=>{for(var e in t)po.o(t,e)&&!po.o(d,e)&&Object.defineProperty(d,e,{enumerable:!0,get:t[e]})};po.o=(d,t)=>Object.prototype.hasOwnProperty.call(d,t);var W=globalThis.pdfjsLib={};po.d(W,{AbortException:()=>en,AnnotationEditorLayer:()=>Od,AnnotationEditorParamsType:()=>Z,AnnotationEditorType:()=>j,AnnotationEditorUIManager:()=>wr,AnnotationLayer:()=>ud,AnnotationMode:()=>yi,AnnotationType:()=>xt,ColorPicker:()=>Bl,DOMSVGFactory:()=>Nl,DrawLayer:()=>$d,FeatureTest:()=>Xt,GlobalWorkerOptions:()=>li,ImageKind:()=>el,InvalidPDFException:()=>Cc,MathClamp:()=>he,OPS:()=>Ll,OutputScale:()=>pi,PDFDataRangeTransport:()=>Xf,PDFDateString:()=>Kd,PDFWorker:()=>Nr,PasswordResponses:()=>hg,PermissionFlag:()=>og,PixelsPerInch:()=>sn,RenderingCancelledException:()=>Xd,ResponseException:()=>kl,SignatureExtractor:()=>ci,SupportedImageMimeTypes:()=>Tc,TextLayer:()=>go,TouchManager:()=>Fl,Util:()=>B,VerbosityLevel:()=>hc,XfaLayer:()=>Kf,build:()=>Im,createValidAbsoluteUrl:()=>ug,fetchData:()=>Gh,getDocument:()=>wm,getFilenameFromUrl:()=>vg,getPdfFilenameFromUrl:()=>Sg,getUuid:()=>qu,getXfaPageViewport:()=>_g,isDataScheme:()=>dc,isPdfFile:()=>Yd,isValidExplicitDest:()=>_m,noContextMenu:()=>rs,normalizeUnicode:()=>yg,setLayerDimensions:()=>yr,shadow:()=>Q,stopEvent:()=>Et,version:()=>Rm});const Ut=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Vu=[1,0,0,1,0,0],Ec=[.001,0,0,.001,0,0],mc=1.35,Me={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},yi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ag="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},Z={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},og={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Kt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},el={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},xt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Er={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},hc={ERRORS:0,WARNINGS:1,INFOS:5},Ll={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},qh={moveTo:0,lineTo:1,curveTo:2,closePath:3},hg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let lc=hc.WARNINGS;function lg(d){Number.isInteger(d)&&(lc=d)}function cg(){return lc}function cc(d){lc>=hc.INFOS&&console.log(`Info: ${d}`)}function q(d){lc>=hc.WARNINGS&&console.log(`Warning: ${d}`)}function at(d){throw new Error(d)}function Ct(d,t){d||at(t)}function dg(d){switch(d==null?void 0:d.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function ug(d,t=null,e=null){if(!d)return null;if(e&&typeof d=="string"){if(e.addDefaultProtocol&&d.startsWith("www.")){const i=d.match(/\./g);(i==null?void 0:i.length)>=2&&(d=`http://${d}`)}if(e.tryConvertEncoding)try{d=bg(d)}catch{}}const s=t?URL.parse(d,t):URL.parse(d);return dg(s)?s:null}function Q(d,t,e,s=!1){return Object.defineProperty(d,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const vr=function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t}();class gu extends vr{constructor(t,e){super(t,"PasswordException"),this.code=e}}class bc extends vr{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Cc extends vr{constructor(t){super(t,"InvalidPDFException")}}class kl extends vr{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class fg extends vr{constructor(t){super(t,"FormatError")}}class en extends vr{constructor(t){super(t,"AbortException")}}function ju(d){(typeof d!="object"||(d==null?void 0:d.length)===void 0)&&at("Invalid argument for bytesToString");const t=d.length,e=8192;if(t<e)return String.fromCharCode.apply(null,d);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),a=d.subarray(i,n);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function $h(d){typeof d!="string"&&at("Invalid argument for stringToBytes");const t=d.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=d.charCodeAt(s)&255;return e}function pg(d){return String.fromCharCode(d>>24&255,d>>16&255,d>>8&255,d&255)}function jd(d){const t=Object.create(null);for(const[e,s]of d)t[e]=s;return t}function gg(){const d=new Uint8Array(4);return d[0]=1,new Uint32Array(d.buffer,0,1)[0]===1}function mg(){try{return new Function(""),!0}catch{return!1}}class Xt{static get isLittleEndian(){return Q(this,"isLittleEndian",gg())}static get isEvalSupported(){return Q(this,"isEvalSupported",mg())}static get isOffscreenCanvasSupported(){return Q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Q(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){if(typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"){const{platform:t,userAgent:e}=navigator;return Q(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}return Q(this,"platform",{isAndroid:!1,isLinux:!1,isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return Q(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const yc=Array.from(Array(256).keys(),d=>d.toString(16).padStart(2,"0"));var ui,sl,Pc;class B{static makeHexColor(t,e,s){return`#${yc[t]}${yc[e]}${yc[s]}`}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[s,i]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[i,n]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),n=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],n[0],a[0]),Math.min(s[1],i[1],n[1],a[1]),Math.max(s[0],i[0],n[0],a[0]),Math.max(s[1],i[1],n[1],a[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],o=(s+a)/2,h=Math.sqrt((s+a)**2-4*(s*a-n*i))/2,l=o+h||1,c=o-h||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[s,n,i,a]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static bezierBoundingBox(t,e,s,i,n,a,o,h,l){l[0]=Math.min(l[0],t,o),l[1]=Math.min(l[1],e,h),l[2]=Math.max(l[2],t,o),l[3]=Math.max(l[3],e,h),w(this,ui,Pc).call(this,t,s,n,o,e,i,a,h,3*(-t+3*(s-n)+o),6*(t-2*s+n),3*(s-t),l),w(this,ui,Pc).call(this,t,s,n,o,e,i,a,h,3*(-e+3*(i-a)+h),6*(e-2*i+a),3*(i-e),l)}}ui=new WeakSet,sl=function(t,e,s,i,n,a,o,h,l,c){if(l<=0||l>=1)return;const f=1-l,p=l*l,b=p*l,S=f*(f*(f*t+3*l*e)+3*p*s)+b*i,A=f*(f*(f*n+3*l*a)+3*p*o)+b*h;c[0]=Math.min(c[0],S),c[1]=Math.min(c[1],A),c[2]=Math.max(c[2],S),c[3]=Math.max(c[3],A)},Pc=function(t,e,s,i,n,a,o,h,l,c,f,p){if(Math.abs(l)<1e-12){Math.abs(c)>=1e-12&&w(this,ui,sl).call(this,t,e,s,i,n,a,o,h,-f/c,p);return}const b=c**2-4*f*l;if(b<0)return;const S=Math.sqrt(b),A=2*l;w(this,ui,sl).call(this,t,e,s,i,n,a,o,h,(-c+S)/A,p),w(this,ui,sl).call(this,t,e,s,i,n,a,o,h,(-c-S)/A,p)},y(B,ui);function bg(d){return decodeURIComponent(escape(d))}let wc=null,mu=null;function yg(d){return wc||(wc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,mu=new Map([["ﬅ","ſt"]])),d.replaceAll(wc,(t,e,s)=>e?e.normalize("NFKC"):mu.get(s))}function qu(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const d=new Uint8Array(32);return crypto.getRandomValues(d),ju(d)}const qd="pdfjs_internal_id_";function wg(d,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!d(s)&&!Number.isInteger(s)||!t(i))return!1;const a=n.length;let o=!0;switch(i.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const h of n)if(!(typeof h=="number"||o&&h===null))return!1;return!0}function he(d,t,e){return Math.min(Math.max(d,t),e)}function Xu(d){return Uint8Array.prototype.toBase64?d.toBase64():btoa(ju(d))}function Ag(d){return Uint8Array.fromBase64?Uint8Array.fromBase64(d):$h(atob(d))}typeof Promise.try!="function"&&(Promise.try=function(d,...t){return new Promise(e=>{e(d(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(d){return d.reduce((t,e)=>t+e,0)});const Ms="http://www.w3.org/2000/svg",cn=class cn{};O(cn,"CSS",96),O(cn,"PDF",72),O(cn,"PDF_TO_CSS_UNITS",cn.CSS/cn.PDF);let sn=cn;async function Gh(d,t="text"){if(Cr(d,document.baseURI)){const e=await fetch(d);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",d,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class zh{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=a,s*=e;const h=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,f,p,b;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,f=0,p=0,b=1;break;case 90:c=0,f=1,p=1,b=0;break;case 270:c=0,f=-1,p=-1,b=0;break;case 0:c=1,f=0,p=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,b=-b);let S,A,x,C;c===0?(S=Math.abs(l-t[1])*s+n,A=Math.abs(h-t[0])*s+a,x=(t[3]-t[1])*s,C=(t[2]-t[0])*s):(S=Math.abs(h-t[0])*s+n,A=Math.abs(l-t[1])*s+a,x=(t[2]-t[0])*s,C=(t[3]-t[1])*s),this.transform=[c*s,f*s,p*s,b*s,S-c*s*h-p*s*l,A-f*s*h-b*s*l],this.width=x,this.height=C}get rawDims(){const t=this.viewBox;return Q(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new zh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){return B.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=B.applyTransform([t[0],t[1]],this.transform),s=B.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return B.applyInverseTransform([t,e],this.transform)}}class Xd extends vr{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function dc(d){const t=d.length;let e=0;for(;e<t&&d[e].trim()==="";)e++;return d.substring(e,e+5).toLowerCase()==="data:"}function Yd(d){return typeof d=="string"&&/\.pdf$/i.test(d)}function vg(d){return[d]=d.split(/[#?]/,1),d.substring(d.lastIndexOf("/")+1)}function Sg(d,t="document.pdf"){if(typeof d!="string")return t;if(dc(d))return q('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(d);let n=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=s.exec(decodeURIComponent(n))[0]}catch{}return n||t}class bu{constructor(){O(this,"started",Object.create(null));O(this,"times",[])}time(t){t in this.started&&q(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||q(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function Cr(d,t){const e=t?URL.parse(d,t):URL.parse(d);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function rs(d){d.preventDefault()}function Et(d){d.preventDefault(),d.stopPropagation()}var bo;class Kd{static toDateObject(t){if(!t||typeof t!="string")return null;r(this,bo)||g(this,bo,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=r(this,bo).exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let h=parseInt(e[6],10);h=h>=0&&h<=59?h:0;const l=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let f=parseInt(e[9],10)||0;return f=f>=0&&f<=59?f:0,l==="-"?(a+=c,o+=f):l==="+"&&(a-=c,o-=f),new Date(Date.UTC(s,i,n,a,o,h))}}bo=new WeakMap,y(Kd,bo);function _g(d,{scale:t=1,rotation:e=0}){const{width:s,height:i}=d.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new zh({viewBox:n,userUnit:1,scale:t,rotation:e})}function Qd(d){if(d.startsWith("#")){const t=parseInt(d.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return d.startsWith("rgb(")?d.slice(4,-1).split(",").map(t=>parseInt(t)):d.startsWith("rgba(")?d.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(q(`Not a valid color format: "${d}"`),[0,0,0])}function xg(d){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of d.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;d.set(e,Qd(s))}t.remove()}function ut(d){const{a:t,b:e,c:s,d:i,e:n,f:a}=d.getTransform();return[t,e,s,i,n,a]}function hs(d){const{a:t,b:e,c:s,d:i,e:n,f:a}=d.getTransform().invertSelf();return[t,e,s,i,n,a]}function yr(d,t,e=!1,s=!0){if(t instanceof zh){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:a}=d,o=Xt.isCSSRoundSupported,h=`var(--total-scale-factor) * ${i}px`,l=`var(--total-scale-factor) * ${n}px`,c=o?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,f=o?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;!e||t.rotation%180===0?(a.width=c,a.height=f):(a.width=f,a.height=c)}s&&d.setAttribute("data-main-rotation",t.rotation)}class pi{constructor(){const{pixelRatio:t}=pi;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i){let n=1/0,a=1/0,o=1/0;s>0&&(n=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,o=i/e);const h=Math.min(n,a,o);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}}const Tc=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var wi,un,Fe,Ai,yo,Or,wo,Wl,Yu,qt,Ku,Qu,Ya,Zu,il;const Ds=class Ds{constructor(t){y(this,qt);y(this,wi,null);y(this,un,null);y(this,Fe);y(this,Ai,null);y(this,yo,null);y(this,Or,null);g(this,Fe,t),r(Ds,wo)||g(Ds,wo,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=g(this,wi,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=r(this,Fe)._uiManager._signal;t.addEventListener("contextmenu",rs,{signal:e}),t.addEventListener("pointerdown",w(Ds,Wl,Yu),{signal:e});const s=g(this,Ai,document.createElement("div"));s.className="buttons",t.append(s);const i=r(this,Fe).toolbarPosition;if(i){const{style:n}=t,a=r(this,Fe)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return w(this,qt,Zu).call(this),t}get div(){return r(this,wi)}hide(){var t;r(this,wi).classList.add("hidden"),(t=r(this,un))==null||t.hideDropdown()}show(){var t;r(this,wi).classList.remove("hidden"),(t=r(this,yo))==null||t.shown()}async addAltText(t){const e=await t.render();w(this,qt,Ya).call(this,e),r(this,Ai).prepend(e,r(this,qt,il)),g(this,yo,t)}addColorPicker(t){g(this,un,t);const e=t.renderButton();w(this,qt,Ya).call(this,e),r(this,Ai).prepend(e,r(this,qt,il))}async addEditSignatureButton(t){const e=g(this,Or,await t.renderEditButton(r(this,Fe)));w(this,qt,Ya).call(this,e),r(this,Ai).prepend(e,r(this,qt,il))}updateEditSignatureButton(t){r(this,Or)&&(r(this,Or).title=t)}remove(){var t;r(this,wi).remove(),(t=r(this,un))==null||t.destroy(),g(this,un,null)}};wi=new WeakMap,un=new WeakMap,Fe=new WeakMap,Ai=new WeakMap,yo=new WeakMap,Or=new WeakMap,wo=new WeakMap,Wl=new WeakSet,Yu=function(t){t.stopPropagation()},qt=new WeakSet,Ku=function(t){r(this,Fe)._focusEventsAllowed=!1,Et(t)},Qu=function(t){r(this,Fe)._focusEventsAllowed=!0,Et(t)},Ya=function(t){const e=r(this,Fe)._uiManager._signal;t.addEventListener("focusin",w(this,qt,Ku).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",w(this,qt,Qu).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",rs,{signal:e})},Zu=function(){const{editorType:t,_uiManager:e}=r(this,Fe),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",r(Ds,wo)[t]),w(this,qt,Ya).call(this,s),s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),r(this,Ai).append(s)},il=function(){const t=document.createElement("div");return t.className="divider",t},y(Ds,Wl),y(Ds,wo,null);let Rc=Ds;var Ao,fn,pn,nn,Ju,tf,ef;class Eg{constructor(t){y(this,nn);y(this,Ao,null);y(this,fn,null);y(this,pn);g(this,pn,t)}show(t,e,s){const[i,n]=w(this,nn,tf).call(this,e,s),{style:a}=r(this,fn)||g(this,fn,w(this,nn,Ju).call(this));t.append(r(this,fn)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){r(this,fn).remove()}}Ao=new WeakMap,fn=new WeakMap,pn=new WeakMap,nn=new WeakSet,Ju=function(){const t=g(this,fn,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",rs,{signal:r(this,pn)._signal});const e=g(this,Ao,document.createElement("div"));return e.className="buttons",t.append(e),w(this,nn,ef).call(this),t},tf=function(t,e){let s=0,i=0;for(const n of t){const a=n.y+n.height;if(a<s)continue;const o=n.x+(e?n.width:0);if(a>s){i=o,s=a;continue}e?o>i&&(i=o):o<i&&(i=o)}return[e?1-i:i,s]},ef=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=r(this,pn)._signal;t.addEventListener("contextmenu",rs,{signal:s}),t.addEventListener("click",()=>{r(this,pn).highlightSelection("floating_button")},{signal:s}),r(this,Ao).append(t)};function Zd(d,t,e){for(const s of e)t.addEventListener(s,d[s].bind(d))}var Ul;class Cg{constructor(){y(this,Ul,0)}get id(){return`${ag}${se(this,Ul)._++}`}}Ul=new WeakMap;var Br,vo,Zt,Hr,nl;const hu=class hu{constructor(){y(this,Hr);y(this,Br,qu());y(this,vo,0);y(this,Zt,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return Q(this,"_isSVGFittingCanvas",n)}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return w(this,Hr,nl).call(this,`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return w(this,Hr,nl).call(this,t,t)}async getFromBlob(t,e){const s=await e;return w(this,Hr,nl).call(this,t,s)}async getFromId(t){r(this,Zt)||g(this,Zt,new Map);const e=r(this,Zt).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){r(this,Zt)||g(this,Zt,new Map);let s=r(this,Zt).get(t);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${r(this,Br)}_${se(this,vo)._++}`,refCounter:1,isSvg:!1},r(this,Zt).set(t,s),r(this,Zt).set(s.id,s),s}getSvgUrl(t){const e=r(this,Zt).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var i;r(this,Zt)||g(this,Zt,new Map);const e=r(this,Zt).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),e.bitmap=null}isValidId(t){return t.startsWith(`image_${r(this,Br)}_`)}};Br=new WeakMap,vo=new WeakMap,Zt=new WeakMap,Hr=new WeakSet,nl=async function(t,e){r(this,Zt)||g(this,Zt,new Map);let s=r(this,Zt).get(t);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${r(this,Br)}_${se(this,vo)._++}`,refCounter:0,isSvg:!1});let i;if(typeof e=="string"?(s.url=e,i=await Gh(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=hu._isSVGFittingCanvas,a=new FileReader,o=new Image,h=new Promise((l,c)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,l()},a.onload=async()=>{const f=s.svgUrl=a.result;o.src=await n?`${f}#svgView(preserveAspectRatio(none))`:f},o.onerror=a.onerror=c});a.readAsDataURL(i),await h}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){q(i),s=null}return r(this,Zt).set(t,s),s&&r(this,Zt).set(s.id,s),s};let Ic=hu;var wt,vi,So,gt;class Pg{constructor(t=128){y(this,wt,[]);y(this,vi,!1);y(this,So);y(this,gt,-1);g(this,So,t)}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&t(),r(this,vi))return;const h={cmd:t,undo:e,post:s,type:n};if(r(this,gt)===-1){r(this,wt).length>0&&(r(this,wt).length=0),g(this,gt,0),r(this,wt).push(h);return}if(a&&r(this,wt)[r(this,gt)].type===n){o&&(h.undo=r(this,wt)[r(this,gt)].undo),r(this,wt)[r(this,gt)]=h;return}const l=r(this,gt)+1;l===r(this,So)?r(this,wt).splice(0,1):(g(this,gt,l),l<r(this,wt).length&&r(this,wt).splice(l)),r(this,wt).push(h)}undo(){if(r(this,gt)===-1)return;g(this,vi,!0);const{undo:t,post:e}=r(this,wt)[r(this,gt)];t(),e==null||e(),g(this,vi,!1),g(this,gt,r(this,gt)-1)}redo(){if(r(this,gt)<r(this,wt).length-1){g(this,gt,r(this,gt)+1),g(this,vi,!0);const{cmd:t,post:e}=r(this,wt)[r(this,gt)];t(),e==null||e(),g(this,vi,!1)}}hasSomethingToUndo(){return r(this,gt)!==-1}hasSomethingToRedo(){return r(this,gt)<r(this,wt).length-1}cleanType(t){if(r(this,gt)!==-1){for(let e=r(this,gt);e>=0;e--)if(r(this,wt)[e].type!==t){r(this,wt).splice(e+1,r(this,gt)-e),g(this,gt,e);return}r(this,wt).length=0,g(this,gt,-1)}}destroy(){g(this,wt,null)}}wt=new WeakMap,vi=new WeakMap,So=new WeakMap,gt=new WeakMap;var Vl,sf;class Wh{constructor(t){y(this,Vl);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Xt.platform;for(const[s,i,n={}]of t)for(const a of s){const o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(w(this,Vl,sf).call(this,e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:a=[],checker:o=null}}=s;o&&!o(t,e)||(i.bind(t,...a,e)(),n||Et(e))}}Vl=new WeakSet,sf=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const jl=class jl{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return xg(t),Q(this,"_colors",t)}convert(t){const e=Qd(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,a)=>n===e[a]))return jl._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?B.makeHexColor(...e):t}};O(jl,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Mc=jl;var $r,ye,It,$t,Gr,Ns,zr,Ne,Si,gn,Wr,mn,ds,je,bn,_o,xo,Ur,Eo,us,_i,Vr,xi,fs,ql,Ei,Co,Ci,yn,wn,Pi,Po,kt,it,Os,Ti,An,To,Ro,Ri,ps,Bs,Io,Oe,L,rl,Lc,nf,rf,al,af,of,hf,kc,lf,Dc,Fc,cf,ie,Ls,df,uf,Nc,ff,Ka,Oc;const kr=class kr{constructor(t,e,s,i,n,a,o,h,l,c,f,p,b,S){y(this,L);y(this,$r,new AbortController);y(this,ye,null);y(this,It,new Map);y(this,$t,new Map);y(this,Gr,null);y(this,Ns,null);y(this,zr,null);y(this,Ne,new Pg);y(this,Si,null);y(this,gn,null);y(this,Wr,0);y(this,mn,new Set);y(this,ds,null);y(this,je,null);y(this,bn,new Set);O(this,"_editorUndoBar",null);y(this,_o,!1);y(this,xo,!1);y(this,Ur,!1);y(this,Eo,null);y(this,us,null);y(this,_i,null);y(this,Vr,null);y(this,xi,!1);y(this,fs,null);y(this,ql,new Cg);y(this,Ei,!1);y(this,Co,!1);y(this,Ci,null);y(this,yn,null);y(this,wn,null);y(this,Pi,null);y(this,Po,null);y(this,kt,j.NONE);y(this,it,new Set);y(this,Os,null);y(this,Ti,null);y(this,An,null);y(this,To,null);y(this,Ro,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,Ri,[0,0]);y(this,ps,null);y(this,Bs,null);y(this,Io,null);y(this,Oe,null);const A=this._signal=r(this,$r).signal;g(this,Bs,t),g(this,Io,e),g(this,Gr,s),g(this,Ti,i),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:A}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:A}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:A}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:A}),n._on("setpreference",this.onSetPreference.bind(this),{signal:A}),n._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:A}),w(this,L,af).call(this),w(this,L,cf).call(this),w(this,L,kc).call(this),g(this,Ns,a.annotationStorage),g(this,Eo,a.filterFactory),g(this,An,o),g(this,Vr,h||null),g(this,_o,l),g(this,xo,c),g(this,Ur,f),g(this,Po,p||null),this.viewParameters={realScale:sn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=b||null,this._supportsPinchToZoom=S!==!1}static get _keyboardManager(){const t=kr.prototype,e=a=>r(a,Bs).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:h}=o;return h!=="text"&&h!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return Q(this,"_keyboardManager",new Wh([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Bs).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Bs).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}destroy(){var t,e,s,i,n,a,o,h;(t=r(this,Oe))==null||t.resolve(),g(this,Oe,null),(e=r(this,$r))==null||e.abort(),g(this,$r,null),this._signal=null;for(const l of r(this,$t).values())l.destroy();r(this,$t).clear(),r(this,It).clear(),r(this,bn).clear(),(s=r(this,Pi))==null||s.clear(),g(this,ye,null),r(this,it).clear(),r(this,Ne).destroy(),(i=r(this,Gr))==null||i.destroy(),(n=r(this,Ti))==null||n.destroy(),(a=r(this,fs))==null||a.hide(),g(this,fs,null),(o=r(this,wn))==null||o.destroy(),g(this,wn,null),r(this,us)&&(clearTimeout(r(this,us)),g(this,us,null)),r(this,ps)&&(clearTimeout(r(this,ps)),g(this,ps,null)),(h=this._editorUndoBar)==null||h.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return r(this,Po)}get useNewAltTextFlow(){return r(this,xo)}get useNewAltTextWhenAddingImage(){return r(this,Ur)}get hcmFilter(){return Q(this,"hcmFilter",r(this,An)?r(this,Eo).addHCMFilter(r(this,An).foreground,r(this,An).background):"none")}get direction(){return Q(this,"direction",getComputedStyle(r(this,Bs)).direction)}get highlightColors(){return Q(this,"highlightColors",r(this,Vr)?new Map(r(this,Vr).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return Q(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,gn,t)}setMainHighlightColorPicker(t){g(this,wn,t)}editAltText(t,e=!1){var s;(s=r(this,Gr))==null||s.editAltText(this,t,e)}getSignature(t){var e;(e=r(this,Ti))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return r(this,Ti)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":g(this,Ur,e);break}}onPageChanging({pageNumber:t}){g(this,Wr,t-1)}focusMainContainer(){r(this,Bs).focus()}findParent(t,e){for(const s of r(this,$t).values()){const{x:i,y:n,width:a,height:o}=s.div.getBoundingClientRect();if(t>=i&&t<=i+a&&e>=n&&e<=n+o)return s}return null}disableUserSelect(t=!1){r(this,Io).classList.toggle("noUserSelect",t)}addShouldRescale(t){r(this,bn).add(t)}removeShouldRescale(t){r(this,bn).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*sn.PDF_TO_CSS_UNITS;for(const s of r(this,bn))s.onScaleChanging();(e=r(this,gn))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a}=e,o=e.toString(),l=w(this,L,rl).call(this,e).closest(".textLayer"),c=this.getSelectionBoxes(l);if(!c)return;e.empty();const f=w(this,L,Lc).call(this,l),p=r(this,kt)===j.NONE,b=()=>{f==null||f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:c,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(j.HIGHLIGHT,b);return}b()}addToAnnotationStorage(t){!t.isEmpty()&&r(this,Ns)&&!r(this,Ns).has(t.id)&&r(this,Ns).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,r(this,xi)&&(g(this,xi,!1),w(this,L,al).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of r(this,it))if(e.div.contains(t)){g(this,yn,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!r(this,yn))return;const[t,e]=r(this,yn);g(this,yn,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){w(this,L,kc).call(this),w(this,L,Dc).call(this)}removeEditListeners(){w(this,L,lf).call(this),w(this,L,Fc).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of r(this,je))if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of r(this,je))if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var s;if(t.preventDefault(),(s=r(this,ye))==null||s.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of r(this,it)){const n=i.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const a of r(this,je))if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){q(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const h of s){const l=await i.deserialize(h);if(!l)return;n.push(l)}const a=()=>{for(const h of n)w(this,L,Nc).call(this,h);w(this,L,Oc).call(this,n)},o=()=>{for(const h of n)h.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){q(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),r(this,kt)!==j.NONE&&!this.isEditorHandlingKeyboard&&kr._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,r(this,xi)&&(g(this,xi,!1),w(this,L,al).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(w(this,L,of).call(this),w(this,L,Dc).call(this),w(this,L,ie).call(this,{isEditing:r(this,kt)!==j.NONE,isEmpty:w(this,L,Ka).call(this),hasSomethingToUndo:r(this,Ne).hasSomethingToUndo(),hasSomethingToRedo:r(this,Ne).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,L,hf).call(this),w(this,L,Fc).call(this),w(this,L,ie).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!r(this,je)){g(this,je,t);for(const e of r(this,je))w(this,L,Ls).call(this,e.defaultPropertiesToUpdate)}}getId(){return r(this,ql).id}get currentLayer(){return r(this,$t).get(r(this,Wr))}getLayer(t){return r(this,$t).get(t)}get currentPageIndex(){return r(this,Wr)}addLayer(t){r(this,$t).set(t.pageIndex,t),r(this,Ei)?t.enable():t.disable()}removeLayer(t){r(this,$t).delete(t.pageIndex)}async updateMode(t,e=null,s=!1){var i,n;if(r(this,kt)!==t&&!(r(this,Oe)&&(await r(this,Oe).promise,!r(this,Oe)))){if(g(this,Oe,Promise.withResolvers()),g(this,kt,t),t===j.NONE){this.setEditingState(!1),w(this,L,uf).call(this),(i=this._editorUndoBar)==null||i.hide(),r(this,Oe).resolve();return}t===j.SIGNATURE&&await((n=r(this,Ti))==null?void 0:n.loadSignatures()),this.setEditingState(!0),await w(this,L,df).call(this),this.unselectAll();for(const a of r(this,$t).values())a.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),r(this,Oe).resolve();return}for(const a of r(this,It).values())a.annotationElementId===e?(this.setSelected(a),a.enterInEditMode()):a.unselect();r(this,Oe).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==r(this,kt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var s;if(r(this,je)){switch(t){case Z.CREATE:this.currentLayer.addNewEditor(e);return;case Z.HIGHLIGHT_DEFAULT_COLOR:(s=r(this,wn))==null||s.updateColor(e);break;case Z.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(r(this,To)||g(this,To,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const i of r(this,it))i.updateParams(t,e);for(const i of r(this,je))i.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){var n;for(const a of r(this,It).values())a.editorType===t&&a.show(e);(((n=r(this,To))==null?void 0:n.get(Z.HIGHLIGHT_SHOW_ALL))??!0)!==e&&w(this,L,Ls).call(this,[[Z.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(r(this,Co)!==t){g(this,Co,t);for(const e of r(this,$t).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const s of r(this,It).values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return r(this,It).get(t)}addEditor(t){r(this,It).set(t.id,t)}removeEditor(t){var e,s;t.div.contains(document.activeElement)&&(r(this,us)&&clearTimeout(r(this,us)),g(this,us,setTimeout(()=>{this.focusMainContainer(),g(this,us,null)},0))),r(this,It).delete(t.id),t.annotationElementId&&((e=r(this,Pi))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!r(this,mn).has(t.annotationElementId))&&((s=r(this,Ns))==null||s.remove(t.id))}addDeletedAnnotationElement(t){r(this,mn).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return r(this,mn).has(t)}removeDeletedAnnotationElement(t){r(this,mn).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){r(this,ye)!==t&&(g(this,ye,t),t&&w(this,L,Ls).call(this,t.propertiesToUpdate))}updateUI(t){r(this,L,ff)===t&&w(this,L,Ls).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){w(this,L,Ls).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(r(this,it).has(t)){r(this,it).delete(t),t.unselect(),w(this,L,ie).call(this,{hasSelectedEditor:this.hasSelection});return}r(this,it).add(t),t.select(),w(this,L,Ls).call(this,t.propertiesToUpdate),w(this,L,ie).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=r(this,gn))==null||e.commitOrRemove();for(const s of r(this,it))s!==t&&s.unselect();r(this,it).clear(),r(this,it).add(t),t.select(),w(this,L,Ls).call(this,t.propertiesToUpdate),w(this,L,ie).call(this,{hasSelectedEditor:!0})}isSelected(t){return r(this,it).has(t)}get firstSelectedEditor(){return r(this,it).values().next().value}unselect(t){t.unselect(),r(this,it).delete(t),w(this,L,ie).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return r(this,it).size!==0}get isEnterHandled(){return r(this,it).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;r(this,Ne).undo(),w(this,L,ie).call(this,{hasSomethingToUndo:r(this,Ne).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,L,Ka).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){r(this,Ne).redo(),w(this,L,ie).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:r(this,Ne).hasSomethingToRedo(),isEmpty:w(this,L,Ka).call(this)})}addCommands(t){r(this,Ne).add(t),w(this,L,ie).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,L,Ka).call(this)})}cleanUndoStack(t){r(this,Ne).cleanType(t)}delete(){var n;this.commitOrRemove();const t=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...r(this,it)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},i=()=>{for(const a of e)w(this,L,Nc).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var t;(t=r(this,ye))==null||t.commitOrRemove()}hasSomethingToControl(){return r(this,ye)||this.hasSelection}selectAll(){for(const t of r(this,it))t.commit();w(this,L,Oc).call(this,r(this,It).values())}unselectAll(){var t;if(!(r(this,ye)&&(r(this,ye).commitOrRemove(),r(this,kt)!==j.NONE))&&!((t=r(this,gn))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of r(this,it))e.unselect();r(this,it).clear(),w(this,L,ie).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;r(this,Ri)[0]+=t,r(this,Ri)[1]+=e;const[i,n]=r(this,Ri),a=[...r(this,it)],o=1e3;r(this,ps)&&clearTimeout(r(this,ps)),g(this,ps,setTimeout(()=>{g(this,ps,null),r(this,Ri)[0]=r(this,Ri)[1]=0,this.addCommands({cmd:()=>{for(const h of a)r(this,It).has(h.id)&&(h.translateInPage(i,n),h.translationDone())},undo:()=>{for(const h of a)r(this,It).has(h.id)&&(h.translateInPage(-i,-n),h.translationDone())},mustExec:!1})},o));for(const h of a)h.translateInPage(t,e),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,ds,new Map);for(const t of r(this,it))r(this,ds).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!r(this,ds))return!1;this.disableUserSelect(!1);const t=r(this,ds);g(this,ds,null);let e=!1;for(const[{x:i,y:n,pageIndex:a},o]of t)o.newX=i,o.newY=n,o.newPageIndex=a,e||(e=i!==o.savedX||n!==o.savedY||a!==o.savedPageIndex);if(!e)return!1;const s=(i,n,a,o)=>{if(r(this,It).has(i.id)){const h=r(this,$t).get(o);h?i._setParentAndPosition(h,n,a):(i.pageIndex=o,i.x=n,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:a,newPageIndex:o}]of t)s(i,n,a,o)},undo:()=>{for(const[i,{savedX:n,savedY:a,savedPageIndex:o}]of t)s(i,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(r(this,ds))for(const s of r(this,ds).keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||r(this,it).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return r(this,ye)===t}getActive(){return r(this,ye)}getMode(){return r(this,kt)}get imageManager(){return Q(this,"imageManager",new Ic)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,c=e.rangeCount;l<c;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:a}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(l,c,f,p)=>({x:(c-i)/a,y:1-(l+f-s)/n,width:p/a,height:f/n});break;case"180":o=(l,c,f,p)=>({x:1-(l+f-s)/n,y:1-(c+p-i)/a,width:f/n,height:p/a});break;case"270":o=(l,c,f,p)=>({x:1-(c+p-i)/a,y:(l-s)/n,width:p/a,height:f/n});break;default:o=(l,c,f,p)=>({x:(l-s)/n,y:(c-i)/a,width:f/n,height:p/a});break}const h=[];for(let l=0,c=e.rangeCount;l<c;l++){const f=e.getRangeAt(l);if(!f.collapsed)for(const{x:p,y:b,width:S,height:A}of f.getClientRects())S===0||A===0||h.push(o(p,b,S,A))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:e}){(r(this,zr)||g(this,zr,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=r(this,zr))==null||e.delete(t)}renderAnnotationElement(t){var i;const e=(i=r(this,zr))==null?void 0:i.get(t.data.id);if(!e)return;const s=r(this,Ns).getRawValue(e);s&&(r(this,kt)===j.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){var n;const i=(n=r(this,Pi))==null?void 0:n.get(t);i&&(i.setCanvas(e,s),r(this,Pi).delete(t))}addMissingCanvas(t,e){(r(this,Pi)||g(this,Pi,new Map)).set(t,e)}};$r=new WeakMap,ye=new WeakMap,It=new WeakMap,$t=new WeakMap,Gr=new WeakMap,Ns=new WeakMap,zr=new WeakMap,Ne=new WeakMap,Si=new WeakMap,gn=new WeakMap,Wr=new WeakMap,mn=new WeakMap,ds=new WeakMap,je=new WeakMap,bn=new WeakMap,_o=new WeakMap,xo=new WeakMap,Ur=new WeakMap,Eo=new WeakMap,us=new WeakMap,_i=new WeakMap,Vr=new WeakMap,xi=new WeakMap,fs=new WeakMap,ql=new WeakMap,Ei=new WeakMap,Co=new WeakMap,Ci=new WeakMap,yn=new WeakMap,wn=new WeakMap,Pi=new WeakMap,Po=new WeakMap,kt=new WeakMap,it=new WeakMap,Os=new WeakMap,Ti=new WeakMap,An=new WeakMap,To=new WeakMap,Ro=new WeakMap,Ri=new WeakMap,ps=new WeakMap,Bs=new WeakMap,Io=new WeakMap,Oe=new WeakMap,L=new WeakSet,rl=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},Lc=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of r(this,$t).values())if(s.hasTextLayer(t))return s;return null},nf=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=w(this,L,rl).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(r(this,fs)||g(this,fs,new Eg(this)),r(this,fs).show(s,i,this.direction==="ltr"))},rf=function(){var n,a,o;const t=document.getSelection();if(!t||t.isCollapsed){r(this,Os)&&((n=r(this,fs))==null||n.hide(),g(this,Os,null),w(this,L,ie).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===r(this,Os))return;const i=w(this,L,rl).call(this,t).closest(".textLayer");if(!i){r(this,Os)&&((a=r(this,fs))==null||a.hide(),g(this,Os,null),w(this,L,ie).call(this,{hasSelectedText:!1}));return}if((o=r(this,fs))==null||o.hide(),g(this,Os,e),w(this,L,ie).call(this,{hasSelectedText:!0}),!(r(this,kt)!==j.HIGHLIGHT&&r(this,kt)!==j.NONE)&&(r(this,kt)===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,xi,this.isShiftKeyDown),!this.isShiftKeyDown)){const h=r(this,kt)===j.HIGHLIGHT?w(this,L,Lc).call(this,i):null;h==null||h.toggleDrawing();const l=new AbortController,c=this.combinedSignal(l),f=p=>{p.type==="pointerup"&&p.button!==0||(l.abort(),h==null||h.toggleDrawing(!0),p.type==="pointerup"&&w(this,L,al).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:c}),window.addEventListener("blur",f,{signal:c})}},al=function(t=""){r(this,kt)===j.HIGHLIGHT?this.highlightSelection(t):r(this,_o)&&w(this,L,nf).call(this)},af=function(){document.addEventListener("selectionchange",w(this,L,rf).bind(this),{signal:this._signal})},of=function(){if(r(this,_i))return;g(this,_i,new AbortController);const t=this.combinedSignal(r(this,_i));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},hf=function(){var t;(t=r(this,_i))==null||t.abort(),g(this,_i,null)},kc=function(){if(r(this,Ci))return;g(this,Ci,new AbortController);const t=this.combinedSignal(r(this,Ci));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},lf=function(){var t;(t=r(this,Ci))==null||t.abort(),g(this,Ci,null)},Dc=function(){if(r(this,Si))return;g(this,Si,new AbortController);const t=this.combinedSignal(r(this,Si));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},Fc=function(){var t;(t=r(this,Si))==null||t.abort(),g(this,Si,null)},cf=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},ie=function(t){Object.entries(t).some(([s,i])=>r(this,Ro)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(r(this,Ro),t)}),r(this,kt)===j.HIGHLIGHT&&t.hasSelectedEditor===!1&&w(this,L,Ls).call(this,[[Z.HIGHLIGHT_FREE,!0]]))},Ls=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},df=async function(){if(!r(this,Ei)){g(this,Ei,!0);const t=[];for(const e of r(this,$t).values())t.push(e.enable());await Promise.all(t);for(const e of r(this,It).values())e.enable()}},uf=function(){if(this.unselectAll(),r(this,Ei)){g(this,Ei,!1);for(const t of r(this,$t).values())t.disable();for(const t of r(this,It).values())t.disable()}},Nc=function(t){const e=r(this,$t).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},ff=function(){let t=null;for(t of r(this,it));return t},Ka=function(){if(r(this,It).size===0)return!0;if(r(this,It).size===1)for(const t of r(this,It).values())return t.isEmpty();return!1},Oc=function(t){for(const e of r(this,it))e.unselect();r(this,it).clear();for(const e of t)e.isEmpty()||(r(this,it).add(e),e.select());w(this,L,ie).call(this,{hasSelectedEditor:this.hasSelection})},O(kr,"TRANSLATE_SMALL",1),O(kr,"TRANSLATE_BIG",10);let wr=kr;var Dt,gs,qe,jr,ms,we,qr,bs,ue,Hs,vn,ys,Ii,ns,Qa,ol;const ne=class ne{constructor(t){y(this,ns);y(this,Dt,null);y(this,gs,!1);y(this,qe,null);y(this,jr,null);y(this,ms,null);y(this,we,null);y(this,qr,!1);y(this,bs,null);y(this,ue,null);y(this,Hs,null);y(this,vn,null);y(this,ys,!1);g(this,ue,t),g(this,ys,t._uiManager.useNewAltTextFlow),r(ne,Ii)||g(ne,Ii,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){ne._l10n??(ne._l10n=t)}async render(){const t=g(this,qe,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=g(this,jr,document.createElement("span"));t.append(e),r(this,ys)?(t.classList.add("new"),t.setAttribute("data-l10n-id",r(ne,Ii).missing),e.setAttribute("data-l10n-id",r(ne,Ii)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=r(this,ue)._uiManager._signal;t.addEventListener("contextmenu",rs,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),r(this,ue)._uiManager.editAltText(r(this,ue)),r(this,ys)&&r(this,ue)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:r(this,ns,Qa)}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(g(this,qr,!0),i(n))},{signal:s}),await w(this,ns,ol).call(this),t}finish(){r(this,qe)&&(r(this,qe).focus({focusVisible:r(this,qr)}),g(this,qr,!1))}isEmpty(){return r(this,ys)?r(this,Dt)===null:!r(this,Dt)&&!r(this,gs)}hasData(){return r(this,ys)?r(this,Dt)!==null||!!r(this,Hs):this.isEmpty()}get guessedText(){return r(this,Hs)}async setGuessedText(t){r(this,Dt)===null&&(g(this,Hs,t),g(this,vn,await ne._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),w(this,ns,ol).call(this))}toggleAltTextBadge(t=!1){var e;if(!r(this,ys)||r(this,Dt)){(e=r(this,bs))==null||e.remove(),g(this,bs,null);return}if(!r(this,bs)){const s=g(this,bs,document.createElement("div"));s.className="noAltTextBadge",r(this,ue).div.append(s)}r(this,bs).classList.toggle("hidden",!t)}serialize(t){let e=r(this,Dt);return!t&&r(this,Hs)===e&&(e=r(this,vn)),{altText:e,decorative:r(this,gs),guessedText:r(this,Hs),textWithDisclaimer:r(this,vn)}}get data(){return{altText:r(this,Dt),decorative:r(this,gs)}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(g(this,Hs,s),g(this,vn,i)),!(r(this,Dt)===t&&r(this,gs)===e)&&(n||(g(this,Dt,t),g(this,gs,e)),w(this,ns,ol).call(this))}toggle(t=!1){r(this,qe)&&(!t&&r(this,we)&&(clearTimeout(r(this,we)),g(this,we,null)),r(this,qe).disabled=!t)}shown(){r(this,ue)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:r(this,ns,Qa)}})}destroy(){var t,e;(t=r(this,qe))==null||t.remove(),g(this,qe,null),g(this,jr,null),g(this,ms,null),(e=r(this,bs))==null||e.remove(),g(this,bs,null)}};Dt=new WeakMap,gs=new WeakMap,qe=new WeakMap,jr=new WeakMap,ms=new WeakMap,we=new WeakMap,qr=new WeakMap,bs=new WeakMap,ue=new WeakMap,Hs=new WeakMap,vn=new WeakMap,ys=new WeakMap,Ii=new WeakMap,ns=new WeakSet,Qa=function(){return r(this,Dt)&&"added"||r(this,Dt)===null&&this.guessedText&&"review"||"missing"},ol=async function(){var i,n,a;const t=r(this,qe);if(!t)return;if(r(this,ys)){if(t.classList.toggle("done",!!r(this,Dt)),t.setAttribute("data-l10n-id",r(ne,Ii)[r(this,ns,Qa)]),(i=r(this,jr))==null||i.setAttribute("data-l10n-id",r(ne,Ii)[`${r(this,ns,Qa)}-label`]),!r(this,Dt)){(n=r(this,ms))==null||n.remove();return}}else{if(!r(this,Dt)&&!r(this,gs)){t.classList.remove("done"),(a=r(this,ms))==null||a.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=r(this,ms);if(!e){g(this,ms,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${r(this,ue).id}`;const o=100,h=r(this,ue)._uiManager._signal;h.addEventListener("abort",()=>{clearTimeout(r(this,we)),g(this,we,null)},{once:!0}),t.addEventListener("mouseenter",()=>{g(this,we,setTimeout(()=>{g(this,we,null),r(this,ms).classList.add("show"),r(this,ue)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:h}),t.addEventListener("mouseleave",()=>{var l;r(this,we)&&(clearTimeout(r(this,we)),g(this,we,null)),(l=r(this,ms))==null||l.classList.remove("show")},{signal:h})}r(this,gs)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=r(this,Dt)),e.parentNode||t.append(e);const s=r(this,ue).getElementForAltText();s==null||s.setAttribute("aria-describedby",e.id)},y(ne,Ii,null),O(ne,"_l10n",null);let Dl=ne;var Xr,Sn,Mo,Lo,ko,Do,Fo,$s,_n,Gs,xn,Mi,rn,pf,gf,mf;const lu=class lu{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){y(this,rn);y(this,Xr);y(this,Sn,!1);y(this,Mo,null);y(this,Lo);y(this,ko);y(this,Do);y(this,Fo);y(this,$s,null);y(this,_n);y(this,Gs,null);y(this,xn);y(this,Mi,null);g(this,Xr,t),g(this,Mo,s),g(this,Lo,e),g(this,ko,i),g(this,Do,n),g(this,Fo,a),g(this,xn,new AbortController),g(this,_n,AbortSignal.any([o,r(this,xn).signal])),t.addEventListener("touchstart",w(this,rn,pf).bind(this),{passive:!1,signal:r(this,_n)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/pi.pixelRatio}destroy(){var t,e;(t=r(this,xn))==null||t.abort(),g(this,xn,null),(e=r(this,$s))==null||e.abort(),g(this,$s,null)}};Xr=new WeakMap,Sn=new WeakMap,Mo=new WeakMap,Lo=new WeakMap,ko=new WeakMap,Do=new WeakMap,Fo=new WeakMap,$s=new WeakMap,_n=new WeakMap,Gs=new WeakMap,xn=new WeakMap,Mi=new WeakMap,rn=new WeakSet,pf=function(t){var i,n,a;if((i=r(this,Lo))!=null&&i.call(this))return;if(t.touches.length===1){if(r(this,$s))return;const o=g(this,$s,new AbortController),h=AbortSignal.any([r(this,_n),o.signal]),l=r(this,Xr),c={capture:!0,signal:h,passive:!1},f=p=>{var b;p.pointerType==="touch"&&((b=r(this,$s))==null||b.abort(),g(this,$s,null))};l.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Et(p),f(p))},c),l.addEventListener("pointerup",f,c),l.addEventListener("pointercancel",f,c);return}if(!r(this,Mi)){g(this,Mi,new AbortController);const o=AbortSignal.any([r(this,_n),r(this,Mi).signal]),h=r(this,Xr),l={signal:o,capture:!1,passive:!1};h.addEventListener("touchmove",w(this,rn,gf).bind(this),l);const c=w(this,rn,mf).bind(this);h.addEventListener("touchend",c,l),h.addEventListener("touchcancel",c,l),l.capture=!0,h.addEventListener("pointerdown",Et,l),h.addEventListener("pointermove",Et,l),h.addEventListener("pointercancel",Et,l),h.addEventListener("pointerup",Et,l),(n=r(this,ko))==null||n.call(this)}if(Et(t),t.touches.length!==2||(a=r(this,Mo))!=null&&a.call(this)){g(this,Gs,null);return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),g(this,Gs,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY})},gf=function(t){var u;if(!r(this,Gs)||t.touches.length!==2)return;Et(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:a,screenY:o}=s,h=r(this,Gs),{touch0X:l,touch0Y:c,touch1X:f,touch1Y:p}=h,b=f-l,S=p-c,A=a-i,x=o-n,C=Math.hypot(A,x)||1,T=Math.hypot(b,S)||1;if(!r(this,Sn)&&Math.abs(T-C)<=lu.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=i,h.touch0Y=n,h.touch1X=a,h.touch1Y=o,!r(this,Sn)){g(this,Sn,!0);return}const E=[(i+a)/2,(n+o)/2];(u=r(this,Do))==null||u.call(this,E,T,C)},mf=function(t){var e;t.touches.length>=2||(r(this,Mi).abort(),g(this,Mi,null),(e=r(this,Fo))==null||e.call(this),r(this,Gs)&&(Et(t),g(this,Gs,null),g(this,Sn,!1)))};let Fl=lu;var En,Xe,lt,Yr,Li,No,Cn,Gt,Pn,zs,ki,Oo,Tn,Ae,Bo,Rn,Ws,ws,Kr,Qr,Be,In,Ho,Xl,z,Bc,$o,Hc,hl,bf,yf,$c,ll,Gc,wf,Af,vf,zc,Sf,Wc,_f,xf,Ef,Uc,Za;const Y=class Y{constructor(t){y(this,z);y(this,En,null);y(this,Xe,null);y(this,lt,null);y(this,Yr,!1);y(this,Li,null);y(this,No,"");y(this,Cn,!1);y(this,Gt,null);y(this,Pn,null);y(this,zs,null);y(this,ki,null);y(this,Oo,"");y(this,Tn,!1);y(this,Ae,null);y(this,Bo,!1);y(this,Rn,!1);y(this,Ws,!1);y(this,ws,null);y(this,Kr,0);y(this,Qr,0);y(this,Be,null);y(this,In,null);O(this,"_isCopy",!1);O(this,"_editToolbar",null);O(this,"_initialOptions",Object.create(null));O(this,"_initialData",null);O(this,"_isVisible",!0);O(this,"_uiManager",null);O(this,"_focusEventsAllowed",!0);y(this,Ho,!1);y(this,Xl,Y._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,a];const[o,h]=this.parentDimensions;this.x=t.x/o,this.y=t.y/h,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=Y.prototype._resizeWithKeyboard,e=wr.TRANSLATE_SMALL,s=wr.TRANSLATE_BIG;return Q(this,"_resizerKeyboardManager",new Wh([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],Y.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Q(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Tg({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Y._l10n??(Y._l10n=t),Y._l10nResizer||(Y._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Y._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Y._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){at("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return r(this,Ho)}set _isDraggable(t){var e;g(this,Ho,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=r(this,Xl)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):w(this,z,Za).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(r(this,Tn)?g(this,Tn,!1):this.parent.setSelected(this))}focusout(t){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/a,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}translate(t,e){w(this,z,Bc).call(this,this.parentDimensions,t,e)}translateInPage(t,e){r(this,Ae)||g(this,Ae,[this.x,this.y,this.width,this.height]),w(this,z,Bc).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){r(this,Ae)||g(this,Ae,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[h,l]=this.getBaseTranslation();a+=h,o+=l;const{style:c}=s;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!r(this,Ae)&&(r(this,Ae)[0]!==this.x||r(this,Ae)[1]!==this.y)}get _hasBeenResized(){return!!r(this,Ae)&&(r(this,Ae)[2]!==this.width||r(this,Ae)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=Y,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:a,width:o,height:h}=this;if(o*=s,h*=i,n*=s,a*=i,this._mustFixPosition)switch(t){case 0:n=he(n,0,s-o),a=he(a,0,i-h);break;case 90:n=he(n,0,s-h),a=he(a,o,i);break;case 180:n=he(n,o,s),a=he(a,h,i);break;case 270:n=he(n,h,s),a=he(a,0,i-o);break}this.x=n/=s,this.y=a/=i;const[l,c]=this.getBaseTranslation();n+=l,a+=c,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var s;return w(s=Y,$o,Hc).call(s,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var s;return w(s=Y,$o,Hc).call(s,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/s).toFixed(2)}%`,r(this,Cn)||(n.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),n=!r(this,Cn)&&e.endsWith("%");if(i&&n)return;const[a,o]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!r(this,Cn)&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=r(this,lt))==null||t.finish()}async addEditToolbar(){return this._editToolbar||r(this,Rn)?this._editToolbar:(this._editToolbar=new Rc(this),this.div.append(this._editToolbar.render()),r(this,lt)&&await this._editToolbar.addAltText(r(this,lt)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=r(this,lt))==null||t.destroy())}addContainer(t){var s;const e=(s=this._editToolbar)==null?void 0:s.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){r(this,lt)||(Dl.initialize(Y._l10n),g(this,lt,new Dl(this)),r(this,En)&&(r(this,lt).data=r(this,En),g(this,En,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=r(this,lt))==null?void 0:t.data}set altTextData(t){r(this,lt)&&(r(this,lt).data=t)}get guessedAltText(){var t;return(t=r(this,lt))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=r(this,lt))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=r(this,lt))==null?void 0:e.serialize(t)}hasAltText(){return!!r(this,lt)&&!r(this,lt).isEmpty()}hasAltTextData(){var t;return((t=r(this,lt))==null?void 0:t.hasData())??!1}render(){var a;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=r(this,Yr)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),w(this,z,Wc).call(this);const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),Zd(this,t,["keydown","pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(r(this,In)||g(this,In,new Fl({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:w(this,z,wf).bind(this),onPinching:w(this,z,Af).bind(this),onPinchEnd:w(this,z,vf).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),t}pointerdown(t){const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(g(this,Tn,!0),this._isDraggable){w(this,z,Sf).call(this,t);return}w(this,z,zc).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){r(this,ws)&&clearTimeout(r(this,ws)),g(this,ws,setTimeout(()=>{var t;g(this,ws,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,a]=this.pageDimensions,[o,h]=this.pageTranslation,l=t/i,c=e/i,f=this.x*n,p=this.y*a,b=this.width*n,S=this.height*a;switch(s){case 0:return[f+l+o,a-p-c-S+h,f+l+b+o,a-p-c+h];case 90:return[f+c+o,a-p+l+h,f+c+S+o,a-p+l+b+h];case 180:return[f-l-b+o,a-p+c+h,f-l+o,a-p+c+S+h];case 270:return[f-c-S+o,a-p-l-b+h,f-c+o,a-p-l+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,a]=t,o=n-s,h=a-i;switch(this.rotation){case 0:return[s,e-a,o,h];case 90:return[s,e-i,h,o];case 180:return[n,e-i,o,h];case 270:return[n,e-a,h,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){g(this,Rn,!0)}disableEditMode(){g(this,Rn,!1)}isInEditMode(){return r(this,Rn)}shouldGetKeyboardEvents(){return r(this,Ws)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return e<a&&i>0&&t<n&&s>0}rebuild(){w(this,z,Wc).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){at("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});i.rotation=t.rotation,g(i,En,t.accessibilityData),i._isCopy=t.isCopy||!1;const[n,a]=i.pageDimensions,[o,h,l,c]=i.getRectInCurrentCoords(t.rect,a);return i.x=o/n,i.y=h/a,i.width=l/n,i.height=c/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=r(this,ki))==null||t.abort(),g(this,ki,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),r(this,ws)&&(clearTimeout(r(this,ws)),g(this,ws,null)),w(this,z,Za).call(this),this.removeEditToolbar(),r(this,Be)){for(const s of r(this,Be).values())clearTimeout(s);g(this,Be,null)}this.parent=null,(e=r(this,In))==null||e.destroy(),g(this,In,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,z,bf).call(this),r(this,Gt).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),g(this,zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=r(this,Gt).children;if(!r(this,Xe)){g(this,Xe,Array.from(e));const a=w(this,z,_f).bind(this),o=w(this,z,xf).bind(this),h=this._uiManager._signal;for(const l of r(this,Xe)){const c=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",a,{signal:h}),l.addEventListener("blur",o,{signal:h}),l.addEventListener("focus",w(this,z,Ef).bind(this,c),{signal:h}),l.setAttribute("data-l10n-id",Y._l10nResizer[c])}}const s=r(this,Xe)[0];let i=0;for(const a of e){if(a===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(r(this,Xe).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)r(this,Gt).append(r(this,Gt).firstChild);else if(n>i)for(let o=0;o<n-i;o++)r(this,Gt).firstChild.before(r(this,Gt).lastChild);let a=0;for(const o of e){const l=r(this,Xe)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Y._l10nResizer[l])}}w(this,z,Uc).call(this,0),g(this,Ws,!0),r(this,Gt).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){r(this,Ws)&&w(this,z,Gc).call(this,r(this,Oo),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,z,Za).call(this),this.div.focus()}select(){var t,e,s;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(e=this._editToolbar)==null||e.show(),(s=r(this,lt))==null||s.toggleAltTextBadge(!1)}unselect(){var t,e,s,i,n;(t=r(this,Gt))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=r(this,lt))==null||n.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return r(this,Bo)}set isEditing(t){g(this,Bo,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){g(this,Cn,!0);const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){r(this,Be)||g(this,Be,new Map);const{action:s}=t;let i=r(this,Be).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),r(this,Be).delete(s),r(this,Be).size===0&&g(this,Be,null)},Y._telemetryTimeout),r(this,Be).set(s,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),g(this,Yr,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,Yr,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};En=new WeakMap,Xe=new WeakMap,lt=new WeakMap,Yr=new WeakMap,Li=new WeakMap,No=new WeakMap,Cn=new WeakMap,Gt=new WeakMap,Pn=new WeakMap,zs=new WeakMap,ki=new WeakMap,Oo=new WeakMap,Tn=new WeakMap,Ae=new WeakMap,Bo=new WeakMap,Rn=new WeakMap,Ws=new WeakMap,ws=new WeakMap,Kr=new WeakMap,Qr=new WeakMap,Be=new WeakMap,In=new WeakMap,Ho=new WeakMap,Xl=new WeakMap,z=new WeakSet,Bc=function([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},$o=new WeakSet,Hc=function(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},hl=function(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}},bf=function(){if(r(this,Gt))return;g(this,Gt,document.createElement("div")),r(this,Gt).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");r(this,Gt).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",w(this,z,yf).bind(this,s),{signal:e}),i.addEventListener("contextmenu",rs,{signal:e}),i.tabIndex=-1}this.div.prepend(r(this,Gt))},yf=function(t,e){var c;e.preventDefault();const{isMac:s}=Xt.platform;if(e.button!==0||e.ctrlKey&&s)return;(c=r(this,lt))==null||c.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,g(this,Pn,[e.screenX,e.screenY]);const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,z,Gc).bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Et,{passive:!1,signal:a}),window.addEventListener("contextmenu",rs,{signal:a}),g(this,zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{var f;n.abort(),this.parent.togglePointerEvents(!0),(f=r(this,lt))==null||f.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=h,w(this,z,ll).call(this)};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})},$c=function(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e;const[n,a]=this.parentDimensions;this.setDims(n*s,a*i),this.fixAndSetPosition(),this._onResized()},ll=function(){if(!r(this,zs))return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=r(this,zs);g(this,zs,null);const n=this.x,a=this.y,o=this.width,h=this.height;n===t&&a===e&&o===s&&h===i||this.addCommands({cmd:w(this,z,$c).bind(this,n,a,o,h),undo:w(this,z,$c).bind(this,t,e,s,i),mustExec:!0})},Gc=function(t,e){const[s,i]=this.parentDimensions,n=this.x,a=this.y,o=this.width,h=this.height,l=Y.MIN_SIZE/s,c=Y.MIN_SIZE/i,f=w(this,z,hl).call(this,this.rotation),p=(F,G)=>[f[0]*F+f[2]*G,f[1]*F+f[3]*G],b=w(this,z,hl).call(this,360-this.rotation),S=(F,G)=>[b[0]*F+b[2]*G,b[1]*F+b[3]*G];let A,x,C=!1,T=!1;switch(t){case"topLeft":C=!0,A=(F,G)=>[0,0],x=(F,G)=>[F,G];break;case"topMiddle":A=(F,G)=>[F/2,0],x=(F,G)=>[F/2,G];break;case"topRight":C=!0,A=(F,G)=>[F,0],x=(F,G)=>[0,G];break;case"middleRight":T=!0,A=(F,G)=>[F,G/2],x=(F,G)=>[0,G/2];break;case"bottomRight":C=!0,A=(F,G)=>[F,G],x=(F,G)=>[0,0];break;case"bottomMiddle":A=(F,G)=>[F/2,G],x=(F,G)=>[F/2,0];break;case"bottomLeft":C=!0,A=(F,G)=>[0,G],x=(F,G)=>[F,0];break;case"middleLeft":T=!0,A=(F,G)=>[0,G/2],x=(F,G)=>[F,G/2];break}const E=A(o,h),u=x(o,h);let m=p(...u);const v=Y._round(n+m[0]),_=Y._round(a+m[1]);let P=1,R=1,M,I;if(e.fromKeyboard)({deltaX:M,deltaY:I}=e);else{const{screenX:F,screenY:G}=e,[me,Ts]=r(this,Pn);[M,I]=this.screenToPageTranslation(F-me,G-Ts),r(this,Pn)[0]=F,r(this,Pn)[1]=G}if([M,I]=S(M/s,I/i),C){const F=Math.hypot(o,h);P=R=Math.max(Math.min(Math.hypot(u[0]-E[0]-M,u[1]-E[1]-I)/F,1/o,1/h),l/o,c/h)}else T?P=he(Math.abs(u[0]-E[0]-M),l,1)/o:R=he(Math.abs(u[1]-E[1]-I),c,1)/h;const $=Y._round(o*P),U=Y._round(h*R);m=p(...x($,U));const V=v-m[0],mt=_-m[1];r(this,Ae)||g(this,Ae,[this.x,this.y,this.width,this.height]),this.width=$,this.height=U,this.x=V,this.y=mt,this.setDims(s*$,i*U),this.fixAndSetPosition(),this._onResizing()},wf=function(){var t;g(this,zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=r(this,lt))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},Af=function(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const a=w(this,z,hl).call(this,this.rotation),o=(v,_)=>[a[0]*v+a[2]*_,a[1]*v+a[3]*_],[h,l]=this.parentDimensions,c=this.x,f=this.y,p=this.width,b=this.height,S=Y.MIN_SIZE/h,A=Y.MIN_SIZE/l;n=Math.max(Math.min(n,1/p,1/b),S/p,A/b);const x=Y._round(p*n),C=Y._round(b*n);if(x===p&&C===b)return;r(this,Ae)||g(this,Ae,[c,f,p,b]);const T=o(p/2,b/2),E=Y._round(c+T[0]),u=Y._round(f+T[1]),m=o(x/2,C/2);this.x=E-m[0],this.y=u-m[1],this.width=x,this.height=C,this.setDims(h*x,l*C),this.fixAndSetPosition(),this._onResizing()},vf=function(){var t;(t=r(this,lt))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),w(this,z,ll).call(this)},zc=function(t){const{isMac:e}=Xt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Sf=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:n},o=l=>{i.abort(),g(this,Li,null),g(this,Tn,!1),this._uiManager.endDragSession()||w(this,z,zc).call(this,l),s&&this._onStopDragging()};e&&(g(this,Kr,t.clientX),g(this,Qr,t.clientY),g(this,Li,t.pointerId),g(this,No,t.pointerType),window.addEventListener("pointermove",l=>{s||(s=!0,this._onStartDragging());const{clientX:c,clientY:f,pointerId:p}=l;if(p!==r(this,Li)){Et(l);return}const[b,S]=this.screenToPageTranslation(c-r(this,Kr),f-r(this,Qr));g(this,Kr,c),g(this,Qr,f),this._uiManager.dragSelectedEditors(b,S)},a),window.addEventListener("touchmove",Et,a),window.addEventListener("pointerdown",l=>{l.pointerType===r(this,No)&&(r(this,In)||l.isPrimary)&&o(l),Et(l)},a));const h=l=>{if(!r(this,Li)||r(this,Li)===l.pointerId){o(l);return}Et(l)};window.addEventListener("pointerup",h,{signal:n}),window.addEventListener("blur",h,{signal:n})},Wc=function(){if(r(this,ki)||!this.div)return;g(this,ki,new AbortController);const t=this._uiManager.combinedSignal(r(this,ki));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},_f=function(t){Y._resizerKeyboardManager.exec(this,t)},xf=function(t){var e;r(this,Ws)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==r(this,Gt)&&w(this,z,Za).call(this)},Ef=function(t){g(this,Oo,r(this,Ws)?t:"")},Uc=function(t){if(r(this,Xe))for(const e of r(this,Xe))e.tabIndex=t},Za=function(){g(this,Ws,!1),w(this,z,Uc).call(this,-1),w(this,z,ll).call(this)},y(Y,$o),O(Y,"_l10n",null),O(Y,"_l10nResizer",null),O(Y,"_borderLineWidth",-1),O(Y,"_colorManager",new Mc),O(Y,"_zIndex",1),O(Y,"_telemetryTimeout",1e3);let pt=Y;class Tg extends pt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const yu=3285377520,De=4294901760,ls=65535;class Cf{constructor(t){this.h1=t?t&4294967295:yu,this.h2=t?t&4294967295:yu}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let A=0,x=t.length;A<x;A++){const C=t.charCodeAt(A);C<=255?e[s++]=C:(e[s++]=C>>>8,e[s++]=C&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,a=new Uint32Array(e.buffer,0,i);let o=0,h=0,l=this.h1,c=this.h2;const f=3432918353,p=461845907,b=f&ls,S=p&ls;for(let A=0;A<i;A++)A&1?(o=a[A],o=o*f&De|o*b&ls,o=o<<15|o>>>17,o=o*p&De|o*S&ls,l^=o,l=l<<13|l>>>19,l=l*5+3864292196):(h=a[A],h=h*f&De|h*b&ls,h=h<<15|h>>>17,h=h*p&De|h*S&ls,c^=h,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,n){case 3:o^=e[i*4+2]<<16;case 2:o^=e[i*4+1]<<8;case 1:o^=e[i*4],o=o*f&De|o*b&ls,o=o<<15|o>>>17,o=o*p&De|o*S&ls,i&1?l^=o:c^=o}this.h1=l,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&De|t*36045&ls,e=e*4283543511&De|((e<<16|t>>>16)*2950163797&De)>>>16,t^=e>>>1,t=t*444984403&De|t*60499&ls,e=e*3301882366&De|((e<<16|t>>>16)*3120437893&De)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Vc=Object.freeze({map:null,hash:"",transfer:void 0});var Mn,Ln,Ft,Yl,Pf;class Jd{constructor(){y(this,Yl);y(this,Mn,!1);y(this,Ln,null);y(this,Ft,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=r(this,Ft).get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return r(this,Ft).get(t)}remove(t){if(r(this,Ft).delete(t),r(this,Ft).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of r(this,Ft).values())if(e instanceof pt)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=r(this,Ft).get(t);let i=!1;if(s!==void 0)for(const[n,a]of Object.entries(e))s[n]!==a&&(i=!0,s[n]=a);else i=!0,r(this,Ft).set(t,e);i&&w(this,Yl,Pf).call(this),e instanceof pt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return r(this,Ft).has(t)}getAll(){return r(this,Ft).size>0?jd(r(this,Ft)):null}setAll(t){for(const[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return r(this,Ft).size}resetModified(){r(this,Mn)&&(g(this,Mn,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Tf(this)}get serializable(){if(r(this,Ft).size===0)return Vc;const t=new Map,e=new Cf,s=[],i=Object.create(null);let n=!1;for(const[a,o]of r(this,Ft)){const h=o instanceof pt?o.serialize(!1,i):o;h&&(t.set(a,h),e.update(`${a}:${JSON.stringify(h)}`),n||(n=!!h.bitmap))}if(n)for(const a of t.values())a.bitmap&&s.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Vc}get editorStats(){let t=null;const e=new Map;for(const s of r(this,Ft).values()){if(!(s instanceof pt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;e.has(n)||e.set(n,Object.getPrototypeOf(s).constructor),t||(t=Object.create(null));const a=t[n]||(t[n]=new Map);for(const[o,h]of Object.entries(i)){if(o==="type")continue;let l=a.get(o);l||(l=new Map,a.set(o,l));const c=l.get(h)??0;l.set(h,c+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){g(this,Ln,null)}get modifiedIds(){if(r(this,Ln))return r(this,Ln);const t=[];for(const e of r(this,Ft).values())!(e instanceof pt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return g(this,Ln,{ids:new Set(t),hash:t.join(",")})}}Mn=new WeakMap,Ln=new WeakMap,Ft=new WeakMap,Yl=new WeakSet,Pf=function(){r(this,Mn)||(g(this,Mn,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Go;class Tf extends Jd{constructor(e){super();y(this,Go);const{map:s,hash:i,transfer:n}=e.serializable,a=structuredClone(s,n?{transfer:n}:null);g(this,Go,{map:a,hash:i,transfer:n})}get print(){at("Should not call PrintAnnotationStorage.print")}get serializable(){return r(this,Go)}get modifiedIds(){return Q(this,"modifiedIds",{ids:new Set,hash:""})}}Go=new WeakMap;var Zr;class Rg{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){y(this,Zr,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),r(this,Zr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||r(this,Zr).has(t.loadedName))){if(Ct(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:a}=t,o=new FontFace(i,n,a);this.addNativeFontFace(o);try{await o.load(),r(this,Zr).add(i),s==null||s(t)}catch{q(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}at("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw q(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return Q(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Q(this,"isSyncFontLoadingSupported",Ut||Xt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Ct(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Q(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(u,m){return u.charCodeAt(m)<<24|u.charCodeAt(m+1)<<16|u.charCodeAt(m+2)<<8|u.charCodeAt(m+3)&255}function i(u,m,v,_){const P=u.substring(0,m),R=u.substring(m+v);return P+_+R}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const h=o.getContext("2d");let l=0;function c(u,m){if(++l>30){q("Load test font never loaded."),m();return}if(h.font="30px "+u,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){m();return}setTimeout(c.bind(null,u,m))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=i(p,976,f.length,f);const S=16,A=1482184792;let x=s(p,S);for(n=0,a=f.length-3;n<a;n+=4)x=x-A+s(f,n)|0;n<f.length&&(x=x-A+s(f+"XXX",n)|0),p=i(p,S,4,pg(x));const C=`url(data:font/opentype;base64,${btoa(p)});`,T=`@font-face {font-family:"${f}";src:${C}}`;this.insertRule(T);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const u of[t.loadedName,f]){const m=this._document.createElement("span");m.textContent="Hi",m.style.fontFamily=u,E.append(m)}this._document.body.append(E),c(f,()=>{E.remove(),e.complete()})}}Zr=new WeakMap;class Ig{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this._inspectFont=e}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Xu(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return(s=this._inspectFont)==null||s.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(a){q(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}}const Xh={DATA:1,ERROR:2},_t={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function wu(){}function ce(d){if(d instanceof en||d instanceof Cc||d instanceof gu||d instanceof kl||d instanceof bc)return d;switch(d instanceof Error||typeof d=="object"&&d!==null||at('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),d.name){case"AbortException":return new en(d.message);case"InvalidPDFException":return new Cc(d.message);case"PasswordException":return new gu(d.message,d.code);case"ResponseException":return new kl(d.message,d.status,d.missing);case"UnknownErrorException":return new bc(d.message,d.details)}return new bc(d.message,d.toString())}var Jr,Ue,Rf,If,Mf,cl;class Ja{constructor(t,e,s){y(this,Ue);y(this,Jr,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",w(this,Ue,Rf).bind(this),{signal:r(this,Jr).signal})}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,a=this.sourceName,o=this.targetName,h=this.comObj;return new ReadableStream({start:l=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:l,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:a,targetName:o,action:t,streamId:n,data:e,desiredSize:l.desiredSize},i),c.promise},pull:l=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,h.postMessage({sourceName:a,targetName:o,stream:_t.PULL,streamId:n,desiredSize:l.desiredSize}),c.promise},cancel:l=>{Ct(l instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,h.postMessage({sourceName:a,targetName:o,stream:_t.CANCEL,streamId:n,reason:ce(l)}),c.promise}},s)}destroy(){var t;(t=r(this,Jr))==null||t.abort(),g(this,Jr,null)}}Jr=new WeakMap,Ue=new WeakSet,Rf=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){w(this,Ue,Mf).call(this,t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Xh.DATA)i.resolve(t.data);else if(t.callback===Xh.ERROR)i.reject(ce(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(a){n.postMessage({sourceName:s,targetName:i,callback:Xh.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:s,targetName:i,callback:Xh.ERROR,callbackId:t.callbackId,reason:ce(a)})});return}if(t.streamId){w(this,Ue,If).call(this,t);return}e(t.data)},If=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,a=this,o=this.actionHandler[t.action],h={enqueue(l,c=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=c,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:_t.ENQUEUE,streamId:e,chunk:l},f)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:_t.CLOSE,streamId:e}),delete a.streamSinks[e])},error(l){Ct(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:_t.ERROR,streamId:e,reason:ce(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[e]=h,Promise.try(o,t.data,h).then(function(){n.postMessage({sourceName:s,targetName:i,stream:_t.START_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:_t.START_COMPLETE,streamId:e,reason:ce(l)})})},Mf=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case _t.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(ce(t.reason));break;case _t.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(ce(t.reason));break;case _t.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:_t.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||wu).then(function(){n.postMessage({sourceName:s,targetName:i,stream:_t.PULL_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:_t.PULL_COMPLETE,streamId:e,reason:ce(l)})});break;case _t.ENQUEUE:if(Ct(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case _t.CLOSE:if(Ct(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),w(this,Ue,cl).call(this,a,e);break;case _t.ERROR:Ct(a,"error should have stream controller"),a.controller.error(ce(t.reason)),w(this,Ue,cl).call(this,a,e);break;case _t.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(ce(t.reason)),w(this,Ue,cl).call(this,a,e);break;case _t.CANCEL:if(!o)break;const h=ce(t.reason);Promise.try(o.onCancel||wu,h).then(function(){n.postMessage({sourceName:s,targetName:i,stream:_t.CANCEL_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:_t.CANCEL_COMPLETE,streamId:e,reason:ce(l)})}),o.sinkCapability.reject(h),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},cl=async function(t,e){var s,i,n;await Promise.allSettled([(s=t.startCall)==null?void 0:s.promise,(i=t.pullCall)==null?void 0:i.promise,(n=t.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[e]};var zo;class Lf{constructor({enableHWA:t=!1}){y(this,zo,!1);g(this,zo,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!r(this,zo)})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){at("Abstract method `_createCanvas` called.")}}zo=new WeakMap;class Mg extends Lf{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class kf{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class Au extends kf{async _fetch(t){const e=await Gh(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):$h(e)}}class Df{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}var kn,ta,Us,Vs,Jt,Dn,Fn,k,Qt,to,Pr,dl,Tr,Ff,jc,Rr,eo,so,qc,io;class Lg extends Df{constructor({docId:e,ownerDocument:s=globalThis.document}){super();y(this,k);y(this,kn);y(this,ta);y(this,Us);y(this,Vs);y(this,Jt);y(this,Dn);y(this,Fn,0);g(this,Vs,e),g(this,Jt,s)}addFilter(e){if(!e)return"none";let s=r(this,k,Qt).get(e);if(s)return s;const[i,n,a]=w(this,k,dl).call(this,e),o=e.length===1?i:`${i}${n}${a}`;if(s=r(this,k,Qt).get(o),s)return r(this,k,Qt).set(e,s),s;const h=`g_${r(this,Vs)}_transfer_map_${se(this,Fn)._++}`,l=w(this,k,Tr).call(this,h);r(this,k,Qt).set(e,l),r(this,k,Qt).set(o,l);const c=w(this,k,Rr).call(this,h);return w(this,k,so).call(this,i,n,a,c),l}addHCMFilter(e,s){var S;const i=`${e}-${s}`,n="base";let a=r(this,k,to).get(n);if((a==null?void 0:a.key)===i||(a?((S=a.filter)==null||S.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},r(this,k,to).set(n,a)),!e||!s))return a.url;const o=w(this,k,io).call(this,e);e=B.makeHexColor(...o);const h=w(this,k,io).call(this,s);if(s=B.makeHexColor(...h),r(this,k,Pr).style.color="",e==="#000000"&&s==="#ffffff"||e===s)return a.url;const l=new Array(256);for(let A=0;A<=255;A++){const x=A/255;l[A]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const c=l.join(","),f=`g_${r(this,Vs)}_hcm_filter`,p=a.filter=w(this,k,Rr).call(this,f);w(this,k,so).call(this,c,c,c,p),w(this,k,jc).call(this,p);const b=(A,x)=>{const C=o[A]/255,T=h[A]/255,E=new Array(x+1);for(let u=0;u<=x;u++)E[u]=C+u/x*(T-C);return E.join(",")};return w(this,k,so).call(this,b(0,5),b(1,5),b(2,5),p),a.url=w(this,k,Tr).call(this,f),a.url}addAlphaFilter(e){let s=r(this,k,Qt).get(e);if(s)return s;const[i]=w(this,k,dl).call(this,[e]),n=`alpha_${i}`;if(s=r(this,k,Qt).get(n),s)return r(this,k,Qt).set(e,s),s;const a=`g_${r(this,Vs)}_alpha_map_${se(this,Fn)._++}`,o=w(this,k,Tr).call(this,a);r(this,k,Qt).set(e,o),r(this,k,Qt).set(n,o);const h=w(this,k,Rr).call(this,a);return w(this,k,qc).call(this,i,h),o}addLuminosityFilter(e){let s=r(this,k,Qt).get(e||"luminosity");if(s)return s;let i,n;if(e?([i]=w(this,k,dl).call(this,[e]),n=`luminosity_${i}`):n="luminosity",s=r(this,k,Qt).get(n),s)return r(this,k,Qt).set(e,s),s;const a=`g_${r(this,Vs)}_luminosity_map_${se(this,Fn)._++}`,o=w(this,k,Tr).call(this,a);r(this,k,Qt).set(e,o),r(this,k,Qt).set(n,o);const h=w(this,k,Rr).call(this,a);return w(this,k,Ff).call(this,h),e&&w(this,k,qc).call(this,i,h),o}addHighlightHCMFilter(e,s,i,n,a){var T;const o=`${s}-${i}-${n}-${a}`;let h=r(this,k,to).get(e);if((h==null?void 0:h.key)===o||(h?((T=h.filter)==null||T.remove(),h.key=o,h.url="none",h.filter=null):(h={key:o,url:"none",filter:null},r(this,k,to).set(e,h)),!s||!i))return h.url;const[l,c]=[s,i].map(w(this,k,io).bind(this));let f=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),p=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[b,S]=[n,a].map(w(this,k,io).bind(this));p<f&&([f,p,b,S]=[p,f,S,b]),r(this,k,Pr).style.color="";const A=(E,u,m)=>{const v=new Array(256),_=(p-f)/m,P=E/255,R=(u-E)/(255*m);let M=0;for(let I=0;I<=m;I++){const $=Math.round(f+I*_),U=P+I*R;for(let V=M;V<=$;V++)v[V]=U;M=$+1}for(let I=M;I<256;I++)v[I]=v[M-1];return v.join(",")},x=`g_${r(this,Vs)}_hcm_${e}_filter`,C=h.filter=w(this,k,Rr).call(this,x);return w(this,k,jc).call(this,C),w(this,k,so).call(this,A(b[0],S[0],5),A(b[1],S[1],5),A(b[2],S[2],5),C),h.url=w(this,k,Tr).call(this,x),h.url}destroy(e=!1){var s,i,n,a;e&&((s=r(this,Dn))!=null&&s.size)||((i=r(this,Us))==null||i.parentNode.parentNode.remove(),g(this,Us,null),(n=r(this,ta))==null||n.clear(),g(this,ta,null),(a=r(this,Dn))==null||a.clear(),g(this,Dn,null),g(this,Fn,0))}}kn=new WeakMap,ta=new WeakMap,Us=new WeakMap,Vs=new WeakMap,Jt=new WeakMap,Dn=new WeakMap,Fn=new WeakMap,k=new WeakSet,Qt=function(){return r(this,ta)||g(this,ta,new Map)},to=function(){return r(this,Dn)||g(this,Dn,new Map)},Pr=function(){if(!r(this,Us)){const e=r(this,Jt).createElement("div"),{style:s}=e;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=r(this,Jt).createElementNS(Ms,"svg");i.setAttribute("width",0),i.setAttribute("height",0),g(this,Us,r(this,Jt).createElementNS(Ms,"defs")),e.append(i),i.append(r(this,Us)),r(this,Jt).body.append(e)}return r(this,Us)},dl=function(e){if(e.length===1){const l=e[0],c=new Array(256);for(let p=0;p<256;p++)c[p]=l[p]/255;const f=c.join(",");return[f,f,f]}const[s,i,n]=e,a=new Array(256),o=new Array(256),h=new Array(256);for(let l=0;l<256;l++)a[l]=s[l]/255,o[l]=i[l]/255,h[l]=n[l]/255;return[a.join(","),o.join(","),h.join(",")]},Tr=function(e){if(r(this,kn)===void 0){g(this,kn,"");const s=r(this,Jt).URL;s!==r(this,Jt).baseURI&&(dc(s)?q('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,kn,s.split("#",1)[0]))}return`url(${r(this,kn)}#${e})`},Ff=function(e){const s=r(this,Jt).createElementNS(Ms,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(s)},jc=function(e){const s=r(this,Jt).createElementNS(Ms,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(s)},Rr=function(e){const s=r(this,Jt).createElementNS(Ms,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",e),r(this,k,Pr).append(s),s},eo=function(e,s,i){const n=r(this,Jt).createElementNS(Ms,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),e.append(n)},so=function(e,s,i,n){const a=r(this,Jt).createElementNS(Ms,"feComponentTransfer");n.append(a),w(this,k,eo).call(this,a,"feFuncR",e),w(this,k,eo).call(this,a,"feFuncG",s),w(this,k,eo).call(this,a,"feFuncB",i)},qc=function(e,s){const i=r(this,Jt).createElementNS(Ms,"feComponentTransfer");s.append(i),w(this,k,eo).call(this,i,"feFuncA",e)},io=function(e){return r(this,k,Pr).style.color=e,Qd(getComputedStyle(r(this,k,Pr)).getPropertyValue("color"))};class Nf{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class vu extends Nf{async _fetch(t){const e=await Gh(t,"arraybuffer");return new Uint8Array(e)}}class Of{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class Su extends Of{async _fetch(t){const e=await Gh(t,"arraybuffer");return new Uint8Array(e)}}Ut&&q("Please use the `legacy` build in Node.js environments.");async function tu(d){const e=await process.getBuiltinModule("fs").promises.readFile(d);return new Uint8Array(e)}class kg extends Df{}class Dg extends Lf{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Fg extends kf{async _fetch(t){return tu(t)}}class Ng extends Nf{async _fetch(t){return tu(t)}}class Og extends Of{async _fetch(t){return tu(t)}}const Vt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Xc(d,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),d.clip(i)}class eu{isModifyingCurrentTransform(){return!1}getPattern(){at("Abstract method `getPattern` called.")}}class Bg extends eu{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let n;if(i===Vt.STROKE||i===Vt.FILL){const a=e.current.getClippedPathBoundingBox(i,ut(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,h=Math.ceil(a[3]-a[1])||1,l=e.cachedCanvases.getCanvas("pattern",o,h),c=l.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),s=B.transform(s,[1,0,0,1,a[0],a[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),Xc(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=t.createPattern(l.canvas,"no-repeat");const f=new DOMMatrix(s);n.setTransform(f)}else Xc(t,this._bbox),n=this._createGradient(t);return n}}function Ac(d,t,e,s,i,n,a,o){const h=t.coords,l=t.colors,c=d.data,f=d.width*4;let p;h[e+1]>h[s+1]&&(p=e,e=s,s=p,p=n,n=a,a=p),h[s+1]>h[i+1]&&(p=s,s=i,i=p,p=a,a=o,o=p),h[e+1]>h[s+1]&&(p=e,e=s,s=p,p=n,n=a,a=p);const b=(h[e]+t.offsetX)*t.scaleX,S=(h[e+1]+t.offsetY)*t.scaleY,A=(h[s]+t.offsetX)*t.scaleX,x=(h[s+1]+t.offsetY)*t.scaleY,C=(h[i]+t.offsetX)*t.scaleX,T=(h[i+1]+t.offsetY)*t.scaleY;if(S>=T)return;const E=l[n],u=l[n+1],m=l[n+2],v=l[a],_=l[a+1],P=l[a+2],R=l[o],M=l[o+1],I=l[o+2],$=Math.round(S),U=Math.round(T);let V,mt,F,G,me,Ts,Rs,Is;for(let Yt=$;Yt<=U;Yt++){if(Yt<x){const bt=Yt<S?0:(S-Yt)/(S-x);V=b-(b-A)*bt,mt=E-(E-v)*bt,F=u-(u-_)*bt,G=m-(m-P)*bt}else{let bt;Yt>T?bt=1:x===T?bt=0:bt=(x-Yt)/(x-T),V=A-(A-C)*bt,mt=v-(v-R)*bt,F=_-(_-M)*bt,G=P-(P-I)*bt}let St;Yt<S?St=0:Yt>T?St=1:St=(S-Yt)/(S-T),me=b-(b-C)*St,Ts=E-(E-R)*St,Rs=u-(u-M)*St,Is=m-(m-I)*St;const _r=Math.round(Math.min(V,me)),mi=Math.round(Math.max(V,me));let os=f*Yt+_r*4;for(let bt=_r;bt<=mi;bt++)St=(V-bt)/(V-me),St<0?St=0:St>1&&(St=1),c[os++]=mt-(mt-Ts)*St|0,c[os++]=F-(F-Rs)*St|0,c[os++]=G-(G-Is)*St|0,c[os++]=255}}function Hg(d,t,e){const s=t.coords,i=t.colors;let n,a;switch(t.type){case"lattice":const o=t.verticesPerRow,h=Math.floor(s.length/o)-1,l=o-1;for(n=0;n<h;n++){let c=n*o;for(let f=0;f<l;f++,c++)Ac(d,e,s[c],s[c+1],s[c+o],i[c],i[c+1],i[c+o]),Ac(d,e,s[c+o+1],s[c+1],s[c+o],i[c+o+1],i[c+1],i[c+o])}break;case"triangles":for(n=0,a=s.length;n<a;n+=3)Ac(d,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class $g extends eu{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const o=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-h,f=Math.min(Math.ceil(Math.abs(l*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),b=l/f,S=c/p,A={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-h,scaleX:1/b,scaleY:1/S},x=f+2*2,C=p+2*2,T=s.getCanvas("mesh",x,C),E=T.context,u=E.createImageData(f,p);if(e){const v=u.data;for(let _=0,P=v.length;_<P;_+=4)v[_]=e[0],v[_+1]=e[1],v[_+2]=e[2],v[_+3]=255}for(const v of this._figures)Hg(u,v,A);return E.putImageData(u,2,2),{canvas:T.canvas,offsetX:o-2*b,offsetY:h-2*S,scaleX:b,scaleY:S}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){Xc(t,this._bbox);let n;if(i===Vt.SHADING)n=B.singularValueDecompose2dScale(ut(t));else if(n=B.singularValueDecompose2dScale(e.baseTransform),this.matrix){const o=B.singularValueDecompose2dScale(this.matrix);n=[n[0]*o[0],n[1]*o[1]]}const a=this._createMeshCanvas(n,i===Vt.SHADING?null:this._background,e.cachedCanvases);return i!==Vt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class Gg extends eu{getPattern(){return"hotpink"}}function zg(d){switch(d[0]){case"RadialAxial":return new Bg(d);case"Mesh":return new $g(d);case"Dummy":return new Gg}throw new Error(`Unknown IR type: ${d[0]}`)}const _u={COLORED:1,UNCOLORED:2},Kl=class Kl{constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:n,color:a,canvasGraphicsFactory:o}=this;let{xstep:h,ystep:l}=this;h=Math.abs(h),l=Math.abs(l),cc("TilingType: "+n);const c=e[0],f=e[1],p=e[2],b=e[3],S=p-c,A=b-f,x=B.singularValueDecompose2dScale(this.matrix),C=B.singularValueDecompose2dScale(this.baseTransform),T=x[0]*C[0],E=x[1]*C[1];let u=S,m=A,v=!1,_=!1;const P=Math.ceil(h*T),R=Math.ceil(l*E),M=Math.ceil(S*T),I=Math.ceil(A*E);P>=M?u=h:v=!0,R>=I?m=l:_=!0;const $=this.getSizeAndScale(u,this.ctx.canvas.width,T),U=this.getSizeAndScale(m,this.ctx.canvas.height,E),V=t.cachedCanvases.getCanvas("pattern",$.size,U.size),mt=V.context,F=o.createCanvasGraphics(mt);if(F.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(F,i,a),mt.translate(-$.scale*c,-U.scale*f),F.transform($.scale,0,0,U.scale,0,0),mt.save(),this.clipBbox(F,c,f,p,b),F.baseTransform=ut(F.ctx),F.executeOperatorList(s),F.endDrawing(),mt.restore(),v||_){const G=V.canvas;v&&(u=h),_&&(m=l);const me=this.getSizeAndScale(u,this.ctx.canvas.width,T),Ts=this.getSizeAndScale(m,this.ctx.canvas.height,E),Rs=me.size,Is=Ts.size,Yt=t.cachedCanvases.getCanvas("pattern-workaround",Rs,Is),St=Yt.context,_r=v?Math.floor(S/h):0,mi=_?Math.floor(A/l):0;for(let os=0;os<=_r;os++)for(let bt=0;bt<=mi;bt++)St.drawImage(G,Rs*os,Is*bt,Rs,Is,0,0,Rs,Is);return{canvas:Yt.canvas,scaleX:me.scale,scaleY:Ts.scale,offsetX:c,offsetY:f}}return{canvas:V.canvas,scaleX:$.scale,scaleY:U.scale,offsetX:c,offsetY:f}}getSizeAndScale(t,e,s){const i=Math.max(Kl.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const a=i-e,o=n-s;t.ctx.rect(e,s,a,o),t.current.updateRectMinMax(ut(t.ctx),[e,s,i,n]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case _u.COLORED:const a=this.ctx;i.fillStyle=a.fillStyle,i.strokeStyle=a.strokeStyle,n.fillColor=a.fillStyle,n.strokeColor=a.strokeStyle;break;case _u.UNCOLORED:const o=B.makeHexColor(s[0],s[1],s[2]);i.fillStyle=o,i.strokeStyle=o,n.fillColor=o,n.strokeColor=o;break;default:throw new fg(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i){let n=s;i!==Vt.SHADING&&(n=B.transform(n,e.baseTransform),this.matrix&&(n=B.transform(n,this.matrix)));const a=this.createPatternCanvas(e);let o=new DOMMatrix(n);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const h=t.createPattern(a.canvas,"repeat");return h.setTransform(o),h}};O(Kl,"MAX_PATTERN_SIZE",3e3);let Yc=Kl;function Wg({src:d,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=Xt.isLittleEndian?4278190080:255,[h,l]=a?[n,o]:[o,n],c=s>>3,f=s&7,p=d.length;e=new Uint32Array(e.buffer);let b=0;for(let S=0;S<i;S++){for(const x=t+c;t<x;t++){const C=t<p?d[t]:255;e[b++]=C&128?l:h,e[b++]=C&64?l:h,e[b++]=C&32?l:h,e[b++]=C&16?l:h,e[b++]=C&8?l:h,e[b++]=C&4?l:h,e[b++]=C&2?l:h,e[b++]=C&1?l:h}if(f===0)continue;const A=t<p?d[t++]:255;for(let x=0;x<f;x++)e[b++]=A&1<<7-x?l:h}return{srcPos:t,destPos:b}}const xu=16,Eu=100,Ug=15,Cu=10,Pu=1e3,ge=16,vc=new DOMMatrix;function Vg(d,t){if(d._removeMirroring)throw new Error("Context is already forwarding operations.");d.__originalSave=d.save,d.__originalRestore=d.restore,d.__originalRotate=d.rotate,d.__originalScale=d.scale,d.__originalTranslate=d.translate,d.__originalTransform=d.transform,d.__originalSetTransform=d.setTransform,d.__originalResetTransform=d.resetTransform,d.__originalClip=d.clip,d.__originalMoveTo=d.moveTo,d.__originalLineTo=d.lineTo,d.__originalBezierCurveTo=d.bezierCurveTo,d.__originalRect=d.rect,d.__originalClosePath=d.closePath,d.__originalBeginPath=d.beginPath,d._removeMirroring=()=>{d.save=d.__originalSave,d.restore=d.__originalRestore,d.rotate=d.__originalRotate,d.scale=d.__originalScale,d.translate=d.__originalTranslate,d.transform=d.__originalTransform,d.setTransform=d.__originalSetTransform,d.resetTransform=d.__originalResetTransform,d.clip=d.__originalClip,d.moveTo=d.__originalMoveTo,d.lineTo=d.__originalLineTo,d.bezierCurveTo=d.__originalBezierCurveTo,d.rect=d.__originalRect,d.closePath=d.__originalClosePath,d.beginPath=d.__originalBeginPath,delete d._removeMirroring},d.save=function(){t.save(),this.__originalSave()},d.restore=function(){t.restore(),this.__originalRestore()},d.translate=function(s,i){t.translate(s,i),this.__originalTranslate(s,i)},d.scale=function(s,i){t.scale(s,i),this.__originalScale(s,i)},d.transform=function(s,i,n,a,o,h){t.transform(s,i,n,a,o,h),this.__originalTransform(s,i,n,a,o,h)},d.setTransform=function(s,i,n,a,o,h){t.setTransform(s,i,n,a,o,h),this.__originalSetTransform(s,i,n,a,o,h)},d.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},d.rotate=function(s){t.rotate(s),this.__originalRotate(s)},d.clip=function(s){t.clip(s),this.__originalClip(s)},d.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},d.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},d.bezierCurveTo=function(e,s,i,n,a,o){t.bezierCurveTo(e,s,i,n,a,o),this.__originalBezierCurveTo(e,s,i,n,a,o)},d.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},d.closePath=function(){t.closePath(),this.__originalClosePath()},d.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class jg{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Yh(d,t,e,s,i,n,a,o,h,l){const[c,f,p,b,S,A]=ut(d);if(f===0&&p===0){const T=a*c+S,E=Math.round(T),u=o*b+A,m=Math.round(u),v=(a+h)*c+S,_=Math.abs(Math.round(v)-E)||1,P=(o+l)*b+A,R=Math.abs(Math.round(P)-m)||1;return d.setTransform(Math.sign(c),0,0,Math.sign(b),E,m),d.drawImage(t,e,s,i,n,0,0,_,R),d.setTransform(c,f,p,b,S,A),[_,R]}if(c===0&&b===0){const T=o*p+S,E=Math.round(T),u=a*f+A,m=Math.round(u),v=(o+l)*p+S,_=Math.abs(Math.round(v)-E)||1,P=(a+h)*f+A,R=Math.abs(Math.round(P)-m)||1;return d.setTransform(0,Math.sign(f),Math.sign(p),0,E,m),d.drawImage(t,e,s,i,n,0,0,R,_),d.setTransform(c,f,p,b,S,A),[R,_]}d.drawImage(t,e,s,i,n,a,o,h,l);const x=Math.hypot(c,f),C=Math.hypot(p,b);return[x*h,C*l]}function qg(d){const{width:t,height:e}=d;if(t>Pu||e>Pu)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1,a=new Uint8Array(n*(e+1));let o,h,l;const c=t+7&-8,f=new Uint8Array(c*e);let p=0;for(const v of d.data){let _=128;for(;_>0;)f[p++]=v&_?0:255,_>>=1}let b=0;for(p=0,f[p]!==0&&(a[0]=1,++b),h=1;h<t;h++)f[p]!==f[p+1]&&(a[h]=f[p]?2:1,++b),p++;for(f[p]!==0&&(a[h]=2,++b),o=1;o<e;o++){p=o*c,l=o*n,f[p-c]!==f[p]&&(a[l]=f[p]?1:8,++b);let v=(f[p]?4:0)+(f[p-c]?8:0);for(h=1;h<t;h++)v=(v>>2)+(f[p+1]?4:0)+(f[p-c+1]?8:0),i[v]&&(a[l+h]=i[v],++b),p++;if(f[p-c]!==f[p]&&(a[l+h]=f[p]?2:4,++b),b>s)return null}for(p=c*(e-1),l=o*n,f[p]!==0&&(a[l]=8,++b),h=1;h<t;h++)f[p]!==f[p+1]&&(a[l+h]=f[p]?4:8,++b),p++;if(f[p]!==0&&(a[l+h]=4,++b),b>s)return null;const S=new Int32Array([0,n,-1,0,-n,0,0,0,1]),A=new Path2D,{a:x,b:C,c:T,d:E,e:u,f:m}=new DOMMatrix().scaleSelf(1/t,-1/e).translateSelf(0,-e);for(o=0;b&&o<=e;o++){let v=o*n;const _=v+t;for(;v<_&&!a[v];)v++;if(v===_)continue;let P=v%n,R=o;A.moveTo(x*P+T*R+u,C*P+E*R+m);const M=v;let I=a[v];do{const $=S[I];do v+=$;while(!a[v]);const U=a[v];U!==5&&U!==10?(I=U,a[v]=0):(I=U&51*I>>4,a[v]&=I>>2|I<<2),P=v%n,R=v/n|0,A.lineTo(x*P+T*R+u,C*P+E*R+m),a[v]||--b}while(M!==v);--o}return A}class Tu{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Vu,this.textMatrixScale=1,this.fontMatrix=Ec,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Kt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}updateRectMinMax(t,e){const s=B.applyTransform(e,t),i=B.applyTransform(e.slice(2),t),n=B.applyTransform([e[0],e[3]],t),a=B.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],n[0],a[0]),this.minY=Math.min(this.minY,s[1],i[1],n[1],a[1]),this.maxX=Math.max(this.maxX,s[0],i[0],n[0],a[0]),this.maxY=Math.max(this.maxY,s[1],i[1],n[1],a[1])}getPathBoundingBox(t=Vt.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===Vt.STROKE){e||at("Stroke bounding box must include transform.");const i=B.singularValueDecompose2dScale(e),n=i[0]*this.lineWidth/2,a=i[1]*this.lineWidth/2;s[0]-=n,s[1]-=a,s[2]+=n,s[3]+=a}return s}updateClipFromPath(){const t=B.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Vt.FILL,e=null){return B.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Ru(d,t){if(t instanceof ImageData){d.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%ge,n=(e-i)/ge,a=i===0?n:n+1,o=d.createImageData(s,ge);let h=0,l;const c=t.data,f=o.data;let p,b,S,A;if(t.kind===el.GRAYSCALE_1BPP){const x=c.byteLength,C=new Uint32Array(f.buffer,0,f.byteLength>>2),T=C.length,E=s+7>>3,u=4294967295,m=Xt.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(S=p<n?ge:i,l=0,b=0;b<S;b++){const v=x-h;let _=0;const P=v>E?s:v*8-7,R=P&-8;let M=0,I=0;for(;_<R;_+=8)I=c[h++],C[l++]=I&128?u:m,C[l++]=I&64?u:m,C[l++]=I&32?u:m,C[l++]=I&16?u:m,C[l++]=I&8?u:m,C[l++]=I&4?u:m,C[l++]=I&2?u:m,C[l++]=I&1?u:m;for(;_<P;_++)M===0&&(I=c[h++],M=128),C[l++]=I&M?u:m,M>>=1}for(;l<T;)C[l++]=0;d.putImageData(o,0,p*ge)}}else if(t.kind===el.RGBA_32BPP){for(b=0,A=s*ge*4,p=0;p<n;p++)f.set(c.subarray(h,h+A)),h+=A,d.putImageData(o,0,b),b+=ge;p<a&&(A=s*i*4,f.set(c.subarray(h,h+A)),d.putImageData(o,0,b))}else if(t.kind===el.RGB_24BPP)for(S=ge,A=s*S,p=0;p<a;p++){for(p>=n&&(S=i,A=s*S),l=0,b=A;b--;)f[l++]=c[h++],f[l++]=c[h++],f[l++]=c[h++],f[l++]=255;d.putImageData(o,0,p*ge)}else throw new Error(`bad image kind: ${t.kind}`)}function Iu(d,t){if(t.bitmap){d.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%ge,n=(e-i)/ge,a=i===0?n:n+1,o=d.createImageData(s,ge);let h=0;const l=t.data,c=o.data;for(let f=0;f<a;f++){const p=f<n?ge:i;({srcPos:h}=Wg({src:l,srcPos:h,dest:c,width:s,height:p,nonBlackColor:0})),d.putImageData(o,0,f*ge)}}function Ua(d,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)d[s]!==void 0&&(t[s]=d[s]);d.setLineDash!==void 0&&(t.setLineDash(d.getLineDash()),t.lineDashOffset=d.lineDashOffset)}function Kh(d){if(d.strokeStyle=d.fillStyle="#000000",d.fillRule="nonzero",d.globalAlpha=1,d.lineWidth=1,d.lineCap="butt",d.lineJoin="miter",d.miterLimit=10,d.globalCompositeOperation="source-over",d.font="10px sans-serif",d.setLineDash!==void 0&&(d.setLineDash([]),d.lineDashOffset=0),!Ut){const{filter:t}=d;t!=="none"&&t!==""&&(d.filter="none")}}function Mu(d,t){if(t)return!0;const e=B.singularValueDecompose2dScale(d);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const s=Math.fround(pi.pixelRatio*sn.PDF_TO_CSS_UNITS);return e[0]<=s&&e[1]<=s}const Xg=["butt","round","square"],Yg=["miter","round","bevel"],Kg={},Lu={};var as,Kc,Qc,Zc;const cu=class cu{constructor(t,e,s,i,n,{optionalContentConfig:a,markedContentStack:o=null},h,l){y(this,as);this.ctx=t,this.current=new Tu(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new jg(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,s){const h=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...ut(this.compositeCtx))}this.ctx.save(),Kh(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=ut(this.ctx)}executeOperatorList(t,e,s,i){const n=t.argsArray,a=t.fnArray;let o=e||0;const h=n.length;if(h===o)return o;const l=h-o>Cu&&typeof s=="function",c=l?Date.now()+Ug:0;let f=0;const p=this.commonObjs,b=this.objs;let S;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(S=a[o],S!==Ll.dependency)this[S].apply(this,n[o]);else for(const A of n[o]){const x=A.startsWith("g_")?p:b;if(!x.has(A))return x.get(A,s),o}if(o++,o===h)return o;if(l&&++f>Cu){if(Date.now()>c)return s(),o;f=0}}}endDrawing(){w(this,as,Kc).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),w(this,as,Qc).call(this)}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=s,h=i,l="prescale1",c,f;for(;n>2&&o>1||a>2&&h>1;){let p=o,b=h;n>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/p),a>2&&h>1&&(b=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,a/=h/b),c=this.cachedCanvases.getCanvas(l,p,b),f=c.context,f.clearRect(0,0,p,b),f.drawImage(t,0,0,o,h,0,0,p,b),t=c.canvas,o=p,h=b,l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:h}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:i}=t,n=this.current.fillColor,a=this.current.patternFill,o=ut(e);let h,l,c,f;if((t.bitmap||t.data)&&t.count>1){const P=t.bitmap||t.data.buffer;l=JSON.stringify(a?o:[o.slice(0,4),n]),h=this._cachedBitmapsMap.get(P),h||(h=new Map,this._cachedBitmapsMap.set(P,h));const R=h.get(l);if(R&&!a){const M=Math.round(Math.min(o[0],o[2])+o[4]),I=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:R,offsetX:M,offsetY:I}}c=R}c||(f=this.cachedCanvases.getCanvas("maskCanvas",s,i),Iu(f.context,t));let p=B.transform(o,[1/s,0,0,-1/i,0,0]);p=B.transform(p,[1,0,0,1,0,-i]);const[b,S,A,x]=B.getAxialAlignedBoundingBox([0,0,s,i],p),C=Math.round(A-b)||1,T=Math.round(x-S)||1,E=this.cachedCanvases.getCanvas("fillCanvas",C,T),u=E.context,m=b,v=S;u.translate(-m,-v),u.transform(...p),c||(c=this._scaleImage(f.canvas,hs(u)),c=c.img,h&&a&&h.set(l,c)),u.imageSmoothingEnabled=Mu(ut(u),t.interpolate),Yh(u,c,0,0,c.width,c.height,0,0,s,i),u.globalCompositeOperation="source-in";const _=B.transform(hs(u),[1,0,0,1,-m,-v]);return u.fillStyle=a?n.getPattern(e,this,_,Vt.FILL):n,u.fillRect(0,0,s,i),h&&!a&&(this.cachedCanvases.delete("fillCanvas"),h.set(l,E.canvas)),{canvas:E.canvas,offsetX:Math.round(m),offsetY:Math.round(v)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Xg[t]}setLineJoin(t){this.ctx.lineJoin=Yg[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx;const n=this.ctx=i.context;n.setTransform(this.suspendedCtx.getTransform()),Ua(this.suspendedCtx,n),Vg(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ua(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],a=i[1],o=i[2]-n,h=i[3]-a;o===0||h===0||(this.genericComposeSMask(e.context,s,o,h,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,a,o,h,l,c,f){let p=t.canvas,b=h-c,S=l-f;if(a){const x=B.makeHexColor(...a);if(b<0||S<0||b+s>p.width||S+i>p.height){const C=this.cachedCanvases.getCanvas("maskExtension",s,i),T=C.context;T.drawImage(p,-b,-S),T.globalCompositeOperation="destination-atop",T.fillStyle=x,T.fillRect(0,0,s,i),T.globalCompositeOperation="source-over",p=C.canvas,b=S=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const C=new Path2D;C.rect(b,S,s,i),t.clip(C),t.globalCompositeOperation="destination-atop",t.fillStyle=x,t.fillRect(b,S,s,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const A=new Path2D;A.rect(h,l,s,i),e.clip(A),e.globalCompositeOperation="destination-in",e.drawImage(p,b,S,s,i,h,l,s,i),e.restore()}save(){this.inSMaskMode&&Ua(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Ua(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,a){this.ctx.transform(t,e,s,i,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){let[i]=e;if(!s){i||(i=e[0]=new Path2D),this[t](i);return}if(!(i instanceof Path2D)){const n=e[0]=new Path2D;for(let a=0,o=i.length;a<o;)switch(i[a++]){case qh.moveTo:n.moveTo(i[a++],i[a++]);break;case qh.lineTo:n.lineTo(i[a++],i[a++]);break;case qh.curveTo:n.bezierCurveTo(i[a++],i[a++],i[a++],i[a++],i[a++],i[a++]);break;case qh.closePath:n.closePath();break;default:q(`Unrecognized drawing path operator: ${i[a-1]}`);break}i=n}this.current.updateRectMinMax(ut(this.ctx),s),this[t](i)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const s=this.ctx,i=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&(i!=null&&i.getPattern)){const n=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=i.getPattern(s,this,hs(s),Vt.STROKE),n){const a=new Path2D;a.addPath(t,s.getTransform().invertSelf().multiplySelf(n)),t=a}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(Vt.STROKE,ut(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;let a=!1;if(n){const h=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=i.getPattern(s,this,hs(s),Vt.FILL),h){const l=new Path2D;l.addPath(t,s.getTransform().invertSelf().multiplySelf(h)),t=l}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),a&&s.restore(),e&&this.consumePath(t,o)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}clip(){this.pendingClip=Kg}eoClip(){this.pendingClip=Lu}beginText(){this.current.textMatrix=Vu,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}const s=new Path2D,i=e.getTransform().invertSelf();for(const{transform:n,x:a,y:o,fontSize:h,path:l}of t)s.addPath(l,new DOMMatrix(n).preMultiplySelf(i).translate(a,o).scale(h,-h));e.clip(s),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var c;const s=this.commonObjs.get(t),i=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=s.fontMatrix||Ec,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&q("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=e,s.isType3Font)return;const n=s.loadedName||"sans-serif",a=((c=s.systemFontInfo)==null?void 0:c.css)||`"${n}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const h=s.italic?"italic":"normal";let l=e;e<xu?l=xu:e>Eu&&(l=Eu),this.current.fontSizeScale=e/l,this.ctx.font=`${h} ${o} ${l}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,i,n,a){this.current.textMatrix=[t,e,s,i,n,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,i,n){const a=this.ctx,o=this.current,h=o.font,l=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,f=l&Kt.FILL_STROKE_MASK,p=!!(l&Kt.ADD_TO_PATH_FLAG),b=o.patternFill&&!h.missingFile,S=o.patternStroke&&!h.missingFile;let A;if((h.disableFontFace||p||b||S)&&(A=h.getPathGenerator(this.commonObjs,t)),h.disableFontFace||b||S){a.save(),a.translate(e,s),a.scale(c,-c);let x;if((f===Kt.FILL||f===Kt.FILL_STROKE)&&(i?(x=a.getTransform(),a.setTransform(...i),a.fill(w(this,as,Zc).call(this,A,x,i))):a.fill(A)),f===Kt.STROKE||f===Kt.FILL_STROKE)if(n){x||(x=a.getTransform()),a.setTransform(...n);const{a:C,b:T,c:E,d:u}=x,m=B.inverseTransform(n),v=B.transform([C,T,E,u,0,0],m),[_,P]=B.singularValueDecompose2dScale(v);a.lineWidth*=Math.max(_,P)/c,a.stroke(w(this,as,Zc).call(this,A,x,n))}else a.lineWidth/=c,a.stroke(A);a.restore()}else(f===Kt.FILL||f===Kt.FILL_STROKE)&&a.fillText(t,e,s),(f===Kt.STROKE||f===Kt.FILL_STROKE)&&a.strokeText(t,e,s);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ut(a),x:e,y:s,fontSize:c,path:A})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return Q(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(i===0)return;const n=this.ctx,a=e.fontSizeScale,o=e.charSpacing,h=e.wordSpacing,l=e.fontDirection,c=e.textHScale*l,f=t.length,p=s.vertical,b=p?1:-1,S=s.defaultVMetrics,A=i*e.fontMatrix[0],x=e.textRenderingMode===Kt.FILL&&!s.disableFontFace&&!e.patternFill;n.save(),n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),l>0?n.scale(c,-1):n.scale(c,1);let C,T;if(e.patternFill){n.save();const _=e.fillColor.getPattern(n,this,hs(n),Vt.FILL);C=ut(n),n.restore(),n.fillStyle=_}if(e.patternStroke){n.save();const _=e.strokeColor.getPattern(n,this,hs(n),Vt.STROKE);T=ut(n),n.restore(),n.strokeStyle=_}let E=e.lineWidth;const u=e.textMatrixScale;if(u===0||E===0){const _=e.textRenderingMode&Kt.FILL_STROKE_MASK;(_===Kt.STROKE||_===Kt.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=u;if(a!==1&&(n.scale(a,a),E/=a),n.lineWidth=E,s.isInvalidPDFjsFont){const _=[];let P=0;for(const R of t)_.push(R.unicode),P+=R.width;n.fillText(_.join(""),0,0),e.x+=P*A*c,n.restore(),this.compose();return}let m=0,v;for(v=0;v<f;++v){const _=t[v];if(typeof _=="number"){m+=b*_*i/1e3;continue}let P=!1;const R=(_.isSpace?h:0)+o,M=_.fontChar,I=_.accent;let $,U,V=_.width;if(p){const F=_.vmetric||S,G=-(_.vmetric?F[1]:V*.5)*A,me=F[2]*A;V=F?-F[0]:V,$=G/a,U=(m+me)/a}else $=m/a,U=0;if(s.remeasure&&V>0){const F=n.measureText(M).width*1e3/i*a;if(V<F&&this.isFontSubpixelAAEnabled){const G=V/F;P=!0,n.save(),n.scale(G,1),$/=G}else V!==F&&($+=(V-F)/2e3*i/a)}if(this.contentVisible&&(_.isInFont||s.missingFile)){if(x&&!I)n.fillText(M,$,U);else if(this.paintChar(M,$,U,C,T),I){const F=$+i*I.offset.x/a,G=U-i*I.offset.y/a;this.paintChar(I.fontChar,F,G,C,T)}}const mt=p?V*A-R*l:V*A+R*l;m+=mt,P&&n.restore()}p?e.y-=m:e.x+=m*c,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,i=s.font,n=s.fontSize,a=s.fontDirection,o=i.vertical?1:-1,h=s.charSpacing,l=s.wordSpacing,c=s.textHScale*a,f=s.fontMatrix||Ec,p=t.length,b=s.textRenderingMode===Kt.INVISIBLE;let S,A,x,C;if(!(b||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...s.textMatrix),e.translate(s.x,s.y+s.textRise),e.scale(c,a),S=0;S<p;++S){if(A=t[S],typeof A=="number"){C=o*A*n/1e3,this.ctx.translate(C,0),s.x+=C*c;continue}const T=(A.isSpace?l:0)+h,E=i.charProcOperatorList[A.operatorListId];E?this.contentVisible&&(this.processingType3=A,this.save(),e.scale(n,n),e.transform(...f),this.executeOperatorList(E),this.restore()):q(`Type3 character "${A.operatorListId}" is not available.`),x=B.applyTransform([A.width,0],f)[0]*n+T,e.translate(x,0),s.x+=x*c}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,n,a){this.ctx.rect(s,i,n-s,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=this.baseTransform||ut(this.ctx),i={createCanvasGraphics:n=>new cu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Yc(t,this.ctx,i,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=B.makeHexColor(t,e,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=B.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=zg(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,hs(e),Vt.SHADING);const i=hs(e);if(i){const{width:n,height:a}=e.canvas,[o,h,l,c]=B.getAxialAlignedBoundingBox([0,0,n,a],i);this.ctx.fillRect(o,h,l-o,c-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){at("Should not call beginInlineImage")}beginImageData(){at("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=ut(this.ctx),e)){const s=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],s,i),this.current.updateRectMinMax(ut(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||cc("TODO: Support non-isolated groups."),t.knockout&&q("Knockout groups not supported.");const s=ut(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=B.getAxialAlignedBoundingBox(t.bbox,ut(e));const n=[0,0,e.canvas.width,e.canvas.height];i=B.intersect(i,n)||[0,0,0,0];const a=Math.floor(i[0]),o=Math.floor(i[1]),h=Math.max(Math.ceil(i[2])-a,1),l=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,h,l]);let c="groupAt"+this.groupLevel;t.smask&&(c+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(c,h,l),p=f.context;p.translate(-a,-o),p.transform(...s);let b=new Path2D;const[S,A,x,C]=t.bbox;if(b.rect(S,A,x-S,C-A),t.matrix){const T=new Path2D;T.addPath(b,new DOMMatrix(t.matrix)),b=T}p.clip(b),t.smask?this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),Ua(e,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=ut(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const n=B.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,s,i,n){if(w(this,as,Kc).call(this),Kh(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o;const[h,l]=B.singularValueDecompose2dScale(ut(this.ctx)),{viewportScale:c}=this,f=Math.ceil(a*this.outputScaleX*c),p=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(f,p);const{canvas:b,context:S}=this.annotationCanvas;this.annotationCanvasMap.set(t,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=S,this.ctx.save(),this.ctx.setTransform(h,0,0,-l,0,o*l),Kh(this.ctx)}else Kh(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new Tu(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),w(this,as,Qc).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=qg(t)),i.compiled)){s.fill(i.compiled);return}const n=this._createMaskCanvas(t),a=n.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,n.offsetX,n.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const h=ut(o);o.transform(e,s,i,n,0,0);const l=this._createMaskCanvas(t);o.setTransform(1,0,0,1,l.offsetX-h[4],l.offsetY-h[5]);for(let c=0,f=a.length;c<f;c+=2){const p=B.transform(h,[e,s,i,n,a[c],a[c+1]]),[b,S]=B.applyTransform([0,0],p);o.drawImage(l.canvas,b,S)}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const n of t){const{data:a,width:o,height:h,transform:l}=n,c=this.cachedCanvases.getCanvas("maskCanvas",o,h),f=c.context;f.save();const p=this.getObject(a,n);Iu(f,p),f.globalCompositeOperation="source-in",f.fillStyle=i?s.getPattern(f,this,hs(e),Vt.FILL):s,f.fillRect(0,0,o,h),f.restore(),e.save(),e.transform(...l),e.scale(1,-1),Yh(e,c.canvas,0,0,o,h,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){q("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){q("Dependent image isn't ready yet");return}const a=n.width,o=n.height,h=[];for(let l=0,c=i.length;l<c;l+=2)h.push({transform:[e,0,0,s,i[l],i[l+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,i=this.ctx;if(this.save(),!Ut){const{filter:o}=i;o!=="none"&&o!==""&&(i.filter="none")}i.scale(1/e,-1/s);let n;if(t.bitmap)n=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)n=t;else{const h=this.cachedCanvases.getCanvas("inlineImage",e,s).context;Ru(h,t),n=this.applyTransferMapsToCanvas(h)}const a=this._scaleImage(n,hs(i));i.imageSmoothingEnabled=Mu(ut(i),t.interpolate),Yh(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const n=t.width,a=t.height,h=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Ru(h,t),i=this.applyTransferMapsToCanvas(h)}for(const n of e)s.save(),s.transform(...n.transform),s.scale(1,-1),Yh(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(s||(this.pendingClip===Lu?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=ut(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const h=Math.abs(e),l=Math.abs(n);if(h===l)if(t===0)a=o=1/h;else{const c=h*t;a=o=c<1?1/c:1}else if(t===0)a=1/h,o=1/l;else{const c=h*t,f=l*t;a=c<1?1/c:1,o=f<1?1/f:1}}else{const h=Math.abs(e*n-s*i),l=Math.hypot(e,s),c=Math.hypot(i,n);if(t===0)a=c/h,o=l/h;else{const f=t*h;a=c>f?c/f:1,o=l>f?l/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,a]=this.getScaleForStroking();if(n===a){s.lineWidth=(i||1)*n,s.stroke(t);return}const o=s.getLineDash();e&&s.save(),s.scale(n,a),vc.a=1/n,vc.d=1/a;const h=new Path2D;if(h.addPath(t,vc),o.length>0){const l=Math.max(n,a);s.setLineDash(o.map(c=>c/l)),s.lineDashOffset/=l}s.lineWidth=i||1,s.stroke(h),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};as=new WeakSet,Kc=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Qc=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},Zc=function(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i};let Fr=cu;for(const d in Ll)Fr.prototype[d]!==void 0&&(Fr.prototype[Ll[d]]=Fr.prototype[d]);var Wo,Uo;class li{static get workerPort(){return r(this,Wo)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");g(this,Wo,t)}static get workerSrc(){return r(this,Uo)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");g(this,Uo,t)}}Wo=new WeakMap,Uo=new WeakMap,y(li,Wo,null),y(li,Uo,"");var Nn,Vo;class Qg{constructor({parsedData:t,rawData:e}){y(this,Nn);y(this,Vo);g(this,Nn,t),g(this,Vo,e)}getRaw(){return r(this,Vo)}get(t){return r(this,Nn).get(t)??null}getAll(){return jd(r(this,Nn))}has(t){return r(this,Nn).has(t)}}Nn=new WeakMap,Vo=new WeakMap;const Ir=Symbol("INTERNAL");var jo,qo,Xo,ea;class Zg{constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){y(this,jo,!1);y(this,qo,!1);y(this,Xo,!1);y(this,ea,!0);g(this,jo,!!(t&Me.DISPLAY)),g(this,qo,!!(t&Me.PRINT)),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(r(this,Xo))return r(this,ea);if(!r(this,ea))return!1;const{print:t,view:e}=this.usage;return r(this,jo)?(e==null?void 0:e.viewState)!=="OFF":r(this,qo)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,s=!1){t!==Ir&&at("Internal method `_setVisible` called."),g(this,Xo,s),g(this,ea,e)}}jo=new WeakMap,qo=new WeakMap,Xo=new WeakMap,ea=new WeakMap;var Di,nt,sa,ia,Yo,Jc;class Jg{constructor(t,e=Me.DISPLAY){y(this,Yo);y(this,Di,null);y(this,nt,new Map);y(this,sa,null);y(this,ia,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,g(this,ia,t.order);for(const s of t.groups)r(this,nt).set(s.id,new Zg(e,s));if(t.baseState==="OFF")for(const s of r(this,nt).values())s._setVisible(Ir,!1);for(const s of t.on)r(this,nt).get(s)._setVisible(Ir,!0);for(const s of t.off)r(this,nt).get(s)._setVisible(Ir,!1);g(this,sa,this.getHash())}}isVisible(t){if(r(this,nt).size===0)return!0;if(!t)return cc("Optional content group not defined."),!0;if(t.type==="OCG")return r(this,nt).has(t.id)?r(this,nt).get(t.id).visible:(q(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return w(this,Yo,Jc).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!r(this,nt).has(e))return q(`Optional content group not found: ${e}`),!0;if(r(this,nt).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!r(this,nt).has(e))return q(`Optional content group not found: ${e}`),!0;if(!r(this,nt).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!r(this,nt).has(e))return q(`Optional content group not found: ${e}`),!0;if(!r(this,nt).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!r(this,nt).has(e))return q(`Optional content group not found: ${e}`),!0;if(r(this,nt).get(e).visible)return!1}return!0}return q(`Unknown optional content policy ${t.policy}.`),!0}return q(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){var n;const i=r(this,nt).get(t);if(!i){q(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==t&&((n=r(this,nt).get(o))==null||n._setVisible(Ir,!1,!0));i._setVisible(Ir,!!e,!0),g(this,Di,null)}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=r(this,nt).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}g(this,Di,null)}get hasInitialVisibility(){return r(this,sa)===null||this.getHash()===r(this,sa)}getOrder(){return r(this,nt).size?r(this,ia)?r(this,ia).slice():[...r(this,nt).keys()]:null}getGroups(){return r(this,nt).size>0?jd(r(this,nt)):null}getGroup(t){return r(this,nt).get(t)||null}getHash(){if(r(this,Di)!==null)return r(this,Di);const t=new Cf;for(const[e,s]of r(this,nt))t.update(`${e}:${s.visible}`);return g(this,Di,t.hexdigest())}}Di=new WeakMap,nt=new WeakMap,sa=new WeakMap,ia=new WeakMap,Yo=new WeakSet,Jc=function(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let a;if(Array.isArray(n))a=w(this,Yo,Jc).call(this,n);else if(r(this,nt).has(n))a=r(this,nt).get(n).visible;else return q(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class tm{constructor(t,{disableRange:e=!1,disableStream:s=!1}){Ct(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const h=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((h,l)=>{this._onReceiveData({begin:h,chunk:l})}),t.addProgressListener((h,l)=>{this._onProgress({loaded:h,total:l})}),t.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(s),!0)});Ct(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,s,i,n;t.total===void 0?(s=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||s.call(e,{loaded:t.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ct(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new em(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new sm(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeReaders.slice(0))s.cancel(t);this._pdfDataRangeTransport.abort()}}class em{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Yd(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class sm{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function im(d){let t=!0,e=s("filename\\*","i").exec(d);if(e){e=e[1];let c=o(e);return c=unescape(c),c=h(c),c=l(c),n(c)}if(e=a(d),e){const c=l(e);return n(c)}if(e=s("filename","i").exec(d),e){e=e[1];let c=o(e);return c=l(c),n(c)}function s(c,f){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function i(c,f){if(c){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(c,{fatal:!0}),b=$h(f);f=p.decode(b),t=!1}catch{}}return f}function n(c){return t&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),t&&(c=i("iso-8859-1",c))),c}function a(c){const f=[];let p;const b=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=b.exec(c))!==null;){let[,A,x,C]=p;if(A=parseInt(A,10),A in f){if(A===0)break;continue}f[A]=[x,C]}const S=[];for(let A=0;A<f.length&&A in f;++A){let[x,C]=f[A];C=o(C),x&&(C=unescape(C),A===0&&(C=h(C))),S.push(C)}return S.join("")}function o(c){if(c.startsWith('"')){const f=c.slice(1).split('\\"');for(let p=0;p<f.length;++p){const b=f[p].indexOf('"');b!==-1&&(f[p]=f[p].slice(0,b),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}c=f.join('"')}return c}function h(c){const f=c.indexOf("'");if(f===-1)return c;const p=c.slice(0,f),S=c.slice(f+1).replace(/^[^']*'/,"");return i(p,S)}function l(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,b,S){if(b==="q"||b==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,x){return String.fromCharCode(parseInt(x,16))}),i(p,S);try{S=atob(S)}catch{}return i(p,S)})}return""}function Bf(d,t){const e=new Headers;if(!d||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function uc(d){var t;return((t=URL.parse(d))==null?void 0:t.origin)??null}function Hf({responseHeaders:d,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(d.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||d.get("Accept-Ranges")!=="bytes"||(d.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function $f(d){const t=d.get("Content-Disposition");if(t){let e=im(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Yd(e))return e}return null}function Uh(d,t){return new kl(`Unexpected server response (${d}) while retrieving PDF "${t}".`,d,d===404||d===0&&t.startsWith("file:"))}function Gf(d){return d===200||d===206}function zf(d,t,e){return{method:"GET",headers:d,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Wf(d){return d instanceof Uint8Array?d.buffer:d instanceof ArrayBuffer?d:(q(`getArrayBuffer - unexpected data format: ${d}`),new Uint8Array(d).buffer)}class ku{constructor(t){O(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Bf(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ct(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new nm(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new rm(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class nm{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,zf(s,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=uc(n.url),!Gf(n.status))throw Uh(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:h}=Hf({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=h||this._contentLength,this._filename=$f(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new en("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Wf(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class rm{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const a=i.url;fetch(a,zf(n,this._withCredentials,this._abortController)).then(o=>{const h=uc(o.url);if(h!==t._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${t._responseOrigin}".`);if(!Gf(o.status))throw Uh(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:Wf(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Sc=200,_c=206;function am(d){const t=d.response;return typeof t!="string"?t:$h(t).buffer}class om{constructor({url:t,httpHeaders:e,withCredentials:s}){O(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Bf(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=_c):i.expectedStatus=Sc,e.responseType="arraybuffer",Ct(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){var i;const s=this.pendingRequests[t];s&&((i=s.onProgress)==null||i.call(s,e))}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||Sc;if(!(n===Sc&&s.expectedStatus===_c)&&n!==s.expectedStatus){s.onError(i.status);return}const o=am(i);if(n===_c){const h=i.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);l?s.onDone({begin:parseInt(l[1],10),chunk:o}):(q('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class hm{constructor(t){this._source=t,this._manager=new om(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ct(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new lm(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new cm(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class lm{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=uc(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[h,...l]=o.split(": ");return[h,l.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=Hf({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=$f(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Uh(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class cm{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=uc((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=Uh(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const dm=/^[a-z][a-z0-9\-+.]+:/i;function um(d){if(dm.test(d))return new URL(d);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(d))}class fm{constructor(t){this.source=t,this.url=um(t.url),Ct(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ct(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new pm(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new gm(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class pm{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=Uh(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new en("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class gm{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const mm=1e5,Du=30;var Uu,Fi,fe,Ko,Qo,On,js,Zo,Jo,Bn,na,ra,Ni,aa,th,oa,Hn,eh,sh,ha,$n,ih,Oi,la,gi,Uf,Vf,td,ke,ul,ed,jf,qf;const Tt=class Tt{constructor({textContentSource:t,container:e,viewport:s}){y(this,gi);y(this,Fi,Promise.withResolvers());y(this,fe,null);y(this,Ko,!1);y(this,Qo,!!((Uu=globalThis.FontInspector)!=null&&Uu.enabled));y(this,On,null);y(this,js,null);y(this,Zo,0);y(this,Jo,0);y(this,Bn,null);y(this,na,null);y(this,ra,0);y(this,Ni,0);y(this,aa,Object.create(null));y(this,th,[]);y(this,oa,null);y(this,Hn,[]);y(this,eh,new WeakMap);y(this,sh,null);var h;if(t instanceof ReadableStream)g(this,oa,t);else if(typeof t=="object")g(this,oa,new ReadableStream({start(l){l.enqueue(t),l.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,fe,g(this,na,e)),g(this,Ni,s.scale*pi.pixelRatio),g(this,ra,s.rotation),g(this,js,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:a,pageY:o}=s.rawDims;g(this,sh,[1,0,0,-1,-a,o+n]),g(this,Jo,i),g(this,Zo,n),w(h=Tt,ke,jf).call(h),yr(e,s),r(this,Fi).promise.finally(()=>{r(Tt,la).delete(this),g(this,js,null),g(this,aa,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Xt.platform;return Q(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{r(this,Bn).read().then(({value:e,done:s})=>{if(s){r(this,Fi).resolve();return}r(this,On)??g(this,On,e.lang),Object.assign(r(this,aa),e.styles),w(this,gi,Uf).call(this,e.items),t()},r(this,Fi).reject)};return g(this,Bn,r(this,oa).getReader()),r(Tt,la).add(this),t(),r(this,Fi).promise}update({viewport:t,onBefore:e=null}){var n;const s=t.scale*pi.pixelRatio,i=t.rotation;if(i!==r(this,ra)&&(e==null||e(),g(this,ra,i),yr(r(this,na),{rotation:i})),s!==r(this,Ni)){e==null||e(),g(this,Ni,s);const a={div:null,properties:null,ctx:w(n=Tt,ke,ul).call(n,r(this,On))};for(const o of r(this,Hn))a.properties=r(this,eh).get(o),a.div=o,w(this,gi,td).call(this,a)}}cancel(){var e;const t=new en("TextLayer task cancelled.");(e=r(this,Bn))==null||e.cancel(t).catch(()=>{}),g(this,Bn,null),r(this,Fi).reject(t)}get textDivs(){return r(this,Hn)}get textContentItemsStr(){return r(this,th)}static cleanup(){if(!(r(this,la).size>0)){r(this,ha).clear();for(const{canvas:t}of r(this,$n).values())t.remove();r(this,$n).clear()}}};Fi=new WeakMap,fe=new WeakMap,Ko=new WeakMap,Qo=new WeakMap,On=new WeakMap,js=new WeakMap,Zo=new WeakMap,Jo=new WeakMap,Bn=new WeakMap,na=new WeakMap,ra=new WeakMap,Ni=new WeakMap,aa=new WeakMap,th=new WeakMap,oa=new WeakMap,Hn=new WeakMap,eh=new WeakMap,sh=new WeakMap,ha=new WeakMap,$n=new WeakMap,ih=new WeakMap,Oi=new WeakMap,la=new WeakMap,gi=new WeakSet,Uf=function(t){var i,n;if(r(this,Ko))return;(n=r(this,js)).ctx??(n.ctx=w(i=Tt,ke,ul).call(i,r(this,On)));const e=r(this,Hn),s=r(this,th);for(const a of t){if(e.length>mm){q("Ignoring additional textDivs for performance reasons."),g(this,Ko,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=r(this,fe);g(this,fe,document.createElement("span")),r(this,fe).classList.add("markedContent"),a.id!==null&&r(this,fe).setAttribute("id",`${a.id}`),o.append(r(this,fe))}else a.type==="endMarkedContent"&&g(this,fe,r(this,fe).parentNode);continue}s.push(a.str),w(this,gi,Vf).call(this,a)}},Vf=function(t){var A;const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};r(this,Hn).push(e);const i=B.transform(r(this,sh),t.transform);let n=Math.atan2(i[1],i[0]);const a=r(this,aa)[t.fontName];a.vertical&&(n+=Math.PI/2);let o=r(this,Qo)&&a.fontSubstitution||a.fontFamily;o=Tt.fontFamilyMap.get(o)||o;const h=Math.hypot(i[2],i[3]),l=h*w(A=Tt,ke,qf).call(A,o,a,r(this,On));let c,f;n===0?(c=i[4],f=i[5]-l):(c=i[4]+l*Math.sin(n),f=i[5]-l*Math.cos(n));const p="calc(var(--total-scale-factor) *",b=e.style;r(this,fe)===r(this,na)?(b.left=`${(100*c/r(this,Jo)).toFixed(2)}%`,b.top=`${(100*f/r(this,Zo)).toFixed(2)}%`):(b.left=`${p}${c.toFixed(2)}px)`,b.top=`${p}${f.toFixed(2)}px)`),b.fontSize=`${p}${(r(Tt,Oi)*h).toFixed(2)}px)`,b.fontFamily=o,s.fontSize=h,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,r(this,Qo)&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let S=!1;if(t.str.length>1)S=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const x=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);x!==C&&Math.max(x,C)/Math.min(x,C)>1.5&&(S=!0)}if(S&&(s.canvasWidth=a.vertical?t.height:t.width),r(this,eh).set(e,s),r(this,js).div=e,r(this,js).properties=s,w(this,gi,td).call(this,r(this,js)),s.hasText&&r(this,fe).append(e),s.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),r(this,fe).append(x)}},td=function(t){var o;const{div:e,properties:s,ctx:i}=t,{style:n}=e;let a="";if(r(Tt,Oi)>1&&(a=`scale(${1/r(Tt,Oi)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:h}=n,{canvasWidth:l,fontSize:c}=s;w(o=Tt,ke,ed).call(o,i,c*r(this,Ni),h);const{width:f}=i.measureText(e.textContent);f>0&&(a=`scaleX(${l*r(this,Ni)/f}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(n.transform=a)},ke=new WeakSet,ul=function(t=null){let e=r(this,$n).get(t||(t=""));if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),r(this,$n).set(t,e),r(this,ih).set(e,{size:0,family:""})}return e},ed=function(t,e,s){const i=r(this,ih).get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)},jf=function(){if(r(this,Oi)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),g(this,Oi,t.getBoundingClientRect().height),t.remove()},qf=function(t,e,s){const i=r(this,ha).get(t);if(i)return i;const n=w(this,ke,ul).call(this,s);n.canvas.width=n.canvas.height=Du,w(this,ke,ed).call(this,n,Du,t);const a=n.measureText(""),o=a.fontBoundingBoxAscent,h=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let l=.8;return o?l=o/(o+h):(Xt.platform.isFirefox&&q("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?l=e.ascent:e.descent&&(l=1+e.descent)),r(this,ha).set(t,l),l},y(Tt,ke),y(Tt,ha,new Map),y(Tt,$n,new Map),y(Tt,ih,new WeakMap),y(Tt,Oi,null),y(Tt,la,new Set);let go=Tt;class mo{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){var h;if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(mo.shouldBuildText(o))(h=n==null?void 0:n.attributes)!=null&&h.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(const l of n.children)i(l)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const bm=65536,ym=100;function wm(d={}){typeof d=="string"||d instanceof URL?d={url:d}:(d instanceof ArrayBuffer||ArrayBuffer.isView(d))&&(d={data:d});const t=new id,{docId:e}=t,s=d.url?Am(d.url):null,i=d.data?vm(d.data):null,n=d.httpHeaders||null,a=d.withCredentials===!0,o=d.password??null,h=d.range instanceof Xf?d.range:null,l=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:bm;let c=d.worker instanceof Nr?d.worker:null;const f=d.verbosity,p=typeof d.docBaseUrl=="string"&&!dc(d.docBaseUrl)?d.docBaseUrl:null,b=Qh(d.cMapUrl),S=d.cMapPacked!==!1,A=d.CMapReaderFactory||(Ut?Fg:Au),x=Qh(d.iccUrl),C=Qh(d.standardFontDataUrl),T=d.StandardFontDataFactory||(Ut?Ng:vu),E=Qh(d.wasmUrl),u=d.WasmFactory||(Ut?Og:Su),m=d.stopAtErrors!==!0,v=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,_=d.isEvalSupported!==!1,P=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!Ut,R=typeof d.isImageDecoderSupported=="boolean"?d.isImageDecoderSupported:!Ut&&(Xt.platform.isFirefox||!globalThis.chrome),M=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,I=typeof d.disableFontFace=="boolean"?d.disableFontFace:Ut,$=d.fontExtraProperties===!0,U=d.enableXfa===!0,V=d.ownerDocument||globalThis.document,mt=d.disableRange===!0,F=d.disableStream===!0,G=d.disableAutoFetch===!0,me=d.pdfBug===!0,Ts=d.CanvasFactory||(Ut?Dg:Mg),Rs=d.FilterFactory||(Ut?kg:Lg),Is=d.enableHWA===!0,Yt=d.useWasm!==!1,St=h?h.length:d.length??NaN,_r=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!Ut&&!I,mi=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:!!(A===Au&&T===vu&&u===Su&&b&&C&&E&&Cr(b,document.baseURI)&&Cr(C,document.baseURI)&&Cr(E,document.baseURI)),os=null;lg(f);const bt={canvasFactory:new Ts({ownerDocument:V,enableHWA:Is}),filterFactory:new Rs({docId:e,ownerDocument:V}),cMapReaderFactory:mi?null:new A({baseUrl:b,isCompressed:S}),standardFontDataFactory:mi?null:new T({baseUrl:C}),wasmFactory:mi?null:new u({baseUrl:E})};if(!c){const Wa={verbosity:f,port:li.workerPort};c=Wa.port?Nr.fromPort(Wa):new Nr(Wa),t._worker=c}const eg={docId:e,apiVersion:"5.1.91",data:i,password:o,disableAutoFetch:G,rangeChunkSize:l,length:St,docBaseUrl:p,enableXfa:U,evaluatorOptions:{maxImageSize:v,disableFontFace:I,ignoreErrors:m,isEvalSupported:_,isOffscreenCanvasSupported:P,isImageDecoderSupported:R,canvasMaxAreaInBytes:M,fontExtraProperties:$,useSystemFonts:_r,useWasm:Yt,useWorkerFetch:mi,cMapUrl:b,iccUrl:x,standardFontDataUrl:C,wasmUrl:E}},sg={ownerDocument:V,pdfBug:me,styleElement:os,loadingParams:{disableAutoFetch:G,enableXfa:U}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Wa=c.messageHandler.sendWithPromise("GetDocRequest",eg,i?[i.buffer]:null);let pc;if(h)pc=new tm(h,{disableRange:mt,disableStream:F});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let xr;if(Ut)if(Cr(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");xr=ku}else xr=fm;else xr=Cr(s)?ku:hm;pc=new xr({url:s,length:St,httpHeaders:n,withCredentials:a,rangeChunkSize:l,disableRange:mt,disableStream:F})}return Wa.then(xr=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const fu=new Ja(e,xr,c.port),ig=new Pm(fu,t,pc,sg,bt);t._transport=ig,fu.send("Ready",null)})}).catch(t._capability.reject),t}function Am(d){if(d instanceof URL)return d.href;if(typeof d=="string"){if(Ut)return d;const t=URL.parse(d,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function vm(d){if(Ut&&typeof Buffer<"u"&&d instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return $h(d);if(d instanceof ArrayBuffer||ArrayBuffer.isView(d)||typeof d=="object"&&!isNaN(d==null?void 0:d.length))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Qh(d){if(typeof d!="string")return null;if(d.endsWith("/"))return d;throw new Error(`Invalid factory url: "${d}" must include trailing slash.`)}const sd=d=>typeof d=="object"&&Number.isInteger(d==null?void 0:d.num)&&d.num>=0&&Number.isInteger(d==null?void 0:d.gen)&&d.gen>=0,Sm=d=>typeof d=="object"&&typeof(d==null?void 0:d.name)=="string",_m=wg.bind(null,sd,Sm);var Ql;const Zl=class Zl{constructor(){O(this,"_capability",Promise.withResolvers());O(this,"_transport",null);O(this,"_worker",null);O(this,"docId",`d${se(Zl,Ql)._++}`);O(this,"destroyed",!1);O(this,"onPassword",null);O(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,s,i;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Ql=new WeakMap,y(Zl,Ql,0);let id=Zl;class Xf{constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){at("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class xm{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var qs,Gn,no;class Em{constructor(t,e,s,i=!1){y(this,Gn);y(this,qs,!1);this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new bu:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Yf,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new zh({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=yi.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:h=null,pageColors:l=null,printAnnotationStorage:c=null,isEditing:f=!1}){var u,m;(u=this._stats)==null||u.time("Overall");const p=this._transport.getRenderingIntent(s,i,c,f),{renderingIntent:b,cacheKey:S}=p;g(this,qs,!1),o||(o=this._transport.getOptionalContentConfig(b));let A=this._intentStates.get(S);A||(A=Object.create(null),this._intentStates.set(S,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);const x=!!(b&Me.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(m=this._stats)==null||m.time("Page Request"),this._pumpOperatorList(p));const C=v=>{var _;A.renderTasks.delete(T),x&&g(this,qs,!0),w(this,Gn,no).call(this),v?(T.capability.reject(v),this._abortOperatorList({intentState:A,reason:v instanceof Error?v:new Error(v)})):T.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(_=globalThis.Stats)!=null&&_.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},T=new rd({callback:C,params:{canvasContext:t,viewport:e,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:l});(A.renderTasks||(A.renderTasks=new Set)).add(T);const E=T.task;return Promise.all([A.displayReadyCapability.promise,o]).then(([v,_])=>{var P;if(this.destroyed){C();return}if((P=this._stats)==null||P.time("Rendering"),!(_.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");T.initializeGraphics({transparency:v,optionalContentConfig:_}),T.operatorListChanged()}).catch(C),E}getOperatorList({intent:t="display",annotationMode:e=yi.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var l;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(h))}const a=this._transport.getRenderingIntent(t,e,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let h;return o.opListReadCapability||(h=Object.create(null),h.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(h),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(l=this._stats)==null||l.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>mo.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){a.read().then(function({value:h,done:l}){if(l){s(o);return}o.lang??(o.lang=h.lang),Object.assign(o.styles,h.styles),o.items.push(...h.items),n()},i)}const a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),g(this,qs,!1),Promise.all(t)}cleanup(t=!1){g(this,qs,!0);const e=w(this,Gn,no).call(this);return t&&e&&this._stats&&(this._stats=new bu),e}_startRenderPage(t,e){var i,n;const s=this._intentStates.get(e);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&w(this,Gn,no).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:a}=s,h=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},a).getReader(),l=this._intentStates.get(e);l.streamReader=h;const c=()=>{h.read().then(({value:f,done:p})=>{if(p){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,l),c())},f=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const p of l.renderTasks)p.operatorListChanged();w(this,Gn,no).call(this)}if(l.displayReadyCapability)l.displayReadyCapability.reject(f);else if(l.opListReadCapability)l.opListReadCapability.reject(f);else throw f}})};c()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Xd){let i=ym;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new en(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}qs=new WeakMap,Gn=new WeakSet,no=function(){if(!r(this,qs)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,qs,!1),!0};var Xs,Jl;class Cm{constructor(){y(this,Xs,new Map);y(this,Jl,Promise.resolve())}postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};r(this,Jl).then(()=>{for(const[i]of r(this,Xs))i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){q("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}r(this,Xs).set(e,i)}removeEventListener(t,e){const s=r(this,Xs).get(e);s==null||s(),r(this,Xs).delete(e)}terminate(){for(const[,t]of r(this,Xs))t==null||t();r(this,Xs).clear()}}Xs=new WeakMap,Jl=new WeakMap;var tc,zn,Wn,ca,fl,da,pl;const ct=class ct{constructor({name:t=null,port:e=null,verbosity:s=cg()}={}){y(this,ca);var i;if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((i=r(ct,Wn))!=null&&i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(r(ct,Wn)||g(ct,Wn,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new Ja("main","worker",t),this._messageHandler.on("ready",function(){}),w(this,ca,fl).call(this)}_initialize(){if(r(ct,zn)||r(ct,da,pl)){this._setupFakeWorker();return}let{workerSrc:t}=ct;try{ct._isSameOrigin(window.location,t)||(t=ct._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Ja("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:n.signal}),s.on("test",o=>{if(n.abort(),this.destroyed||!o){i();return}this._messageHandler=s,this._port=e,this._webWorker=e,w(this,ca,fl).call(this)}),s.on("ready",o=>{if(n.abort(),this.destroyed){i();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{cc("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){r(ct,zn)||(q("Setting up fake worker."),g(ct,zn,!0)),ct._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new Cm;this._port=e;const s=`fake${se(ct,tc)._++}`,i=new Ja(s+"_worker",s,e);t.setup(i,e),this._messageHandler=new Ja(s,s+"_worker",e),w(this,ca,fl).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,s;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=r(ct,Wn))==null||e.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(t){var s;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const e=(s=r(this,Wn))==null?void 0:s.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new ct(t)}static get workerSrc(){if(li.workerSrc)return li.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Q(this,"_setupFakeWorkerGlobal",(async()=>r(this,da,pl)?r(this,da,pl):(await import(this.workerSrc)).WorkerMessageHandler)())}};tc=new WeakMap,zn=new WeakMap,Wn=new WeakMap,ca=new WeakSet,fl=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},da=new WeakSet,pl=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},y(ct,da),y(ct,tc,0),y(ct,zn,!1),y(ct,Wn),Ut&&(g(ct,zn,!0),li.workerSrc||(li.workerSrc="./pdf.worker.mjs")),ct._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},ct._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let Nr=ct;var Ys,As,ua,fa,Ks,Un,ro;class Pm{constructor(t,e,s,i,n){y(this,Un);y(this,Ys,new Map);y(this,As,new Map);y(this,ua,new Map);y(this,fa,new Map);y(this,Ks,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Yf,this.fontLoader=new Rg({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Q(this,"annotationStorage",new Jd)}getRenderingIntent(t,e=yi.ENABLE,s=null,i=!1,n=!1){let a=Me.DISPLAY,o=Vc;switch(t){case"any":a=Me.ANY;break;case"display":break;case"print":a=Me.PRINT;break;default:q(`getRenderingIntent - invalid intent: ${t}`)}const h=a&Me.PRINT&&s instanceof Tf?s:this.annotationStorage;switch(e){case yi.DISABLE:a+=Me.ANNOTATIONS_DISABLE;break;case yi.ENABLE:break;case yi.ENABLE_FORMS:a+=Me.ANNOTATIONS_FORMS;break;case yi.ENABLE_STORAGE:a+=Me.ANNOTATIONS_STORAGE,o=h.serializable;break;default:q(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(a+=Me.IS_EDITING),n&&(a+=Me.OPLIST);const{ids:l,hash:c}=h.modifiedIds,f=[a,o.hash,c];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:l}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=r(this,Ks))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of r(this,As).values())t.push(i._destroy());r(this,As).clear(),r(this,ua).clear(),r(this,fa).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),r(this,Ys).clear(),this.filterFactory.destroy(),go.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new en("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{Ct(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){i.close();return}Ct(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:a}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),this._fullReader.onProgress=h=>{var l;(l=e.onProgress)==null||l.call(e,{loaded:h.loaded,total:h.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:a}}),t.on("GetRangeReader",(s,i)=>{Ct(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){i.close();return}Ct(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{n.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new xm(s,this))}),t.on("DocException",s=>{e._capability.reject(ce(s))}),t.on("PasswordRequest",s=>{g(this,Ks,Promise.withResolvers());try{if(!e.onPassword)throw ce(s);const i=n=>{n instanceof Error?r(this,Ks).reject(n):r(this,Ks).resolve({password:n})};e.onPassword(i,s.code)}catch(i){r(this,Ks).reject(i)}return r(this,Ks).promise}),t.on("DataLoaded",s=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;r(this,As).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const c=n.error;q(`Error during font loading: ${c}`),this.commonObjs.resolve(s,c);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(c,f)=>globalThis.FontInspector.fontAdded(c,f):null,h=new Ig(n,o);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:l}=n;Ct(l,"The imageRef must be defined.");for(const c of r(this,As).values())for(const[,f]of c.objs)if((f==null?void 0:f.ref)===l)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,a])=>{var h;if(this.destroyed)return;const o=r(this,As).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(h=a==null?void 0:a.bitmap)==null||h.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&q("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((s=this._fullReader)==null?void 0:s.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=r(this,ua).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&r(this,fa).set(n.refStr,t);const a=new Em(e,n,this,this._params.pdfBug);return r(this,As).set(e,a),a});return r(this,ua).set(e,i),i}getPageIndex(t){return sd(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return w(this,Un,ro).call(this,"GetFieldObjects")}hasJSActions(){return w(this,Un,ro).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return w(this,Un,ro).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return w(this,Un,ro).call(this,"GetOptionalContentConfig").then(e=>new Jg(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=r(this,Ys).get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>{var n,a;return{info:i[0],metadata:i[1]?new Qg(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return r(this,Ys).set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of r(this,As).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),r(this,Ys).clear(),this.filterFactory.destroy(!0),go.cleanup()}}cachedPageNumber(t){if(!sd(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return r(this,fa).get(e)??null}}Ys=new WeakMap,As=new WeakMap,ua=new WeakMap,fa=new WeakMap,Ks=new WeakMap,Un=new WeakSet,ro=function(t,e=null){const s=r(this,Ys).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return r(this,Ys).set(t,i),i};const Va=Symbol("INITIAL_DATA");var ve,nh,nd;class Yf{constructor(){y(this,nh);y(this,ve,Object.create(null))}get(t,e=null){if(e){const i=w(this,nh,nd).call(this,t);return i.promise.then(()=>e(i.data)),null}const s=r(this,ve)[t];if(!s||s.data===Va)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=r(this,ve)[t];return!!e&&e.data!==Va}delete(t){const e=r(this,ve)[t];return!e||e.data===Va?!1:(delete r(this,ve)[t],!0)}resolve(t,e=null){const s=w(this,nh,nd).call(this,t);s.data=e,s.resolve()}clear(){var t;for(const e in r(this,ve)){const{data:s}=r(this,ve)[e];(t=s==null?void 0:s.bitmap)==null||t.close()}g(this,ve,Object.create(null))}*[Symbol.iterator](){for(const t in r(this,ve)){const{data:e}=r(this,ve)[t];e!==Va&&(yield[t,e])}}}ve=new WeakMap,nh=new WeakSet,nd=function(t){var e;return(e=r(this,ve))[t]||(e[t]={...Promise.withResolvers(),data:Va})};var Bi;class Tm{constructor(t){y(this,Bi,null);O(this,"onContinue",null);O(this,"onError",null);g(this,Bi,t)}get promise(){return r(this,Bi).capability.promise}cancel(t=0){r(this,Bi).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=r(this,Bi).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=r(this,Bi);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}Bi=new WeakMap;var Hi,Vn;const dn=class dn{constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:h,filterFactory:l,useRequestAnimationFrame:c=!1,pdfBug:f=!1,pageColors:p=null}){y(this,Hi,null);this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=h,this.filterFactory=l,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Tm(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var o,h;if(this.cancelled)return;if(this._canvas){if(r(dn,Vn).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r(dn,Vn).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:n,background:a}=this.params;this.gfx=new Fr(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(t=null,e=0){var s,i,n;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),r(this,Hi)&&(window.cancelAnimationFrame(r(this,Hi)),g(this,Hi,null)),r(dn,Vn).delete(this._canvas),t||(t=new Xd(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(n=(i=this.task).onError)==null||n.call(i,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,Hi,window.requestAnimationFrame(()=>{g(this,Hi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r(dn,Vn).delete(this._canvas),this.callback())))}};Hi=new WeakMap,Vn=new WeakMap,y(dn,Vn,new WeakSet);let rd=dn;const Rm="5.1.91",Im="45cbe8bb0";function Fu(d){return Math.floor(Math.max(0,Math.min(1,d))*255).toString(16).padStart(2,"0")}function ja(d){return Math.max(0,Math.min(255,255*d))}class Nu{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ja(t),[t,t,t]}static G_HTML([t]){const e=Fu(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(ja)}static RGB_HTML(t){return`#${t.map(Fu).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[ja(1-Math.min(1,t+i)),ja(1-Math.min(1,s+i)),ja(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,a=1-s,o=Math.min(i,n,a);return["CMYK",i,n,a,o]}}class Mm{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){at("Abstract method `_createSVG` called.")}}class Nl extends Mm{_createSVG(t){return document.createElementNS(Ms,t)}}class Kf{static setupStorage(t,e,s,i,n){const a=i.getValue(e,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?t.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{i.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const h=o.target.options,l=h.selectedIndex===-1?"":h[h.selectedIndex].value;i.setValue(e,{value:l})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[h,l]of Object.entries(a))if(l!=null)switch(h){case"class":l.length&&t.setAttribute(h,l.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",l);break;case"style":Object.assign(t.style,l);break;case"textContent":t.textContent=l;break;default:(!o||h!=="href"&&h!=="newWindow")&&t.setAttribute(h,l)}o&&n.addLinkAttributes(t,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(t,a.dataId,e,s)}static render(t){var f,p;const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:n,linkService:s});const o=n!=="richText",h=t.div;if(h.append(a),t.viewport){const b=`matrix(${t.viewport.transform.join(",")})`;h.style.transform=b}o&&h.setAttribute("class","xfaLayer xfaFont");const l=[];if(i.children.length===0){if(i.value){const b=document.createTextNode(i.value);a.append(b),o&&mo.shouldBuildText(i.name)&&l.push(b)}return{textDivs:l}}const c=[[i,-1,a]];for(;c.length>0;){const[b,S,A]=c.at(-1);if(S+1===b.children.length){c.pop();continue}const x=b.children[++c.at(-1)[1]];if(x===null)continue;const{name:C}=x;if(C==="#text"){const E=document.createTextNode(x.value);l.push(E),A.append(E);continue}const T=(f=x==null?void 0:x.attributes)!=null&&f.xmlns?document.createElementNS(x.attributes.xmlns,C):document.createElement(C);if(A.append(T),x.attributes&&this.setAttributes({html:T,element:x,storage:e,intent:n,linkService:s}),((p=x.children)==null?void 0:p.length)>0)c.push([x,-1,T]);else if(x.value){const E=document.createTextNode(x.value);o&&mo.shouldBuildText(C)&&l.push(E),T.append(E)}}for(const b of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))b.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Vh=1e3,Lm=9,Ar=new WeakSet;class Ou{static create(t){switch(t.data.annotationType){case xt.LINK:return new Qf(t);case xt.TEXT:return new km(t);case xt.WIDGET:switch(t.data.fieldType){case"Tx":return new Dm(t);case"Btn":return t.data.radioButton?new tp(t):t.data.checkBox?new Nm(t):new Om(t);case"Ch":return new Bm(t);case"Sig":return new Fm(t)}return new Sr(t);case xt.POPUP:return new od(t);case xt.FREETEXT:return new rp(t);case xt.LINE:return new $m(t);case xt.SQUARE:return new Gm(t);case xt.CIRCLE:return new zm(t);case xt.POLYLINE:return new ap(t);case xt.CARET:return new Um(t);case xt.INK:return new su(t);case xt.POLYGON:return new Wm(t);case xt.HIGHLIGHT:return new op(t);case xt.UNDERLINE:return new Vm(t);case xt.SQUIGGLY:return new jm(t);case xt.STRIKEOUT:return new qm(t);case xt.STAMP:return new hp(t);case xt.FILEATTACHMENT:return new Xm(t);default:return new vt(t)}}}var jn,pa,ga,rh,ad;const du=class du{constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){y(this,rh);y(this,jn,null);y(this,pa,!1);y(this,ga,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t!=null&&t.str||e!=null&&e.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return du._hasPopupData(this.data)}updateEdited(t){var s;if(!this.container)return;r(this,jn)||g(this,jn,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&w(this,rh,ad).call(this,e),(s=r(this,ga))==null||s.popup.updateEdited(t)}resetEdited(){var t;r(this,jn)&&(w(this,rh,ad).call(this,r(this,jn).rect),(t=r(this,ga))==null||t.popup.resetEdited(),g(this,jn,null))}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof Sr||(n.tabIndex=Vh);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof od){const{rotation:A}=e;return!e.hasOwnCanvas&&A!==0&&this.setRotation(A,n),n}const{width:o,height:h}=this;if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const A=e.borderStyle.horizontalCornerRadius,x=e.borderStyle.verticalCornerRadius;if(A>0||x>0){const T=`calc(${A}px * var(--total-scale-factor)) / calc(${x}px * var(--total-scale-factor))`;a.borderRadius=T}else if(this instanceof tp){const T=`calc(${o}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;a.borderRadius=T}switch(e.borderStyle.style){case Er.SOLID:a.borderStyle="solid";break;case Er.DASHED:a.borderStyle="dashed";break;case Er.BEVELED:q("Unimplemented border style: beveled");break;case Er.INSET:q("Unimplemented border style: inset");break;case Er.UNDERLINE:a.borderBottomStyle="solid";break}const C=e.borderColor||null;C?(g(this,pa,!0),a.borderColor=B.makeHexColor(C[0]|0,C[1]|0,C[2]|0)):a.borderWidth=0}const l=B.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:f,pageX:p,pageY:b}=i.rawDims;a.left=`${100*(l[0]-p)/c}%`,a.top=`${100*(l[1]-b)/f}%`;const{rotation:S}=e;return e.hasOwnCanvas||S===0?(a.width=`${100*o/c}%`,a.height=`${100*h/f}%`):this.setRotation(S,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:a}=this;t%180!==0&&([n,a]=[a,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*a/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],a=n[0],o=n.slice(1);i.target.style[s]=Nu[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:Nu[`${a}_rgb`](o)})};return Q(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail)){const n=t[i]||s[i];n==null||n(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const a=s[i];if(a){const o={detail:{[i]:n},target:t};a(o),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(A=>Math.fround(A));if(t.length===8){const[A,x,C,T]=t.subarray(2,6);if(i===A&&n===x&&e===C&&s===T)return}const{style:a}=this.container;let o;if(r(this,pa)){const{borderColor:A,borderWidth:x}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const h=i-e,l=n-s,{svgFactory:c}=this,f=c.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0);const p=c.createElement("defs");f.append(p);const b=c.createElement("clipPath"),S=`clippath_${this.data.id}`;b.setAttribute("id",S),b.setAttribute("clipPathUnits","objectBoundingBox"),p.append(b);for(let A=2,x=t.length;A<x;A+=8){const C=t[A],T=t[A+1],E=t[A+2],u=t[A+3],m=c.createElement("rect"),v=(E-e)/h,_=(n-T)/l,P=(C-E)/h,R=(T-u)/l;m.setAttribute("x",v),m.setAttribute("y",_),m.setAttribute("width",P),m.setAttribute("height",R),b.append(m),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${v}" y="${_}" width="${P}" height="${R}"/>`)}r(this,pa)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(f),this.container.style.clipPath=`url(#${S})`}_createPopup(){const{data:t}=this,e=g(this,ga,new od({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){at("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:a,exportValues:o}of i){if(n===-1||a===e)continue;const h=typeof o=="string"?o:null,l=document.querySelector(`[data-element-id="${a}"]`);if(l&&!Ar.has(l)){q(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:h,domElement:l})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,a=i.getAttribute("data-element-id");a!==e&&Ar.has(i)&&s.push({id:a,exportValue:n,domElement:i})}return s}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};jn=new WeakMap,pa=new WeakMap,ga=new WeakMap,rh=new WeakSet,ad=function(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:h}}}}=this;s==null||s.splice(0,4,...t),e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(a-t[3]+h)/a}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/a}%`):this.setRotation(i)};let vt=du;var Le,on,Zf,Jf;class Qf extends vt{constructor(e,s=null){super(e,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});y(this,Le);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let n=!1;return e.url?(s.addLinkAttributes(i,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(i,e.action),n=!0):e.attachment?(w(this,Le,Zf).call(this,i,e.attachment,e.attachmentDest),n=!0):e.setOCGState?(w(this,Le,Jf).call(this,i,e.setOCGState),n=!0):e.dest?(this._bindLink(i,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),n=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(e,s){e.href=this.linkService.getDestinationHash(s),e.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&w(this,Le,on).call(this)}_bindNamedAction(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(s),!1),w(this,Le,on).call(this)}_bindJSAction(e,s){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const a=i.get(n);a&&(e[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}e.onclick||(e.onclick=()=>!1),w(this,Le,on).call(this)}_bindResetFormAction(e,s){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),w(this,Le,on).call(this),!this._fieldObjects){q('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{var f;i==null||i();const{fields:n,refs:a,include:o}=s,h=[];if(n.length!==0||a.length!==0){const p=new Set(a);for(const b of n){const S=this._fieldObjects[b]||[];for(const{id:A}of S)p.add(A)}for(const b of Object.values(this._fieldObjects))for(const S of b)p.has(S.id)===o&&h.push(S)}else for(const p of Object.values(this._fieldObjects))h.push(...p);const l=this.annotationStorage,c=[];for(const p of h){const{id:b}=p;switch(c.push(b),p.type){case"text":{const A=p.defaultValue||"";l.setValue(b,{value:A});break}case"checkbox":case"radiobutton":{const A=p.defaultValue===p.exportValues;l.setValue(b,{value:A});break}case"combobox":case"listbox":{const A=p.defaultValue||"";l.setValue(b,{value:A});break}default:continue}const S=document.querySelector(`[data-element-id="${b}"]`);if(S){if(!Ar.has(S)){q(`_bindResetFormAction - element not allowed: ${b}`);continue}}else continue;S.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}Le=new WeakSet,on=function(){this.container.setAttribute("data-internal-link","")},Zf=function(e,s,i=null){e.href=this.linkService.getAnchorUrl(""),s.description&&(e.title=s.description),e.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(s.content,s.filename,i),!1},w(this,Le,on).call(this)},Jf=function(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(s),!1),w(this,Le,on).call(this)};class km extends vt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Sr extends vt{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Xt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(s,a=>{var o;if(s==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a)}}))})}_setEventListeners(t,e,s,i){var n,a,o;for(const[h,l]of s)(l==="Action"||(n=this.data.actions)!=null&&n[l])&&((l==="Focus"||l==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,h,l,i),l==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(t,e,"blur","Blur",null):l==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":B.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Lm,n=t.style;let a;const o=2,h=l=>Math.round(10*l)/10;if(this.data.multiLine){const l=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(l/(mc*i))||1,f=l/c;a=Math.min(i,h(f/mc))}else{const l=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,h(l/mc))}n.fontSize=`calc(${a}px * var(--total-scale-factor))`,n.color=B.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Dm extends Sr{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=s),n.setValue(a.id,{[i]:s})}render(){var i,n;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const h=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;h&&o.length>h&&(o=o.slice(0,h));let l=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=l??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",l??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ar.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Vh,this._setRequired(s,this.data.required),h&&(s.maxLength=h),s.addEventListener("input",p=>{t.setValue(e,{value:p.target.value}),this.setPropertyOnSiblings(s,"value",p.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",p=>{const b=this.data.defaultFieldValue??"";s.value=c.userValue=b,c.formattedValue=null});let f=p=>{const{formattedValue:b}=c;b!=null&&(p.target.value=b),p.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",b=>{var A;if(c.focused)return;const{target:S}=b;c.userValue&&(S.value=c.userValue),c.lastCommittedValue=S.value,c.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const S={value(A){c.userValue=A.detail.value??"",t.setValue(e,{value:c.userValue.toString()}),A.target.value=c.userValue},formattedValue(A){const{formattedValue:x}=A.detail;c.formattedValue=x,x!=null&&A.target!==document.activeElement&&(A.target.value=x),t.setValue(e,{formattedValue:x})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var E;const{charLimit:x}=A.detail,{target:C}=A;if(x===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",x);let T=c.userValue;!T||T.length<=x||(T=T.slice(0,x),C.value=c.userValue=T,t.setValue(e,{value:T}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(S,b)}),s.addEventListener("keydown",b=>{var x;c.commitKey=1;let S=-1;if(b.key==="Escape"?S=0:b.key==="Enter"&&!this.data.multiLine?S=2:b.key==="Tab"&&(c.commitKey=3),S===-1)return;const{value:A}=b.target;c.lastCommittedValue!==A&&(c.lastCommittedValue=A,c.userValue=A,(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:S,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const p=f;f=null,s.addEventListener("blur",b=>{var A,x;if(!c.focused||!b.relatedTarget)return;(A=this.data.actions)!=null&&A.Blur||(c.focused=!1);const{value:S}=b.target;c.userValue=S,c.lastCommittedValue!==S&&((x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:c.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}})),p(b)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",b=>{var m;c.lastCommittedValue=null;const{data:S,target:A}=b,{value:x,selectionStart:C,selectionEnd:T}=A;let E=C,u=T;switch(b.inputType){case"deleteWordBackward":{const v=x.substring(0,C).match(/\w*[^\w]*$/);v&&(E-=v[0].length);break}case"deleteWordForward":{const v=x.substring(C).match(/^[^\w]*\w*/);v&&(u+=v[0].length);break}case"deleteContentBackward":C===T&&(E-=1);break;case"deleteContentForward":C===T&&(u+=1);break}b.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:x,change:S||"",willCommit:!1,selStart:E,selEnd:u}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/h;s.classList.add("comb"),s.style.letterSpacing=`calc(${b}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Fm extends Sr{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Nm extends Sr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Ar.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=Vh,n.addEventListener("change",a=>{const{name:o,checked:h}=a.target;for(const l of this._getElementsByName(o,s)){const c=h&&l.exportValue===e.exportValue;l.domElement&&(l.domElement.checked=c),t.setValue(l.id,{value:c})}t.setValue(s,{value:h})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(h){h.target.checked=h.detail.value!=="Off",t.setValue(s,{value:h.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class tp extends Sr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const a of this._getElementsByName(e.fieldName,s))t.setValue(a.id,{value:!1});const n=document.createElement("input");if(Ar.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=Vh,n.addEventListener("change",a=>{const{name:o,checked:h}=a.target;for(const l of this._getElementsByName(o,s))t.setValue(l.id,{value:!1});t.setValue(s,{value:h})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{const h={value:l=>{const c=a===l.detail.value;for(const f of this._getElementsByName(l.target.name)){const p=c&&f.id===s;f.domElement&&(f.domElement.checked=p),t.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(h,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Om extends Qf{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class Bm extends Sr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Ar.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Vh;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const f=this.data.defaultFieldValue;for(const p of i.options)p.selected=p.value===f});for(const c of this.data.options){const f=document.createElement("option");f.textContent=c.displayValue,f.value=c.exportValue,s.value.includes(c.exportValue)&&(f.setAttribute("selected",!0),n=!1),i.append(f)}let a=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),a=()=>{c.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=c=>{const f=c?"value":"textContent",{options:p,multiple:b}=i;return b?Array.prototype.filter.call(p,S=>S.selected).map(S=>S[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let h=o(!1);const l=c=>{const f=c.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const f={value(p){a==null||a();const b=p.detail.value,S=new Set(Array.isArray(b)?b:[b]);for(const A of i.options)A.selected=S.has(A.value);t.setValue(e,{value:o(!0)}),h=o(!1)},multipleSelection(p){i.multiple=!0},remove(p){const b=i.options,S=p.detail.remove;b[S].selected=!1,i.remove(S),b.length>0&&Array.prototype.findIndex.call(b,x=>x.selected)===-1&&(b[0].selected=!0),t.setValue(e,{value:o(!0),items:l(p)}),h=o(!1)},clear(p){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),h=o(!1)},insert(p){const{index:b,displayValue:S,exportValue:A}=p.detail.insert,x=i.children[b],C=document.createElement("option");C.textContent=S,C.value=A,x?x.before(C):i.append(C),t.setValue(e,{value:o(!0),items:l(p)}),h=o(!1)},items(p){const{items:b}=p.detail;for(;i.length!==0;)i.remove(0);for(const S of b){const{displayValue:A,exportValue:x}=S,C=document.createElement("option");C.textContent=A,C.value=x,i.append(C)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:l(p)}),h=o(!1)},indices(p){const b=new Set(p.detail.indices);for(const S of p.target.options)S.selected=b.has(S.index);t.setValue(e,{value:o(!0)}),h=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,c)}),i.addEventListener("input",c=>{var b;const f=o(!0),p=o(!1);t.setValue(e,{value:f}),c.preventDefault(),(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:h,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class od extends vt{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:vt._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new Hm({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(s=>`${qd}${s}`).join(",")),this.container}}var ma,ec,sc,ba,ya,yt,Qs,wa,ah,oh,Aa,Zs,Ye,Js,hh,ti,lh,qn,Xn,ot,gl,hd,ep,sp,ip,np,ml,bl,ld;class Hm{constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:a,richText:o,parent:h,rect:l,parentRect:c,open:f}){y(this,ot);y(this,ma,w(this,ot,ip).bind(this));y(this,ec,w(this,ot,ld).bind(this));y(this,sc,w(this,ot,bl).bind(this));y(this,ba,w(this,ot,ml).bind(this));y(this,ya,null);y(this,yt,null);y(this,Qs,null);y(this,wa,null);y(this,ah,null);y(this,oh,null);y(this,Aa,null);y(this,Zs,!1);y(this,Ye,null);y(this,Js,null);y(this,hh,null);y(this,ti,null);y(this,lh,null);y(this,qn,null);y(this,Xn,!1);var p;g(this,yt,t),g(this,lh,i),g(this,Qs,a),g(this,ti,o),g(this,oh,h),g(this,ya,e),g(this,hh,l),g(this,Aa,c),g(this,ah,s),g(this,wa,Kd.toDateObject(n)),this.trigger=s.flatMap(b=>b.getElementsToTriggerPopup());for(const b of this.trigger)b.addEventListener("click",r(this,ba)),b.addEventListener("mouseenter",r(this,sc)),b.addEventListener("mouseleave",r(this,ec)),b.classList.add("popupTriggerArea");for(const b of s)(p=b.container)==null||p.addEventListener("keydown",r(this,ma));r(this,yt).hidden=!0,f&&w(this,ot,ml).call(this)}render(){if(r(this,Ye))return;const t=g(this,Ye,document.createElement("div"));if(t.className="popup",r(this,ya)){const n=t.style.outlineColor=B.makeHexColor(...r(this,ya));t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");if(e.append(s),{dir:s.dir,str:s.textContent}=r(this,lh),t.append(e),r(this,wa)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:r(this,wa).valueOf()})),e.append(n)}const i=r(this,ot,gl);if(i)Kf.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(r(this,Qs));t.append(n)}r(this,yt).append(t)}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let n=0,a=i.length;n<a;++n){const o=i[n];s.append(document.createTextNode(o)),n<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:t,popupContent:e}){var s;r(this,qn)||g(this,qn,{contentsObj:r(this,Qs),richText:r(this,ti)}),t&&g(this,Js,null),e&&(g(this,ti,w(this,ot,sp).call(this,e)),g(this,Qs,null)),(s=r(this,Ye))==null||s.remove(),g(this,Ye,null)}resetEdited(){var t;r(this,qn)&&({contentsObj:se(this,Qs)._,richText:se(this,ti)._}=r(this,qn),g(this,qn,null),(t=r(this,Ye))==null||t.remove(),g(this,Ye,null),g(this,Js,null))}forceHide(){g(this,Xn,this.isVisible),r(this,Xn)&&(r(this,yt).hidden=!0)}maybeShow(){r(this,Xn)&&(r(this,Ye)||w(this,ot,bl).call(this),g(this,Xn,!1),r(this,yt).hidden=!1)}get isVisible(){return r(this,yt).hidden===!1}}ma=new WeakMap,ec=new WeakMap,sc=new WeakMap,ba=new WeakMap,ya=new WeakMap,yt=new WeakMap,Qs=new WeakMap,wa=new WeakMap,ah=new WeakMap,oh=new WeakMap,Aa=new WeakMap,Zs=new WeakMap,Ye=new WeakMap,Js=new WeakMap,hh=new WeakMap,ti=new WeakMap,lh=new WeakMap,qn=new WeakMap,Xn=new WeakMap,ot=new WeakSet,gl=function(){const t=r(this,ti),e=r(this,Qs);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&r(this,ti).html||null},hd=function(){var t,e,s;return((s=(e=(t=r(this,ot,gl))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.fontSize)||0},ep=function(){var t,e,s;return((s=(e=(t=r(this,ot,gl))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.color)||null},sp=function(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:r(this,ot,ep),fontSize:r(this,ot,hd)?`calc(${r(this,ot,hd)}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s},ip=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&r(this,Zs))&&w(this,ot,ml).call(this)},np=function(){if(r(this,Js)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=r(this,oh);let a=!!r(this,Aa),o=a?r(this,Aa):r(this,hh);for(const S of r(this,ah))if(!o||B.intersect(S.data.rect,o)!==null){o=S.data.rect,a=!0;break}const h=B.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=a?o[2]-o[0]+5:0,f=h[0]+c,p=h[1];g(this,Js,[100*(f-i)/e,100*(p-n)/s]);const{style:b}=r(this,yt);b.left=`${r(this,Js)[0]}%`,b.top=`${r(this,Js)[1]}%`},ml=function(){g(this,Zs,!r(this,Zs)),r(this,Zs)?(w(this,ot,bl).call(this),r(this,yt).addEventListener("click",r(this,ba)),r(this,yt).addEventListener("keydown",r(this,ma))):(w(this,ot,ld).call(this),r(this,yt).removeEventListener("click",r(this,ba)),r(this,yt).removeEventListener("keydown",r(this,ma)))},bl=function(){r(this,Ye)||this.render(),this.isVisible?r(this,Zs)&&r(this,yt).classList.add("focused"):(w(this,ot,np).call(this),r(this,yt).hidden=!1,r(this,yt).style.zIndex=parseInt(r(this,yt).style.zIndex)+1e3)},ld=function(){r(this,yt).classList.remove("focused"),!(r(this,Zs)||!this.isVisible)&&(r(this,yt).hidden=!0,r(this,yt).style.zIndex=parseInt(r(this,yt).style.zIndex)-1e3)};class rp extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var ch;class $m extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,ch,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=g(this,ch,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,ch)}addHighlightArea(){this.container.classList.add("highlightArea")}}ch=new WeakMap;var dh;class Gm extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,dh,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=e.borderStyle.width,o=g(this,dh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,dh)}addHighlightArea(){this.container.classList.add("highlightArea")}}dh=new WeakMap;var uh;class zm extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,uh,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=e.borderStyle.width,o=g(this,uh,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,uh)}addHighlightArea(){this.container.classList.add("highlightArea")}}uh=new WeakMap;var fh;class ap extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,fh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:s,borderStyle:i,popupRef:n},width:a,height:o}=this;if(!s)return this.container;const h=this.svgFactory.create(a,o,!0);let l=[];for(let f=0,p=s.length;f<p;f+=2){const b=s[f]-e[0],S=e[3]-s[f+1];l.push(`${b},${S}`)}l=l.join(" ");const c=g(this,fh,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),h.append(c),this.container.append(h),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,fh)}addHighlightArea(){this.container.classList.add("highlightArea")}}fh=new WeakMap;class Wm extends ap{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Um extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var ph,Yn,gh,cd;class su extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});y(this,gh);y(this,ph,null);y(this,Yn,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:s,inkLists:i,borderStyle:n,popupRef:a}}=this,{transform:o,width:h,height:l}=w(this,gh,cd).call(this,s,e),c=this.svgFactory.create(h,l,!0),f=g(this,ph,this.svgFactory.createElement("svg:g"));c.append(f),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",o);for(let p=0,b=i.length;p<b;p++){const S=this.svgFactory.createElement(this.svgElementName);r(this,Yn).push(S),S.setAttribute("points",i[p].join(",")),f.append(S)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:s,points:i,rect:n}=e,a=r(this,ph);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,h=r(this,Yn).length;o<h;o++)r(this,Yn)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:h,height:l}=w(this,gh,cd).call(this,this.data.rotation,n);a.parentElement.setAttribute("viewBox",`0 0 ${h} ${l}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return r(this,Yn)}addHighlightArea(){this.container.classList.add("highlightArea")}}ph=new WeakMap,Yn=new WeakMap,gh=new WeakSet,cd=function(e,s){switch(e){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class op extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Vm extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class jm extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class qm extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class hp extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var mh,bh,dd;class Xm extends vt{constructor(e){var i;super(e,{isRenderable:!0});y(this,bh);y(this,mh,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",w(this,bh,dd).bind(this)),g(this,mh,i);const{isMac:n}=Xt.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&w(this,bh,dd).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return r(this,mh)}addHighlightArea(){this.container.classList.add("highlightArea")}}mh=new WeakMap,bh=new WeakSet,dd=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var yh,Kn,$i,wh,an,fd,pd;const uu=class uu{constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:a,structTreeLayer:o}){y(this,an);y(this,yh,null);y(this,Kn,null);y(this,$i,new Map);y(this,wh,null);this.div=t,g(this,yh,e),g(this,Kn,s),g(this,wh,o||null),this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return r(this,$i).size>0}async render(t){var a;const{annotations:e}=t,s=this.div;yr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Nl,annotationStorage:t.annotationStorage||new Jd,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const h=o.annotationType===xt.POPUP;if(h){const f=i.get(o.id);if(!f)continue;n.elements=f}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const l=Ou.create(n);if(!l.isRenderable)continue;if(!h&&o.popupRef){const f=i.get(o.popupRef);f?f.push(l):i.set(o.popupRef,[l])}const c=l.render();o.hidden&&(c.style.visibility="hidden"),await w(this,an,fd).call(this,c,o.id),l._isEditable&&(r(this,$i).set(l.data.id,l),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(l))}w(this,an,pd).call(this)}async addLinkAnnotations(t,e){const s={data:null,layer:this.div,linkService:e,svgFactory:new Nl,parent:this};for(const i of t){i.borderStyle||(i.borderStyle=uu._defaultBorderStyle),s.data=i;const n=Ou.create(s);if(!n.isRenderable)continue;const a=n.render();await w(this,an,fd).call(this,a,i.id)}}update({viewport:t}){const e=this.div;this.viewport=t,yr(e,{rotation:t.rotation}),w(this,an,pd).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(r(this,$i).values())}getEditableAnnotation(t){return r(this,$i).get(t)}static get _defaultBorderStyle(){return Q(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Er.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};yh=new WeakMap,Kn=new WeakMap,$i=new WeakMap,wh=new WeakMap,an=new WeakSet,fd=async function(t,e){var a,o;const s=t.firstChild||t,i=s.id=`${qd}${e}`,n=await((a=r(this,wh))==null?void 0:a.getAriaAttributes(i));if(n)for(const[h,l]of n)s.setAttribute(h,l);this.div.append(t),(o=r(this,yh))==null||o.moveElementInDOM(this.div,t,s,!1)},pd=function(){var e;if(!r(this,Kn))return;const t=this.div;for(const[s,i]of r(this,Kn)){const n=t.querySelector(`[data-annotation-id="${s}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:a}=n;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):n.append(i);const o=r(this,$i).get(s);o&&(o._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(s,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}r(this,Kn).clear()};let ud=uu;const Zh=/\r\n?|\n/g;var Ke,Se,Ah,Qn,_e,Pt,lp,cp,dp,yl,fi,wl,Al,up,md,fp;const ht=class ht extends pt{constructor(e){super({...e,name:"freeTextEditor"});y(this,Pt);y(this,Ke);y(this,Se,"");y(this,Ah,`${this.id}-editor`);y(this,Qn,null);y(this,_e);g(this,Ke,e.color||ht._defaultColor||pt._defaultLineColor),g(this,_e,e.fontSize||ht._defaultFontSize)}static get _keyboardManager(){const e=ht.prototype,s=a=>a.isEmpty(),i=wr.TRANSLATE_SMALL,n=wr.TRANSLATE_BIG;return Q(this,"_keyboardManager",new Wh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(e,s){pt.initialize(e,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,s){switch(e){case Z.FREETEXT_SIZE:ht._defaultFontSize=s;break;case Z.FREETEXT_COLOR:ht._defaultColor=s;break}}updateParams(e,s){switch(e){case Z.FREETEXT_SIZE:w(this,Pt,lp).call(this,s);break;case Z.FREETEXT_COLOR:w(this,Pt,cp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Z.FREETEXT_SIZE,ht._defaultFontSize],[Z.FREETEXT_COLOR,ht._defaultColor||pt._defaultLineColor]]}get propertiesToUpdate(){return[[Z.FREETEXT_SIZE,r(this,_e)],[Z.FREETEXT_COLOR,r(this,Ke)]]}_translateEmpty(e,s){this._uiManager.translateSelectedEditors(e,s,!0)}getInitialTranslation(){const e=this.parentScale;return[-ht._internalPadding*e,-(ht._internalPadding+r(this,_e))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(j.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,Qn,new AbortController);const e=this._uiManager.combinedSignal(r(this,Qn));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",r(this,Ah)),this._isDraggable=!0,(e=r(this,Qn))==null||e.abort(),g(this,Qn,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var s;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=r(this,Se),s=g(this,Se,w(this,Pt,dp).call(this).trimEnd());if(e===s)return;const i=n=>{if(g(this,Se,n),!n){this.remove();return}w(this,Pt,Al).call(this),this._uiManager.rebuild(this),w(this,Pt,yl).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(e)},mustExec:!1}),w(this,Pt,yl).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ht._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,s;(this._isCopy||this.annotationElementId)&&(e=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",r(this,Ah)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${r(this,_e)}px * var(--total-scale-factor))`,i.color=r(this,Ke),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Zd(this,this.div,["dblclick","keydown"]),this._isCopy||this.annotationElementId){const[n,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[h,l]=this.getInitialTranslation();[h,l]=this.pageTranslationToScreen(h,l);const[c,f]=this.pageDimensions,[p,b]=this.pageTranslation;let S,A;switch(this.rotation){case 0:S=e+(o[0]-p)/c,A=s+this.height-(o[1]-b)/f;break;case 90:S=e+(o[0]-p)/c,A=s-(o[1]-b)/f,[h,l]=[l,-h];break;case 180:S=e-this.width+(o[0]-p)/c,A=s-(o[1]-b)/f,[h,l]=[-h,-l];break;case 270:S=e+(o[0]-p-this.height*f)/c,A=s+(o[1]-b-this.width*c)/f,[h,l]=[-l,h];break}this.setAt(S*n,A*a,h,l)}else this._moveAfterPaste(e,s);w(this,Pt,Al).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var S,A,x;const s=e.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const n=w(S=ht,fi,md).call(S,s.getData("text")||"").replaceAll(Zh,`
`);if(!n)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:h,startOffset:l}=o,c=[],f=[];if(h.nodeType===Node.TEXT_NODE){const C=h.parentElement;if(f.push(h.nodeValue.slice(l).replaceAll(Zh,"")),C!==this.editorDiv){let T=c;for(const E of this.editorDiv.childNodes){if(E===C){T=f;continue}T.push(w(A=ht,fi,wl).call(A,E))}}c.push(h.nodeValue.slice(0,l).replaceAll(Zh,""))}else if(h===this.editorDiv){let C=c,T=0;for(const E of this.editorDiv.childNodes)T++===l&&(C=f),C.push(w(x=ht,fi,wl).call(x,E))}g(this,Se,`${c.join(`
`)}${n}${f.join(`
`)}`),w(this,Pt,Al).call(this);const p=new Range;let b=Math.sumPrecise(c.map(C=>C.length));for(const{firstChild:C}of this.editorDiv.childNodes)if(C.nodeType===Node.TEXT_NODE){const T=C.nodeValue.length;if(b<=T){p.setStart(C,b),p.setEnd(C,b);break}b-=T}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(e,s,i){var o;let n=null;if(e instanceof rp){const{data:{defaultAppearanceData:{fontSize:h,fontColor:l},rect:c,rotation:f,id:p,popupRef:b},textContent:S,textPosition:A,parent:{page:{pageNumber:x}}}=e;if(!S||S.length===0)return null;n=e={annotationType:j.FREETEXT,color:Array.from(l),fontSize:h,value:S.join(`
`),position:A,pageIndex:x-1,rect:c.slice(0),rotation:f,id:p,deleted:!1,popupRef:b}}const a=await super.deserialize(e,s,i);return g(a,_e,e.fontSize),g(a,Ke,B.makeHexColor(...e.color)),g(a,Se,w(o=ht,fi,md).call(o,e.value)),a.annotationElementId=e.id||null,a._initialData=n,a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=ht._internalPadding*this.parentScale,i=this.getRect(s,s),n=pt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:r(this,Ke)),a={annotationType:j.FREETEXT,color:n,fontSize:r(this,_e),value:w(this,Pt,up).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(a.isCopy=!0,a):this.annotationElementId&&!w(this,Pt,fp).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(e){const s=super.renderAnnotationElement(e);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${r(this,_e)}px * var(--total-scale-factor))`,i.color=r(this,Ke),s.replaceChildren();for(const a of r(this,Se).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const n=ht._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(n,n),popupContent:r(this,Se)}),s}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Ke=new WeakMap,Se=new WeakMap,Ah=new WeakMap,Qn=new WeakMap,_e=new WeakMap,Pt=new WeakSet,lp=function(e){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-r(this,_e))*this.parentScale),g(this,_e,n),w(this,Pt,yl).call(this)},i=r(this,_e);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Z.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},cp=function(e){const s=n=>{g(this,Ke,this.editorDiv.style.color=n)},i=r(this,Ke);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Z.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},dp=function(){var i;const e=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(w(i=ht,fi,wl).call(i,n)),s=n);return e.join(`
`)},yl=function(){const[e,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:a}=this,o=a.style.display,h=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",n.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/s):(this.width=i.height/e,this.height=i.width/s),this.fixAndSetPosition()},fi=new WeakSet,wl=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Zh,"")},Al=function(){if(this.editorDiv.replaceChildren(),!!r(this,Se))for(const e of r(this,Se).split(`
`)){const s=document.createElement("div");s.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(s)}},up=function(){return r(this,Se).replaceAll(" "," ")},md=function(e){return e.replaceAll(" "," ")},fp=function(e){const{value:s,fontSize:i,color:n,pageIndex:a}=this._initialData;return this._hasBeenMoved||e.value!==s||e.fontSize!==i||e.color.some((o,h)=>o!==n[h])||e.pageIndex!==a},y(ht,fi),O(ht,"_freeTextDefaultContent",""),O(ht,"_internalPadding",0),O(ht,"_defaultColor",null),O(ht,"_defaultFontSize",10),O(ht,"_type","freetext"),O(ht,"_editorType",j.FREETEXT);let gd=ht;class D{toSVGPath(){at("Abstract method `toSVGPath` must be implemented.")}get box(){at("Abstract getter `box` must be implemented.")}serialize(t,e){at("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,a){a||(a=new Float32Array(t.length));for(let o=0,h=t.length;o<h;o+=2)a[o]=e+t[o]*i,a[o+1]=s+t[o+1]*n;return a}static _rescaleAndSwap(t,e,s,i,n,a){a||(a=new Float32Array(t.length));for(let o=0,h=t.length;o<h;o+=2)a[o]=e+t[o+1]*i,a[o+1]=s+t[o]*n;return a}static _translate(t,e,s,i){i||(i=new Float32Array(t.length));for(let n=0,a=t.length;n<a;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,a){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+a)/6,(s+n)/2,(i+a)/2]}}O(D,"PRECISION",1e-4);var xe,Qe,va,Sa,vs,K,Zn,Jn,vh,Sh,_a,xa,Gi,_h,ic,nc,Lt,ao,pp,gp,mp,bp,yp,wp;const Fs=class Fs{constructor({x:t,y:e},s,i,n,a,o=0){y(this,Lt);y(this,xe);y(this,Qe,[]);y(this,va);y(this,Sa);y(this,vs,[]);y(this,K,new Float32Array(18));y(this,Zn);y(this,Jn);y(this,vh);y(this,Sh);y(this,_a);y(this,xa);y(this,Gi,[]);g(this,xe,s),g(this,xa,n*i),g(this,Sa,a),r(this,K).set([NaN,NaN,NaN,NaN,t,e],6),g(this,va,o),g(this,Sh,r(Fs,_h)*i),g(this,vh,r(Fs,nc)*i),g(this,_a,i),r(this,Gi).push(t,e)}isEmpty(){return isNaN(r(this,K)[8])}add({x:t,y:e}){var R;g(this,Zn,t),g(this,Jn,e);const[s,i,n,a]=r(this,xe);let[o,h,l,c]=r(this,K).subarray(8,12);const f=t-l,p=e-c,b=Math.hypot(f,p);if(b<r(this,vh))return!1;const S=b-r(this,Sh),A=S/b,x=A*f,C=A*p;let T=o,E=h;o=l,h=c,l+=x,c+=C,(R=r(this,Gi))==null||R.push(t,e);const u=-C/S,m=x/S,v=u*r(this,xa),_=m*r(this,xa);return r(this,K).set(r(this,K).subarray(2,8),0),r(this,K).set([l+v,c+_],4),r(this,K).set(r(this,K).subarray(14,18),12),r(this,K).set([l-v,c-_],16),isNaN(r(this,K)[6])?(r(this,vs).length===0&&(r(this,K).set([o+v,h+_],2),r(this,vs).push(NaN,NaN,NaN,NaN,(o+v-s)/n,(h+_-i)/a),r(this,K).set([o-v,h-_],14),r(this,Qe).push(NaN,NaN,NaN,NaN,(o-v-s)/n,(h-_-i)/a)),r(this,K).set([T,E,o,h,l,c],6),!this.isEmpty()):(r(this,K).set([T,E,o,h,l,c],6),Math.abs(Math.atan2(E-h,T-o)-Math.atan2(C,x))<Math.PI/2?([o,h,l,c]=r(this,K).subarray(2,6),r(this,vs).push(NaN,NaN,NaN,NaN,((o+l)/2-s)/n,((h+c)/2-i)/a),[o,h,T,E]=r(this,K).subarray(14,18),r(this,Qe).push(NaN,NaN,NaN,NaN,((T+o)/2-s)/n,((E+h)/2-i)/a),!0):([T,E,o,h,l,c]=r(this,K).subarray(0,6),r(this,vs).push(((T+5*o)/6-s)/n,((E+5*h)/6-i)/a,((5*o+l)/6-s)/n,((5*h+c)/6-i)/a,((o+l)/2-s)/n,((h+c)/2-i)/a),[l,c,o,h,T,E]=r(this,K).subarray(12,18),r(this,Qe).push(((T+5*o)/6-s)/n,((E+5*h)/6-i)/a,((5*o+l)/6-s)/n,((5*h+c)/6-i)/a,((o+l)/2-s)/n,((h+c)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=r(this,vs),e=r(this,Qe);if(isNaN(r(this,K)[6])&&!this.isEmpty())return w(this,Lt,pp).call(this);const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);w(this,Lt,mp).call(this,s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return w(this,Lt,gp).call(this,s),s.join(" ")}newFreeDrawOutline(t,e,s,i,n,a){return new Ap(t,e,s,i,n,a)}getOutlines(){var f;const t=r(this,vs),e=r(this,Qe),s=r(this,K),[i,n,a,o]=r(this,xe),h=new Float32Array((((f=r(this,Gi))==null?void 0:f.length)??0)+2);for(let p=0,b=h.length-2;p<b;p+=2)h[p]=(r(this,Gi)[p]-i)/a,h[p+1]=(r(this,Gi)[p+1]-n)/o;if(h[h.length-2]=(r(this,Zn)-i)/a,h[h.length-1]=(r(this,Jn)-n)/o,isNaN(s[6])&&!this.isEmpty())return w(this,Lt,bp).call(this,h);const l=new Float32Array(r(this,vs).length+24+r(this,Qe).length);let c=t.length;for(let p=0;p<c;p+=2){if(isNaN(t[p])){l[p]=l[p+1]=NaN;continue}l[p]=t[p],l[p+1]=t[p+1]}c=w(this,Lt,wp).call(this,l,c);for(let p=e.length-6;p>=6;p-=6)for(let b=0;b<6;b+=2){if(isNaN(e[p+b])){l[c]=l[c+1]=NaN,c+=2;continue}l[c]=e[p+b],l[c+1]=e[p+b+1],c+=2}return w(this,Lt,yp).call(this,l,c),this.newFreeDrawOutline(l,h,r(this,xe),r(this,_a),r(this,va),r(this,Sa))}};xe=new WeakMap,Qe=new WeakMap,va=new WeakMap,Sa=new WeakMap,vs=new WeakMap,K=new WeakMap,Zn=new WeakMap,Jn=new WeakMap,vh=new WeakMap,Sh=new WeakMap,_a=new WeakMap,xa=new WeakMap,Gi=new WeakMap,_h=new WeakMap,ic=new WeakMap,nc=new WeakMap,Lt=new WeakSet,ao=function(){const t=r(this,K).subarray(4,6),e=r(this,K).subarray(16,18),[s,i,n,a]=r(this,xe);return[(r(this,Zn)+(t[0]-e[0])/2-s)/n,(r(this,Jn)+(t[1]-e[1])/2-i)/a,(r(this,Zn)+(e[0]-t[0])/2-s)/n,(r(this,Jn)+(e[1]-t[1])/2-i)/a]},pp=function(){const[t,e,s,i]=r(this,xe),[n,a,o,h]=w(this,Lt,ao).call(this);return`M${(r(this,K)[2]-t)/s} ${(r(this,K)[3]-e)/i} L${(r(this,K)[4]-t)/s} ${(r(this,K)[5]-e)/i} L${n} ${a} L${o} ${h} L${(r(this,K)[16]-t)/s} ${(r(this,K)[17]-e)/i} L${(r(this,K)[14]-t)/s} ${(r(this,K)[15]-e)/i} Z`},gp=function(t){const e=r(this,Qe);t.push(`L${e[4]} ${e[5]} Z`)},mp=function(t){const[e,s,i,n]=r(this,xe),a=r(this,K).subarray(4,6),o=r(this,K).subarray(16,18),[h,l,c,f]=w(this,Lt,ao).call(this);t.push(`L${(a[0]-e)/i} ${(a[1]-s)/n} L${h} ${l} L${c} ${f} L${(o[0]-e)/i} ${(o[1]-s)/n}`)},bp=function(t){const e=r(this,K),[s,i,n,a]=r(this,xe),[o,h,l,c]=w(this,Lt,ao).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/a,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/a,NaN,NaN,NaN,NaN,o,h,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/a,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/a],0),this.newFreeDrawOutline(f,t,r(this,xe),r(this,_a),r(this,va),r(this,Sa))},yp=function(t,e){const s=r(this,Qe);return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6},wp=function(t,e){const s=r(this,K).subarray(4,6),i=r(this,K).subarray(16,18),[n,a,o,h]=r(this,xe),[l,c,f,p]=w(this,Lt,ao).call(this);return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/h,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/h],e),e+=24},y(Fs,_h,8),y(Fs,ic,2),y(Fs,nc,r(Fs,_h)+r(Fs,ic));let Ol=Fs;var Ea,tr,ei,xh,Ee,Eh,At,rc,vp;class Ap extends D{constructor(e,s,i,n,a,o){super();y(this,rc);y(this,Ea);y(this,tr,new Float32Array(4));y(this,ei);y(this,xh);y(this,Ee);y(this,Eh);y(this,At);g(this,At,e),g(this,Ee,s),g(this,Ea,i),g(this,Eh,n),g(this,ei,a),g(this,xh,o),this.lastPoint=[NaN,NaN],w(this,rc,vp).call(this,o);const[h,l,c,f]=r(this,tr);for(let p=0,b=e.length;p<b;p+=2)e[p]=(e[p]-h)/c,e[p+1]=(e[p+1]-l)/f;for(let p=0,b=s.length;p<b;p+=2)s[p]=(s[p]-h)/c,s[p+1]=(s[p+1]-l)/f}toSVGPath(){const e=[`M${r(this,At)[4]} ${r(this,At)[5]}`];for(let s=6,i=r(this,At).length;s<i;s+=6){if(isNaN(r(this,At)[s])){e.push(`L${r(this,At)[s+4]} ${r(this,At)[s+5]}`);continue}e.push(`C${r(this,At)[s]} ${r(this,At)[s+1]} ${r(this,At)[s+2]} ${r(this,At)[s+3]} ${r(this,At)[s+4]} ${r(this,At)[s+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,s,i,n],a){const o=i-e,h=n-s;let l,c;switch(a){case 0:l=D._rescale(r(this,At),e,n,o,-h),c=D._rescale(r(this,Ee),e,n,o,-h);break;case 90:l=D._rescaleAndSwap(r(this,At),e,s,o,h),c=D._rescaleAndSwap(r(this,Ee),e,s,o,h);break;case 180:l=D._rescale(r(this,At),i,s,-o,h),c=D._rescale(r(this,Ee),i,s,-o,h);break;case 270:l=D._rescaleAndSwap(r(this,At),i,n,-o,-h),c=D._rescaleAndSwap(r(this,Ee),i,n,-o,-h);break}return{outline:Array.from(l),points:[Array.from(c)]}}get box(){return r(this,tr)}newOutliner(e,s,i,n,a,o=0){return new Ol(e,s,i,n,a,o)}getNewOutline(e,s){const[i,n,a,o]=r(this,tr),[h,l,c,f]=r(this,Ea),p=a*c,b=o*f,S=i*c+h,A=n*f+l,x=this.newOutliner({x:r(this,Ee)[0]*p+S,y:r(this,Ee)[1]*b+A},r(this,Ea),r(this,Eh),e,r(this,xh),s??r(this,ei));for(let C=2;C<r(this,Ee).length;C+=2)x.add({x:r(this,Ee)[C]*p+S,y:r(this,Ee)[C+1]*b+A});return x.getOutlines()}}Ea=new WeakMap,tr=new WeakMap,ei=new WeakMap,xh=new WeakMap,Ee=new WeakMap,Eh=new WeakMap,At=new WeakMap,rc=new WeakSet,vp=function(e){const s=r(this,At);let i=s[4],n=s[5];const a=[i,n,i,n];let o=i,h=n;const l=e?Math.max:Math.min;for(let f=6,p=s.length;f<p;f+=6){const b=s[f+4],S=s[f+5];if(isNaN(s[f]))B.pointBoundingBox(b,S,a),h<S?(o=b,h=S):h===S&&(o=l(o,b));else{const A=[1/0,1/0,-1/0,-1/0];B.bezierBoundingBox(i,n,...s.slice(f,f+6),A),B.rectBoundingBox(...A,a),h<A[3]?(o=A[2],h=A[3]):h===A[3]&&(o=l(o,A[2]))}i=b,n=S}const c=r(this,tr);c[0]=a[0]-r(this,ei),c[1]=a[1]-r(this,ei),c[2]=a[2]-a[0]+2*r(this,ei),c[3]=a[3]-a[1]+2*r(this,ei),this.lastPoint=[o,h]};var Ch,Ph,zi,Ze,le,Sp,vl,_p,xp,yd;class bd{constructor(t,e=0,s=0,i=!0){y(this,le);y(this,Ch);y(this,Ph);y(this,zi,[]);y(this,Ze,[]);const n=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:b,y:S,width:A,height:x}of t){const C=Math.floor((b-e)/a)*a,T=Math.ceil((b+A+e)/a)*a,E=Math.floor((S-e)/a)*a,u=Math.ceil((S+x+e)/a)*a,m=[C,E,u,!0],v=[T,E,u,!1];r(this,zi).push(m,v),B.rectBoundingBox(C,E,T,u,n)}const o=n[2]-n[0]+2*s,h=n[3]-n[1]+2*s,l=n[0]-s,c=n[1]-s,f=r(this,zi).at(i?-1:-2),p=[f[0],f[2]];for(const b of r(this,zi)){const[S,A,x]=b;b[0]=(S-l)/o,b[1]=(A-c)/h,b[2]=(x-c)/h}g(this,Ch,new Float32Array([l,c,o,h])),g(this,Ph,p)}getOutlines(){r(this,zi).sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of r(this,zi))e[3]?(t.push(...w(this,le,yd).call(this,e)),w(this,le,_p).call(this,e)):(w(this,le,xp).call(this,e),t.push(...w(this,le,yd).call(this,e)));return w(this,le,Sp).call(this,t)}}Ch=new WeakMap,Ph=new WeakMap,zi=new WeakMap,Ze=new WeakMap,le=new WeakSet,Sp=function(t){const e=[],s=new Set;for(const a of t){const[o,h,l]=a;e.push([o,h,a],[o,l,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){const h=e[a][2],l=e[a+1][2];h.push(l),l.push(h),s.add(h),s.add(l)}const i=[];let n;for(;s.size>0;){const a=s.values().next().value;let[o,h,l,c,f]=a;s.delete(a);let p=o,b=h;for(n=[o,l],i.push(n);;){let S;if(s.has(c))S=c;else if(s.has(f))S=f;else break;s.delete(S),[o,h,l,c,f]=S,p!==o&&(n.push(p,b,o,b===h?h:l),p=o),b=b===h?l:h}n.push(p,b)}return new Ym(i,r(this,Ch),r(this,Ph))},vl=function(t){const e=r(this,Ze);let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,a=e[n][0];if(a===t)return n;a<t?s=n+1:i=n-1}return i+1},_p=function([,t,e]){const s=w(this,le,vl).call(this,t);r(this,Ze).splice(s,0,[t,e])},xp=function([,t,e]){const s=w(this,le,vl).call(this,t);for(let i=s;i<r(this,Ze).length;i++){const[n,a]=r(this,Ze)[i];if(n!==t)break;if(n===t&&a===e){r(this,Ze).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,a]=r(this,Ze)[i];if(n!==t)break;if(n===t&&a===e){r(this,Ze).splice(i,1);return}}},yd=function(t){const[e,s,i]=t,n=[[e,s,i]],a=w(this,le,vl).call(this,i);for(let o=0;o<a;o++){const[h,l]=r(this,Ze)[o];for(let c=0,f=n.length;c<f;c++){const[,p,b]=n[c];if(!(l<=p||b<=h)){if(p>=h){if(b>l)n[c][1]=l;else{if(f===1)return[];n.splice(c,1),c--,f--}continue}n[c][2]=h,b>l&&n.push([e,l,b])}}}return n};var Th,Ca;class Ym extends D{constructor(e,s,i){super();y(this,Th);y(this,Ca);g(this,Ca,e),g(this,Th,s),this.lastPoint=i}toSVGPath(){const e=[];for(const s of r(this,Ca)){let[i,n]=s;e.push(`M${i} ${n}`);for(let a=2;a<s.length;a+=2){const o=s[a],h=s[a+1];o===i?(e.push(`V${h}`),n=h):h===n&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,s,i,n],a){const o=[],h=i-e,l=n-s;for(const c of r(this,Ca)){const f=new Array(c.length);for(let p=0;p<c.length;p+=2)f[p]=e+c[p]*h,f[p+1]=n-c[p+1]*l;o.push(f)}return o}get box(){return r(this,Th)}get classNamesForOutlining(){return["highlightOutline"]}}Th=new WeakMap,Ca=new WeakMap;class wd extends Ol{newFreeDrawOutline(t,e,s,i,n,a){return new Km(t,e,s,i,n,a)}}class Km extends Ap{newOutliner(t,e,s,i,n,a=0){return new wd(t,e,s,i,n,a)}}var Je,er,Pa,Mt,Rh,Ta,Ih,Mh,Wi,ts,Ra,Lh,rt,Ad,vd,Sd,hn,Ep,bi;const de=class de{constructor({editor:t=null,uiManager:e=null}){y(this,rt);y(this,Je,null);y(this,er,null);y(this,Pa);y(this,Mt,null);y(this,Rh,!1);y(this,Ta,!1);y(this,Ih,null);y(this,Mh);y(this,Wi,null);y(this,ts,null);y(this,Ra);var s;t?(g(this,Ta,!1),g(this,Ra,Z.HIGHLIGHT_COLOR),g(this,Ih,t)):(g(this,Ta,!0),g(this,Ra,Z.HIGHLIGHT_DEFAULT_COLOR)),g(this,ts,(t==null?void 0:t._uiManager)||e),g(this,Mh,r(this,ts)._eventBus),g(this,Pa,(t==null?void 0:t.color)||((s=r(this,ts))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),r(de,Lh)||g(de,Lh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Q(this,"_keyboardManager",new Wh([[["Escape","mac+Escape"],de.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],de.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],de.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],de.prototype._moveToPrevious],[["Home","mac+Home"],de.prototype._moveToBeginning],[["End","mac+End"],de.prototype._moveToEnd]]))}renderButton(){const t=g(this,Je,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=r(this,ts)._signal;t.addEventListener("click",w(this,rt,hn).bind(this),{signal:e}),t.addEventListener("keydown",w(this,rt,Sd).bind(this),{signal:e});const s=g(this,er,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=r(this,Pa),t.append(s),t}renderMainDropdown(){const t=g(this,Mt,w(this,rt,Ad).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===r(this,Je)){w(this,rt,hn).call(this,t);return}const e=t.target.getAttribute("data-color");e&&w(this,rt,vd).call(this,e,t)}_moveToNext(t){var e,s;if(!r(this,rt,bi)){w(this,rt,hn).call(this,t);return}if(t.target===r(this,Je)){(e=r(this,Mt).firstChild)==null||e.focus();return}(s=t.target.nextSibling)==null||s.focus()}_moveToPrevious(t){var e,s;if(t.target===((e=r(this,Mt))==null?void 0:e.firstChild)||t.target===r(this,Je)){r(this,rt,bi)&&this._hideDropdownFromKeyboard();return}r(this,rt,bi)||w(this,rt,hn).call(this,t),(s=t.target.previousSibling)==null||s.focus()}_moveToBeginning(t){var e;if(!r(this,rt,bi)){w(this,rt,hn).call(this,t);return}(e=r(this,Mt).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!r(this,rt,bi)){w(this,rt,hn).call(this,t);return}(e=r(this,Mt).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=r(this,Mt))==null||t.classList.add("hidden"),(e=r(this,Wi))==null||e.abort(),g(this,Wi,null)}_hideDropdownFromKeyboard(){var t;if(!r(this,Ta)){if(!r(this,rt,bi)){(t=r(this,Ih))==null||t.unselect();return}this.hideDropdown(),r(this,Je).focus({preventScroll:!0,focusVisible:r(this,Rh)})}}updateColor(t){if(r(this,er)&&(r(this,er).style.backgroundColor=t),!r(this,Mt))return;const e=r(this,ts).highlightColors.values();for(const s of r(this,Mt).children)s.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=r(this,Je))==null||t.remove(),g(this,Je,null),g(this,er,null),(e=r(this,Mt))==null||e.remove(),g(this,Mt,null)}};Je=new WeakMap,er=new WeakMap,Pa=new WeakMap,Mt=new WeakMap,Rh=new WeakMap,Ta=new WeakMap,Ih=new WeakMap,Mh=new WeakMap,Wi=new WeakMap,ts=new WeakMap,Ra=new WeakMap,Lh=new WeakMap,rt=new WeakSet,Ad=function(){const t=document.createElement("div"),e=r(this,ts)._signal;t.addEventListener("contextmenu",rs,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of r(this,ts).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",r(de,Lh)[s]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=i,n.setAttribute("aria-selected",i===r(this,Pa)),n.addEventListener("click",w(this,rt,vd).bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",w(this,rt,Sd).bind(this),{signal:e}),t},vd=function(t,e){e.stopPropagation(),r(this,Mh).dispatch("switchannotationeditorparams",{source:this,type:r(this,Ra),value:t})},Sd=function(t){de._keyboardManager.exec(this,t)},hn=function(t){if(r(this,rt,bi)){this.hideDropdown();return}if(g(this,Rh,t.detail===0),r(this,Wi)||(g(this,Wi,new AbortController),window.addEventListener("pointerdown",w(this,rt,Ep).bind(this),{signal:r(this,ts).combinedSignal(r(this,Wi))})),r(this,Mt)){r(this,Mt).classList.remove("hidden");return}const e=g(this,Mt,w(this,rt,Ad).call(this));r(this,Je).append(e)},Ep=function(t){var e;(e=r(this,Mt))!=null&&e.contains(t.target)||this.hideDropdown()},bi=function(){return r(this,Mt)&&!r(this,Mt).classList.contains("hidden")},y(de,Lh,null);let Bl=de;var Ia,kh,si,sr,Ma,pe,Dh,Fh,ir,He,Ce,zt,La,ii,te,ka,$e,Nh,X,_d,Sl,Cp,Pp,Tp,xd,ln,We,Mr,Rp,_l,oo,Ip,Mp,Lp,kp,Dp;const et=class et extends pt{constructor(e){super({...e,name:"highlightEditor"});y(this,X);y(this,Ia,null);y(this,kh,0);y(this,si);y(this,sr,null);y(this,Ma,null);y(this,pe,null);y(this,Dh,null);y(this,Fh,0);y(this,ir,null);y(this,He,null);y(this,Ce,null);y(this,zt,!1);y(this,La,null);y(this,ii);y(this,te,null);y(this,ka,"");y(this,$e);y(this,Nh,"");this.color=e.color||et._defaultColor,g(this,$e,e.thickness||et._defaultThickness),g(this,ii,e.opacity||et._defaultOpacity),g(this,si,e.boxes||null),g(this,Nh,e.methodOfCreation||""),g(this,ka,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(g(this,zt,!0),w(this,X,Sl).call(this,e),w(this,X,ln).call(this)):r(this,si)&&(g(this,Ia,e.anchorNode),g(this,kh,e.anchorOffset),g(this,Dh,e.focusNode),g(this,Fh,e.focusOffset),w(this,X,_d).call(this),w(this,X,ln).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const e=et.prototype;return Q(this,"_keyboardManager",new Wh([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:r(this,zt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:r(this,$e),methodOfCreation:r(this,Nh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,s){var i;pt.initialize(e,s),et._defaultColor||(et._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(e,s){switch(e){case Z.HIGHLIGHT_DEFAULT_COLOR:et._defaultColor=s;break;case Z.HIGHLIGHT_THICKNESS:et._defaultThickness=s;break}}translateInPage(e,s){}get toolbarPosition(){return r(this,La)}updateParams(e,s){switch(e){case Z.HIGHLIGHT_COLOR:w(this,X,Cp).call(this,s);break;case Z.HIGHLIGHT_THICKNESS:w(this,X,Pp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Z.HIGHLIGHT_DEFAULT_COLOR,et._defaultColor],[Z.HIGHLIGHT_THICKNESS,et._defaultThickness]]}get propertiesToUpdate(){return[[Z.HIGHLIGHT_COLOR,this.color||et._defaultColor],[Z.HIGHLIGHT_THICKNESS,r(this,$e)||et._defaultThickness],[Z.HIGHLIGHT_FREE,r(this,zt)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(g(this,Ma,new Bl({editor:this})),e.addColorPicker(r(this,Ma))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,X,oo).call(this))}getBaseTranslation(){return[0,0]}getRect(e,s){return super.getRect(e,s,w(this,X,oo).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){w(this,X,xd).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,X,ln).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let s=!1;this.parent&&!e?w(this,X,xd).call(this):e&&(w(this,X,ln).call(this,e),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),s&&this.select()}rotate(e){var n,a,o;const{drawLayer:s}=this.parent;let i;r(this,zt)?(e=(e-this.rotation+360)%360,i=w(n=et,We,Mr).call(n,r(this,He).box,e)):i=w(a=et,We,Mr).call(a,[this.x,this.y,this.width,this.height],e),s.updateProperties(r(this,Ce),{bbox:i,root:{"data-main-rotation":e}}),s.updateProperties(r(this,te),{bbox:w(o=et,We,Mr).call(o,r(this,pe).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();r(this,ka)&&(e.setAttribute("aria-label",r(this,ka)),e.setAttribute("role","mark")),r(this,zt)?e.classList.add("free"):this.div.addEventListener("keydown",w(this,X,Rp).bind(this),{signal:this._uiManager._signal});const s=g(this,ir,document.createElement("div"));e.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=r(this,sr);const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),Zd(this,r(this,ir),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,te),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,te),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:w(this,X,_l).call(this,!0);break;case 1:case 3:w(this,X,_l).call(this,!1);break}}select(){var e;super.select(),r(this,te)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,te),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),r(this,te)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,te),{rootClass:{selected:!1}}),r(this,zt)||w(this,X,_l).call(this,!1))}get _mustFixPosition(){return!r(this,zt)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(r(this,Ce),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(r(this,te),{rootClass:{hidden:!e}}))}static startHighlighting(e,s,{target:i,x:n,y:a}){const{x:o,y:h,width:l,height:c}=i.getBoundingClientRect(),f=new AbortController,p=e.combinedSignal(f),b=S=>{f.abort(),w(this,We,kp).call(this,e,S)};window.addEventListener("blur",b,{signal:p}),window.addEventListener("pointerup",b,{signal:p}),window.addEventListener("pointerdown",Et,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",rs,{signal:p}),i.addEventListener("pointermove",w(this,We,Lp).bind(this,e),{signal:p}),this._freeHighlight=new wd({x:n,y:a},[o,h,l,c],e.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,s,i){var A,x,C,T;let n=null;if(e instanceof op){const{data:{quadPoints:E,rect:u,rotation:m,id:v,color:_,opacity:P,popupRef:R},parent:{page:{pageNumber:M}}}=e;n=e={annotationType:j.HIGHLIGHT,color:Array.from(_),opacity:P,quadPoints:E,boxes:null,pageIndex:M-1,rect:u.slice(0),rotation:m,id:v,deleted:!1,popupRef:R}}else if(e instanceof su){const{data:{inkLists:E,rect:u,rotation:m,id:v,color:_,borderStyle:{rawWidth:P},popupRef:R},parent:{page:{pageNumber:M}}}=e;n=e={annotationType:j.HIGHLIGHT,color:Array.from(_),thickness:P,inkLists:E,boxes:null,pageIndex:M-1,rect:u.slice(0),rotation:m,id:v,deleted:!1,popupRef:R}}const{color:a,quadPoints:o,inkLists:h,opacity:l}=e,c=await super.deserialize(e,s,i);c.color=B.makeHexColor(...a),g(c,ii,l||1),h&&g(c,$e,e.thickness),c.annotationElementId=e.id||null,c._initialData=n;const[f,p]=c.pageDimensions,[b,S]=c.pageTranslation;if(o){const E=g(c,si,[]);for(let u=0;u<o.length;u+=8)E.push({x:(o[u]-b)/f,y:1-(o[u+1]-S)/p,width:(o[u+2]-o[u])/f,height:(o[u+1]-o[u+5])/p});w(A=c,X,_d).call(A),w(x=c,X,ln).call(x),c.rotate(c.rotation)}else if(h){g(c,zt,!0);const E=h[0],u={x:E[0]-b,y:p-(E[1]-S)},m=new wd(u,[0,0,f,p],1,r(c,$e)/2,!0,.001);for(let P=0,R=E.length;P<R;P+=2)u.x=E[P]-b,u.y=p-(E[P+1]-S),m.add(u);const{id:v,clipPathId:_}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:m.toSVGPath()}},!0,!0);w(C=c,X,Sl).call(C,{highlightOutlines:m.getOutlines(),highlightId:v,clipPathId:_}),w(T=c,X,ln).call(T),c.rotate(c.parentRotation)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=pt._colorManager.convert(this.color),n={annotationType:j.HIGHLIGHT,color:i,opacity:r(this,ii),thickness:r(this,$e),quadPoints:w(this,X,Ip).call(this),outlines:w(this,X,Mp).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:w(this,X,oo).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!w(this,X,Dp).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ia=new WeakMap,kh=new WeakMap,si=new WeakMap,sr=new WeakMap,Ma=new WeakMap,pe=new WeakMap,Dh=new WeakMap,Fh=new WeakMap,ir=new WeakMap,He=new WeakMap,Ce=new WeakMap,zt=new WeakMap,La=new WeakMap,ii=new WeakMap,te=new WeakMap,ka=new WeakMap,$e=new WeakMap,Nh=new WeakMap,X=new WeakSet,_d=function(){const e=new bd(r(this,si),.001);g(this,He,e.getOutlines()),[this.x,this.y,this.width,this.height]=r(this,He).box;const s=new bd(r(this,si),.0025,.001,this._uiManager.direction==="ltr");g(this,pe,s.getOutlines());const{lastPoint:i}=r(this,pe);g(this,La,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Sl=function({highlightOutlines:e,highlightId:s,clipPathId:i}){var f,p;if(g(this,He,e),g(this,pe,e.getNewOutline(r(this,$e)/2+1.5,.0025)),s>=0)g(this,Ce,s),g(this,sr,i),this.parent.drawLayer.finalizeDraw(s,{bbox:e.box,path:{d:e.toSVGPath()}}),g(this,te,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:r(this,pe).box,path:{d:r(this,pe).toSVGPath()}},!0));else if(this.parent){const b=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(r(this,Ce),{bbox:w(f=et,We,Mr).call(f,r(this,He).box,(b-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(r(this,te),{bbox:w(p=et,We,Mr).call(p,r(this,pe).box,b),path:{d:r(this,pe).toSVGPath()}})}const[a,o,h,l]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=h,this.height=l;break;case 90:{const[b,S]=this.parentDimensions;this.x=o,this.y=1-a,this.width=h*S/b,this.height=l*b/S;break}case 180:this.x=1-a,this.y=1-o,this.width=h,this.height=l;break;case 270:{const[b,S]=this.parentDimensions;this.x=1-o,this.y=a,this.width=h*S/b,this.height=l*b/S;break}}const{lastPoint:c}=r(this,pe);g(this,La,[(c[0]-a)/h,(c[1]-o)/l])},Cp=function(e){const s=(a,o)=>{var h,l;this.color=a,g(this,ii,o),(h=this.parent)==null||h.drawLayer.updateProperties(r(this,Ce),{root:{fill:a,"fill-opacity":o}}),(l=r(this,Ma))==null||l.updateColor(a)},i=this.color,n=r(this,ii);this.addCommands({cmd:s.bind(this,e,et._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Z.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},Pp=function(e){const s=r(this,$e),i=n=>{g(this,$e,n),w(this,X,Tp).call(this,n)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Z.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},Tp=function(e){if(!r(this,zt))return;w(this,X,Sl).call(this,{highlightOutlines:r(this,He).getNewOutline(e/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},xd=function(){r(this,Ce)===null||!this.parent||(this.parent.drawLayer.remove(r(this,Ce)),g(this,Ce,null),this.parent.drawLayer.remove(r(this,te)),g(this,te,null))},ln=function(e=this.parent){r(this,Ce)===null&&({id:se(this,Ce)._,clipPathId:se(this,sr)._}=e.drawLayer.draw({bbox:r(this,He).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":r(this,ii)},rootClass:{highlight:!0,free:r(this,zt)},path:{d:r(this,He).toSVGPath()}},!1,!0),g(this,te,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:r(this,zt)},bbox:r(this,pe).box,path:{d:r(this,pe).toSVGPath()}},r(this,zt))),r(this,ir)&&(r(this,ir).style.clipPath=r(this,sr)))},We=new WeakSet,Mr=function([e,s,i,n],a){switch(a){case 90:return[1-s-n,e,n,i];case 180:return[1-e-i,1-s-n,i,n];case 270:return[s,1-e-i,n,i]}return[e,s,i,n]},Rp=function(e){et._keyboardManager.exec(this,e)},_l=function(e){if(!r(this,Ia))return;const s=window.getSelection();e?s.setPosition(r(this,Ia),r(this,kh)):s.setPosition(r(this,Dh),r(this,Fh))},oo=function(){return r(this,zt)?this.rotation:0},Ip=function(){if(r(this,zt))return null;const[e,s]=this.pageDimensions,[i,n]=this.pageTranslation,a=r(this,si),o=new Float32Array(a.length*8);let h=0;for(const{x:l,y:c,width:f,height:p}of a){const b=l*e+i,S=(1-c)*s+n;o[h]=o[h+4]=b,o[h+1]=o[h+3]=S,o[h+2]=o[h+6]=b+f*e,o[h+5]=o[h+7]=S-p*s,h+=8}return o},Mp=function(e){return r(this,He).serialize(e,w(this,X,oo).call(this))},Lp=function(e,s){this._freeHighlight.add(s)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},kp=function(e,s){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Dp=function(e){const{color:s}=this._initialData;return e.color.some((i,n)=>i!==s[n])},y(et,We),O(et,"_defaultColor",null),O(et,"_defaultOpacity",1),O(et,"_defaultThickness",12),O(et,"_type","highlight"),O(et,"_editorType",j.HIGHLIGHT),O(et,"_freeHighlightId",-1),O(et,"_freeHighlight",null),O(et,"_freeHighlightClipId","");let Hl=et;var nr;class Fp{constructor(){y(this,nr,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){r(this,nr)[t]=e}toSVGProperties(){const t=r(this,nr);return g(this,nr,Object.create(null)),{root:t}}reset(){g(this,nr,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){at("Not implemented")}}nr=new WeakMap;var Pe,Da,Nt,rr,ar,Ui,Vi,ji,or,J,Ed,Cd,Pd,ho,Np,xl,lo,Lr;const N=class N extends pt{constructor(e){super(e);y(this,J);y(this,Pe,null);y(this,Da);O(this,"_drawId",null);g(this,Da,e.mustBeCommitted||!1),this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(w(this,J,Ed).call(this,e),w(this,J,ho).call(this))}static _mergeSVGProperties(e,s){const i=new Set(Object.keys(e));for(const[n,a]of Object.entries(s))i.has(n)?Object.assign(e[n],a):e[n]=a;return e}static getDefaultDrawingOptions(e){at("Not implemented")}static get typesMap(){at("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,s){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(r(N,Nt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,s){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,s)}static get defaultPropertiesToUpdate(){const e=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)e.push([i,s[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)e.push([i,s[n]]);return e}_updateProperty(e,s,i){const n=this._drawingOptions,a=n[s],o=h=>{var c;n.updateProperty(s,h);const l=r(this,Pe).updateProperty(s,h);l&&w(this,J,lo).call(this,l),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,N._mergeSVGProperties(r(this,Pe).getPathResizingSVGProperties(w(this,J,xl).call(this)),{bbox:w(this,J,Lr).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,N._mergeSVGProperties(r(this,Pe).getPathResizedSVGProperties(w(this,J,xl).call(this)),{bbox:w(this,J,Lr).call(this)}))}_onTranslating(e,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:w(this,J,Lr).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,N._mergeSVGProperties(r(this,Pe).getPathTranslatedSVGProperties(w(this,J,xl).call(this),this.parentDimensions),{bbox:w(this,J,Lr).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,r(this,Da)&&(g(this,Da,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){w(this,J,Pd).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,J,ho).call(this),w(this,J,lo).call(this,r(this,Pe).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let s=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),w(this,J,Pd).call(this)):e&&(this._uiManager.addShouldRescale(this),w(this,J,ho).call(this,e),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,N._mergeSVGProperties({bbox:w(this,J,Lr).call(this)},r(this,Pe).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,J,lo).call(this,r(this,Pe).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,s;this._isCopy&&(e=this.x,s=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,s),i}static createDrawerInstance(e,s,i,n,a){at("Not implemented")}static startDrawing(e,s,i,n){var x;const{target:a,offsetX:o,offsetY:h,pointerId:l,pointerType:c}=n;if(r(N,Vi)&&r(N,Vi)!==c)return;const{viewport:{rotation:f}}=e,{width:p,height:b}=a.getBoundingClientRect(),S=g(N,rr,new AbortController),A=e.combinedSignal(S);if(r(N,Ui)||g(N,Ui,l),r(N,Vi)??g(N,Vi,c),window.addEventListener("pointerup",C=>{var T;r(N,Ui)===C.pointerId?this._endDraw(C):(T=r(N,ji))==null||T.delete(C.pointerId)},{signal:A}),window.addEventListener("pointercancel",C=>{var T;r(N,Ui)===C.pointerId?this._currentParent.endDrawingSession():(T=r(N,ji))==null||T.delete(C.pointerId)},{signal:A}),window.addEventListener("pointerdown",C=>{r(N,Vi)===C.pointerType&&((r(N,ji)||g(N,ji,new Set)).add(C.pointerId),r(N,Nt).isCancellable()&&(r(N,Nt).removeLastElement(),r(N,Nt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:A}),window.addEventListener("contextmenu",rs,{signal:A}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:A}),a.addEventListener("touchmove",C=>{C.timeStamp===r(N,or)&&Et(C)},{signal:A}),e.toggleDrawing(),(x=s._editorUndoBar)==null||x.hide(),r(N,Nt)){e.drawLayer.updateProperties(this._currentDrawId,r(N,Nt).startNew(o,h,p,b,f));return}s.updateUIForDefaultProperties(this),g(N,Nt,this.createDrawerInstance(o,h,p,b,f)),g(N,ar,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(r(N,ar).toSVGProperties(),r(N,Nt).defaultSVGProperties),!0,!1)}static _drawMove(e){var a;if(g(N,or,-1),!r(N,Nt))return;const{offsetX:s,offsetY:i,pointerId:n}=e;if(r(N,Ui)===n){if(((a=r(N,ji))==null?void 0:a.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r(N,Nt).add(s,i)),g(N,or,e.timeStamp),Et(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,g(N,Nt,null),g(N,ar,null),g(N,Vi,null),g(N,or,NaN)),r(N,rr)&&(r(N,rr).abort(),g(N,rr,null),g(N,Ui,NaN),g(N,ji,null))}static _endDraw(e){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,r(N,Nt).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=r(N,Nt),n=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:Z.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Z.DRAW_STEP),!r(N,Nt).isEmpty()){const{pageDimensions:[i,n],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r(N,Nt).getOutlines(i*a,n*a,a,this._INNER_MARGIN),drawingOptions:r(N,ar),mustBeCommitted:!e});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,s,i,n,a,o){at("Not implemented")}static async deserialize(e,s,i){var f,p;const{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:h}}=s.viewport,l=this.deserializeDraw(o,h,n,a,this._INNER_MARGIN,e),c=await super.deserialize(e,s,i);return c.createDrawingOptions(e),w(f=c,J,Ed).call(f,{drawOutlines:l}),w(p=c,J,ho).call(p),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){const[s,i]=this.pageTranslation,[n,a]=this.pageDimensions;return r(this,Pe).serialize([s,i,n,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Pe=new WeakMap,Da=new WeakMap,Nt=new WeakMap,rr=new WeakMap,ar=new WeakMap,Ui=new WeakMap,Vi=new WeakMap,ji=new WeakMap,or=new WeakMap,J=new WeakSet,Ed=function({drawOutlines:e,drawId:s,drawingOptions:i}){g(this,Pe,e),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,e.defaultProperties)):this._drawId=w(this,J,Cd).call(this,e,this.parent),w(this,J,lo).call(this,e.box)},Cd=function(e,s){const{id:i}=s.drawLayer.draw(N._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i},Pd=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},ho=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,J,Cd).call(this,r(this,Pe),e)}},Np=function([e,s,i,n]){const{parentDimensions:[a,o],rotation:h}=this;switch(h){case 90:return[s,1-e,i*(o/a),n*(a/o)];case 180:return[1-e,1-s,i,n];case 270:return[1-s,e,i*(o/a),n*(a/o)];default:return[e,s,i,n]}},xl=function(){const{x:e,y:s,width:i,height:n,parentDimensions:[a,o],rotation:h}=this;switch(h){case 90:return[1-s,e,i*(a/o),n*(o/a)];case 180:return[1-e,1-s,i,n];case 270:return[s,1-e,i*(a/o),n*(o/a)];default:return[e,s,i,n]}},lo=function(e){if([this.x,this.y,this.width,this.height]=w(this,J,Np).call(this,e),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},Lr=function(){const{x:e,y:s,width:i,height:n,rotation:a,parentRotation:o,parentDimensions:[h,l]}=this;switch((a*4+o)/90){case 1:return[1-s-n,e,n,i];case 2:return[1-e-i,1-s-n,i,n];case 3:return[s,1-e-i,n,i];case 4:return[e,s-i*(h/l),n*(l/h),i*(h/l)];case 5:return[1-s,e,i*(h/l),n*(l/h)];case 6:return[1-e-n*(l/h),1-s,n*(l/h),i*(h/l)];case 7:return[s-i*(h/l),1-e-n*(l/h),i*(h/l),n*(l/h)];case 8:return[e-i,s-n,i,n];case 9:return[1-s,e-i,n,i];case 10:return[1-e,1-s,i,n];case 11:return[s-n,1-e,n,i];case 12:return[e-n*(l/h),s,n*(l/h),i*(h/l)];case 13:return[1-s-i*(h/l),e-n*(l/h),i*(h/l),n*(l/h)];case 14:return[1-e,1-s-i*(h/l),n*(l/h),i*(h/l)];case 15:return[s,1-e,i*(h/l),n*(l/h)];default:return[e,s,i,n]}},O(N,"_currentDrawId",-1),O(N,"_currentParent",null),y(N,Nt,null),y(N,rr,null),y(N,ar,null),y(N,Ui,NaN),y(N,Vi,null),y(N,ji,null),y(N,or,NaN),O(N,"_INNER_MARGIN",3);let $l=N;var Ss,Ot,Bt,hr,Fa,re,Wt,Ge,lr,cr,dr,Na,El;class Qm{constructor(t,e,s,i,n,a){y(this,Na);y(this,Ss,new Float64Array(6));y(this,Ot);y(this,Bt);y(this,hr);y(this,Fa);y(this,re);y(this,Wt,"");y(this,Ge,0);y(this,lr,new jh);y(this,cr);y(this,dr);g(this,cr,s),g(this,dr,i),g(this,hr,n),g(this,Fa,a),[t,e]=w(this,Na,El).call(this,t,e);const o=g(this,Ot,[NaN,NaN,NaN,NaN,t,e]);g(this,re,[t,e]),g(this,Bt,[{line:o,points:r(this,re)}]),r(this,Ss).set(o,0)}updateProperty(t,e){t==="stroke-width"&&g(this,Fa,e)}isEmpty(){return!r(this,Bt)||r(this,Bt).length===0}isCancellable(){return r(this,re).length<=10}add(t,e){[t,e]=w(this,Na,El).call(this,t,e);const[s,i,n,a]=r(this,Ss).subarray(2,6),o=t-n,h=e-a;return Math.hypot(r(this,cr)*o,r(this,dr)*h)<=2?null:(r(this,re).push(t,e),isNaN(s)?(r(this,Ss).set([n,a,t,e],2),r(this,Ot).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(r(this,Ss)[0])&&r(this,Ot).splice(6,6),r(this,Ss).set([s,i,n,a,t,e],0),r(this,Ot).push(...D.createBezierPoints(s,i,n,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(r(this,re).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){g(this,cr,s),g(this,dr,i),g(this,hr,n),[t,e]=w(this,Na,El).call(this,t,e);const a=g(this,Ot,[NaN,NaN,NaN,NaN,t,e]);g(this,re,[t,e]);const o=r(this,Bt).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),r(this,Bt).push({line:a,points:r(this,re)}),r(this,Ss).set(a,0),g(this,Ge,0),this.toSVGPath(),null}getLastElement(){return r(this,Bt).at(-1)}setLastElement(t){return r(this,Bt)?(r(this,Bt).push(t),g(this,Ot,t.line),g(this,re,t.points),g(this,Ge,0),{path:{d:this.toSVGPath()}}):r(this,lr).setLastElement(t)}removeLastElement(){if(!r(this,Bt))return r(this,lr).removeLastElement();r(this,Bt).pop(),g(this,Wt,"");for(let t=0,e=r(this,Bt).length;t<e;t++){const{line:s,points:i}=r(this,Bt)[t];g(this,Ot,s),g(this,re,i),g(this,Ge,0),this.toSVGPath()}return{path:{d:r(this,Wt)}}}toSVGPath(){const t=D.svgRound(r(this,Ot)[4]),e=D.svgRound(r(this,Ot)[5]);if(r(this,re).length===2)return g(this,Wt,`${r(this,Wt)} M ${t} ${e} Z`),r(this,Wt);if(r(this,re).length<=6){const i=r(this,Wt).lastIndexOf("M");g(this,Wt,`${r(this,Wt).slice(0,i)} M ${t} ${e}`),g(this,Ge,6)}if(r(this,re).length===4){const i=D.svgRound(r(this,Ot)[10]),n=D.svgRound(r(this,Ot)[11]);return g(this,Wt,`${r(this,Wt)} L ${i} ${n}`),g(this,Ge,12),r(this,Wt)}const s=[];r(this,Ge)===0&&(s.push(`M ${t} ${e}`),g(this,Ge,6));for(let i=r(this,Ge),n=r(this,Ot).length;i<n;i+=6){const[a,o,h,l,c,f]=r(this,Ot).slice(i,i+6).map(D.svgRound);s.push(`C${a} ${o} ${h} ${l} ${c} ${f}`)}return g(this,Wt,r(this,Wt)+s.join(" ")),g(this,Ge,r(this,Ot).length),r(this,Wt)}getOutlines(t,e,s,i){const n=r(this,Bt).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),r(this,lr).build(r(this,Bt),t,e,s,r(this,hr),r(this,Fa),i),g(this,Ss,null),g(this,Ot,null),g(this,Bt,null),g(this,Wt,null),r(this,lr)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Ss=new WeakMap,Ot=new WeakMap,Bt=new WeakMap,hr=new WeakMap,Fa=new WeakMap,re=new WeakMap,Wt=new WeakMap,Ge=new WeakMap,lr=new WeakMap,cr=new WeakMap,dr=new WeakMap,Na=new WeakSet,El=function(t,e){return D._normalizePoint(t,e,r(this,cr),r(this,dr),r(this,hr))};var ae,Oh,Bh,Te,_s,xs,Oa,Ba,ur,jt,ks,Op,Bp,Hp;class jh extends D{constructor(){super(...arguments);y(this,jt);y(this,ae);y(this,Oh,0);y(this,Bh);y(this,Te);y(this,_s);y(this,xs);y(this,Oa);y(this,Ba);y(this,ur)}build(e,s,i,n,a,o,h){g(this,_s,s),g(this,xs,i),g(this,Oa,n),g(this,Ba,a),g(this,ur,o),g(this,Bh,h??0),g(this,Te,e),w(this,jt,Bp).call(this)}get thickness(){return r(this,ur)}setLastElement(e){return r(this,Te).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return r(this,Te).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:s}of r(this,Te)){if(e.push(`M${D.svgRound(s[4])} ${D.svgRound(s[5])}`),s.length===6){e.push("Z");continue}if(s.length===12&&isNaN(s[6])){e.push(`L${D.svgRound(s[10])} ${D.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[a,o,h,l,c,f]=s.subarray(i,i+6).map(D.svgRound);e.push(`C${a} ${o} ${h} ${l} ${c} ${f}`)}}return e.join("")}serialize([e,s,i,n],a){const o=[],h=[],[l,c,f,p]=w(this,jt,Op).call(this);let b,S,A,x,C,T,E,u,m;switch(r(this,Ba)){case 0:m=D._rescale,b=e,S=s+n,A=i,x=-n,C=e+l*i,T=s+(1-c-p)*n,E=e+(l+f)*i,u=s+(1-c)*n;break;case 90:m=D._rescaleAndSwap,b=e,S=s,A=i,x=n,C=e+c*i,T=s+l*n,E=e+(c+p)*i,u=s+(l+f)*n;break;case 180:m=D._rescale,b=e+i,S=s,A=-i,x=n,C=e+(1-l-f)*i,T=s+c*n,E=e+(1-l)*i,u=s+(c+p)*n;break;case 270:m=D._rescaleAndSwap,b=e+i,S=s+n,A=-i,x=-n,C=e+(1-c-p)*i,T=s+(1-l-f)*n,E=e+(1-c)*i,u=s+(1-l)*n;break}for(const{line:v,points:_}of r(this,Te))o.push(m(v,b,S,A,x,a?new Array(v.length):null)),h.push(m(_,b,S,A,x,a?new Array(_.length):null));return{lines:o,points:h,rect:[C,T,E,u]}}static deserialize(e,s,i,n,a,{paths:{lines:o,points:h},rotation:l,thickness:c}){const f=[];let p,b,S,A,x;switch(l){case 0:x=D._rescale,p=-e/i,b=s/n+1,S=1/i,A=-1/n;break;case 90:x=D._rescaleAndSwap,p=-s/n,b=-e/i,S=1/n,A=1/i;break;case 180:x=D._rescale,p=e/i+1,b=-s/n,S=-1/i,A=1/n;break;case 270:x=D._rescaleAndSwap,p=s/n+1,b=e/i+1,S=-1/n,A=-1/i;break}if(!o){o=[];for(const T of h){const E=T.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,T[0],T[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,T[0],T[1],NaN,NaN,NaN,NaN,T[2],T[3]]));continue}const u=new Float32Array(3*(E-2));o.push(u);let[m,v,_,P]=T.subarray(0,4);u.set([NaN,NaN,NaN,NaN,m,v],0);for(let R=4;R<E;R+=2){const M=T[R],I=T[R+1];u.set(D.createBezierPoints(m,v,_,P,M,I),(R-2)*3),[m,v,_,P]=[_,P,M,I]}}}for(let T=0,E=o.length;T<E;T++)f.push({line:x(o[T].map(u=>u??NaN),p,b,S,A),points:x(h[T].map(u=>u??NaN),p,b,S,A)});const C=new this.prototype.constructor;return C.build(f,i,n,1,l,c,a),C}get box(){return r(this,ae)}updateProperty(e,s){return e==="stroke-width"?w(this,jt,Hp).call(this,s):null}updateParentDimensions([e,s],i){const[n,a]=w(this,jt,ks).call(this);g(this,_s,e),g(this,xs,s),g(this,Oa,i);const[o,h]=w(this,jt,ks).call(this),l=o-n,c=h-a,f=r(this,ae);return f[0]-=l,f[1]-=c,f[2]+=2*l,f[3]+=2*c,f}updateRotation(e){return g(this,Oh,e),{path:{transform:this.rotationTransform}}}get viewBox(){return r(this,ae).map(D.svgRound).join(" ")}get defaultProperties(){const[e,s]=r(this,ae);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(e)} ${D.svgRound(s)}`}}}get rotationTransform(){const[,,e,s]=r(this,ae);let i=0,n=0,a=0,o=0,h=0,l=0;switch(r(this,Oh)){case 90:n=s/e,a=-e/s,h=e;break;case 180:i=-1,o=-1,h=e,l=s;break;case 270:n=-s/e,a=e/s,l=s;break;default:return""}return`matrix(${i} ${n} ${a} ${o} ${D.svgRound(h)} ${D.svgRound(l)})`}getPathResizingSVGProperties([e,s,i,n]){const[a,o]=w(this,jt,ks).call(this),[h,l,c,f]=r(this,ae);if(Math.abs(c-a)<=D.PRECISION||Math.abs(f-o)<=D.PRECISION){const x=e+i/2-(h+c/2),C=s+n/2-(l+f/2);return{path:{"transform-origin":`${D.svgRound(e)} ${D.svgRound(s)}`,transform:`${this.rotationTransform} translate(${x} ${C})`}}}const p=(i-2*a)/(c-2*a),b=(n-2*o)/(f-2*o),S=c/i,A=f/n;return{path:{"transform-origin":`${D.svgRound(h)} ${D.svgRound(l)}`,transform:`${this.rotationTransform} scale(${S} ${A}) translate(${D.svgRound(a)} ${D.svgRound(o)}) scale(${p} ${b}) translate(${D.svgRound(-a)} ${D.svgRound(-o)})`}}}getPathResizedSVGProperties([e,s,i,n]){const[a,o]=w(this,jt,ks).call(this),h=r(this,ae),[l,c,f,p]=h;if(h[0]=e,h[1]=s,h[2]=i,h[3]=n,Math.abs(f-a)<=D.PRECISION||Math.abs(p-o)<=D.PRECISION){const C=e+i/2-(l+f/2),T=s+n/2-(c+p/2);for(const{line:E,points:u}of r(this,Te))D._translate(E,C,T,E),D._translate(u,C,T,u);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(e)} ${D.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(i-2*a)/(f-2*a),S=(n-2*o)/(p-2*o),A=-b*(l+a)+e+a,x=-S*(c+o)+s+o;if(b!==1||S!==1||A!==0||x!==0)for(const{line:C,points:T}of r(this,Te))D._rescale(C,A,x,b,S,C),D._rescale(T,A,x,b,S,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(e)} ${D.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,s],i){const[n,a]=i,o=r(this,ae),h=e-o[0],l=s-o[1];if(r(this,_s)===n&&r(this,xs)===a)for(const{line:c,points:f}of r(this,Te))D._translate(c,h,l,c),D._translate(f,h,l,f);else{const c=r(this,_s)/n,f=r(this,xs)/a;g(this,_s,n),g(this,xs,a);for(const{line:p,points:b}of r(this,Te))D._rescale(p,h,l,c,f,p),D._rescale(b,h,l,c,f,b);o[2]*=c,o[3]*=f}return o[0]=e,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${D.svgRound(e)} ${D.svgRound(s)}`}}}get defaultSVGProperties(){const e=r(this,ae);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${D.svgRound(e[0])} ${D.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}ae=new WeakMap,Oh=new WeakMap,Bh=new WeakMap,Te=new WeakMap,_s=new WeakMap,xs=new WeakMap,Oa=new WeakMap,Ba=new WeakMap,ur=new WeakMap,jt=new WeakSet,ks=function(e=r(this,ur)){const s=r(this,Bh)+e/2*r(this,Oa);return r(this,Ba)%180===0?[s/r(this,_s),s/r(this,xs)]:[s/r(this,xs),s/r(this,_s)]},Op=function(){const[e,s,i,n]=r(this,ae),[a,o]=w(this,jt,ks).call(this,0);return[e+a,s+o,i-2*a,n-2*o]},Bp=function(){const e=g(this,ae,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of r(this,Te)){if(n.length<=12){for(let h=4,l=n.length;h<l;h+=6)B.pointBoundingBox(n[h],n[h+1],e);continue}let a=n[4],o=n[5];for(let h=6,l=n.length;h<l;h+=6){const[c,f,p,b,S,A]=n.subarray(h,h+6);B.bezierBoundingBox(a,o,c,f,p,b,S,A,e),a=S,o=A}}const[s,i]=w(this,jt,ks).call(this);e[0]=he(e[0]-s,0,1),e[1]=he(e[1]-i,0,1),e[2]=he(e[2]+s,0,1),e[3]=he(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]},Hp=function(e){const[s,i]=w(this,jt,ks).call(this);g(this,ur,e);const[n,a]=w(this,jt,ks).call(this),[o,h]=[n-s,a-i],l=r(this,ae);return l[0]-=o,l[1]-=h,l[2]+=2*o,l[3]+=2*h,l};class fc extends Fp{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:pt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new fc(this._viewParameters);return t.updateAll(this),t}}var ac,$p;const Dr=class Dr extends $l{constructor(e){super({...e,name:"inkEditor"});y(this,ac);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,s){pt.initialize(e,s),this._defaultDrawingOptions=new fc(s.viewParameters)}static getDefaultDrawingOptions(e){const s=this._defaultDrawingOptions.clone();return s.updateProperties(e),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return Q(this,"typesMap",new Map([[Z.INK_THICKNESS,"stroke-width"],[Z.INK_COLOR,"stroke"],[Z.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,s,i,n,a){return new Qm(e,s,i,n,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,s,i,n,a,o){return jh.deserialize(e,s,i,n,a,o)}static async deserialize(e,s,i){let n=null;if(e instanceof su){const{data:{inkLists:o,rect:h,rotation:l,id:c,color:f,opacity:p,borderStyle:{rawWidth:b},popupRef:S},parent:{page:{pageNumber:A}}}=e;n=e={annotationType:j.INK,color:Array.from(f),thickness:b,opacity:p,paths:{points:o},boxes:null,pageIndex:A-1,rect:h.slice(0),rotation:l,id:c,deleted:!1,popupRef:S}}const a=await super.deserialize(e,s,i);return a.annotationElementId=e.id||null,a._initialData=n,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:s,opacity:i}){this._drawingOptions=Dr.getDefaultDrawingOptions({stroke:B.makeHexColor(...e),"stroke-width":s,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":h}}=this,l={annotationType:j.INK,color:pt._colorManager.convert(a),opacity:o,thickness:h,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(l.isCopy=!0,l):this.annotationElementId&&!w(this,ac,$p).call(this,l)?null:(l.id=this.annotationElementId,l)}renderAnnotationElement(e){const{points:s,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};ac=new WeakSet,$p=function(e){const{color:s,thickness:i,opacity:n,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,h)=>o!==s[h])||e.thickness!==i||e.opacity!==n||e.pageIndex!==a},O(Dr,"_type","ink"),O(Dr,"_editorType",j.INK),O(Dr,"_defaultDrawingOptions",null);let Td=Dr;class Rd extends jh{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Jh=8,qa=3;var fr,st,Id,es,Gp,zp,Md,Cl,Wp,Up,Vp,Ld,kd,jp;class ci{static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,a,o,h){let l=new OffscreenCanvas(1,1),c=l.getContext("2d",{alpha:!1});const f=200,p=c.font=`${s} ${i} ${f}px ${e}`,{actualBoundingBoxLeft:b,actualBoundingBoxRight:S,actualBoundingBoxAscent:A,actualBoundingBoxDescent:x,fontBoundingBoxAscent:C,fontBoundingBoxDescent:T,width:E}=c.measureText(t),u=1.5,m=Math.ceil(Math.max(Math.abs(b)+Math.abs(S)||0,E)*u),v=Math.ceil(Math.max(Math.abs(A)+Math.abs(x)||f,Math.abs(C)+Math.abs(T)||f)*u);l=new OffscreenCanvas(m,v),c=l.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=p,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,m,v),c.fillStyle="black",c.fillText(t,m*(u-1)/2,v*(3-u)/2);const _=w(this,st,Ld).call(this,c.getImageData(0,0,m,v).data),P=w(this,st,Vp).call(this,_),R=w(this,st,kd).call(this,P),M=w(this,st,Md).call(this,_,m,v,R);return this.processDrawnLines({lines:{curves:M,width:m,height:v},pageWidth:n,pageHeight:a,rotation:o,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[a,o,h]=w(this,st,jp).call(this,t),[l,c]=w(this,st,Up).call(this,a,o,h,Math.hypot(o,h)*r(this,fr).sigmaSFactor,r(this,fr).sigmaR,r(this,fr).kernelSize),f=w(this,st,kd).call(this,c),p=w(this,st,Md).call(this,l,o,h,f);return this.processDrawnLines({lines:{curves:p,width:o,height:h},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:a,areContours:o}){i%180!==0&&([e,s]=[s,e]);const{curves:h,width:l,height:c}=t,f=t.thickness??0,p=[],b=Math.min(e/l,s/c),S=b/e,A=b/s,x=[];for(const{points:T}of h){const E=a?w(this,st,Wp).call(this,T):T;if(!E)continue;x.push(E);const u=E.length,m=new Float32Array(u),v=new Float32Array(3*(u===2?2:u-2));if(p.push({line:v,points:m}),u===2){m[0]=E[0]*S,m[1]=E[1]*A,v.set([NaN,NaN,NaN,NaN,m[0],m[1]],0);continue}let[_,P,R,M]=E;_*=S,P*=A,R*=S,M*=A,m.set([_,P,R,M],0),v.set([NaN,NaN,NaN,NaN,_,P],0);for(let I=4;I<u;I+=2){const $=m[I]=E[I]*S,U=m[I+1]=E[I+1]*A;v.set(D.createBezierPoints(_,P,R,M,$,U),(I-2)*3),[_,P,R,M]=[R,M,$,U]}}if(p.length===0)return null;const C=o?new Rd:new jh;return C.build(p,e,s,1,i,o?0:f,n),{outline:C,newCurves:x,areContours:o,thickness:f,width:l,height:c}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let a=1/0,o=-1/0,h=0;for(const E of t){h+=E.length;for(let u=2,m=E.length;u<m;u++){const v=E[u]-E[u-2];a=Math.min(a,v),o=Math.max(o,v)}}let l;a>=-128&&o<=127?l=Int8Array:a>=-32768&&o<=32767?l=Int16Array:l=Int32Array;const c=t.length,f=Jh+qa*c,p=new Uint32Array(f);let b=0;p[b++]=f*Uint32Array.BYTES_PER_ELEMENT+(h-2*c)*l.BYTES_PER_ELEMENT,p[b++]=0,p[b++]=i,p[b++]=n,p[b++]=e?0:1,p[b++]=Math.max(0,Math.floor(s??0)),p[b++]=c,p[b++]=l.BYTES_PER_ELEMENT;for(const E of t)p[b++]=E.length-2,p[b++]=E[0],p[b++]=E[1];const S=new CompressionStream("deflate-raw"),A=S.writable.getWriter();await A.ready,A.write(p);const x=l.prototype.constructor;for(const E of t){const u=new x(E.length-2);for(let m=2,v=E.length;m<v;m++)u[m-2]=E[m]-E[m-2];A.write(u)}A.close();const C=await new Response(S.readable).arrayBuffer(),T=new Uint8Array(C);return Xu(T)}static async decompressSignature(t){try{const e=Ag(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let a=null,o=0;for await(const E of s)a||(a=new Uint8Array(new Uint32Array(E.buffer,0,4)[0])),a.set(E,o),o+=E.length;const h=new Uint32Array(a.buffer,0,a.length>>2),l=h[1];if(l!==0)throw new Error(`Invalid version: ${l}`);const c=h[2],f=h[3],p=h[4]===0,b=h[5],S=h[6],A=h[7],x=[],C=(Jh+qa*S)*Uint32Array.BYTES_PER_ELEMENT;let T;switch(A){case Int8Array.BYTES_PER_ELEMENT:T=new Int8Array(a.buffer,C);break;case Int16Array.BYTES_PER_ELEMENT:T=new Int16Array(a.buffer,C);break;case Int32Array.BYTES_PER_ELEMENT:T=new Int32Array(a.buffer,C);break}o=0;for(let E=0;E<S;E++){const u=h[qa*E+Jh],m=new Float32Array(u+2);x.push(m);for(let v=0;v<qa-1;v++)m[v]=h[qa*E+Jh+v+1];for(let v=0;v<u;v++)m[v+2]=m[v]+T[o++]}return{areContours:p,thickness:b,outlines:x,width:c,height:f}}catch(e){return q(`decompressSignature: ${e}`),null}}}fr=new WeakMap,st=new WeakSet,Id=function(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i},es=new WeakMap,Gp=function(t,e,s,i,n,a,o){const h=w(this,st,Id).call(this,s,i,n,a);for(let l=0;l<8;l++){const c=(-l+h-o+16)%8,f=r(this,es)[2*c],p=r(this,es)[2*c+1];if(t[(s+f)*e+(i+p)]!==0)return c}return-1},zp=function(t,e,s,i,n,a,o){const h=w(this,st,Id).call(this,s,i,n,a);for(let l=0;l<8;l++){const c=(l+h+o+16)%8,f=r(this,es)[2*c],p=r(this,es)[2*c+1];if(t[(s+f)*e+(i+p)]!==0)return c}return-1},Md=function(t,e,s,i){const n=t.length,a=new Int32Array(n);for(let c=0;c<n;c++)a[c]=t[c]<=i?1:0;for(let c=1;c<s-1;c++)a[c*e]=a[c*e+e-1]=0;for(let c=0;c<e;c++)a[c]=a[e*s-1-c]=0;let o=1,h;const l=[];for(let c=1;c<s-1;c++){h=1;for(let f=1;f<e-1;f++){const p=c*e+f,b=a[p];if(b===0)continue;let S=c,A=f;if(b===1&&a[p-1]===0)o+=1,A-=1;else if(b>=1&&a[p+1]===0)o+=1,A+=1,b>1&&(h=b);else{b!==1&&(h=Math.abs(b));continue}const x=[f,c],C=A===f+1,T={isHole:C,points:x,id:o,parent:0};l.push(T);let E;for(const I of l)if(I.id===h){E=I;break}E?E.isHole?T.parent=C?E.parent:h:T.parent=C?h:E.parent:T.parent=C?h:0;const u=w(this,st,Gp).call(this,a,e,c,f,S,A,0);if(u===-1){a[p]=-o,a[p]!==1&&(h=Math.abs(a[p]));continue}let m=r(this,es)[2*u],v=r(this,es)[2*u+1];const _=c+m,P=f+v;S=_,A=P;let R=c,M=f;for(;;){const I=w(this,st,zp).call(this,a,e,R,M,S,A,1);m=r(this,es)[2*I],v=r(this,es)[2*I+1];const $=R+m,U=M+v;x.push(U,$);const V=R*e+M;if(a[V+1]===0?a[V]=-o:a[V]===1&&(a[V]=o),$===c&&U===f&&R===_&&M===P){a[p]!==1&&(h=Math.abs(a[p]));break}else S=R,A=M,R=$,M=U}}}return l},Cl=function(t,e,s,i){if(s-e<=4){for(let _=e;_<s-2;_+=2)i.push(t[_],t[_+1]);return}const n=t[e],a=t[e+1],o=t[s-4]-n,h=t[s-3]-a,l=Math.hypot(o,h),c=o/l,f=h/l,p=c*a-f*n,b=h/o,S=1/l,A=Math.atan(b),x=Math.cos(A),C=Math.sin(A),T=S*(Math.abs(x)+Math.abs(C)),E=S*(1-T+T**2),u=Math.max(Math.atan(Math.abs(C+x)*E),Math.atan(Math.abs(C-x)*E));let m=0,v=e;for(let _=e+2;_<s-2;_+=2){const P=Math.abs(p-c*t[_+1]+f*t[_]);P>m&&(v=_,m=P)}m>(l*u)**2?(w(this,st,Cl).call(this,t,e,v+2,i),w(this,st,Cl).call(this,t,v,s,i)):i.push(n,a)},Wp=function(t){const e=[],s=t.length;return w(this,st,Cl).call(this,t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e},Up=function(t,e,s,i,n,a){const o=new Float32Array(a**2),h=-2*i**2,l=a>>1;for(let A=0;A<a;A++){const x=(A-l)**2;for(let C=0;C<a;C++)o[A*a+C]=Math.exp((x+(C-l)**2)/h)}const c=new Float32Array(256),f=-2*n**2;for(let A=0;A<256;A++)c[A]=Math.exp(A**2/f);const p=t.length,b=new Uint8Array(p),S=new Uint32Array(256);for(let A=0;A<s;A++)for(let x=0;x<e;x++){const C=A*e+x,T=t[C];let E=0,u=0;for(let v=0;v<a;v++){const _=A+v-l;if(!(_<0||_>=s))for(let P=0;P<a;P++){const R=x+P-l;if(R<0||R>=e)continue;const M=t[_*e+R],I=o[v*a+P]*c[Math.abs(M-T)];E+=M*I,u+=I}}const m=b[C]=Math.round(E/u);S[m]++}return[b,S]},Vp=function(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e},Ld=function(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let o=0,h=s.length;o<h;o++){if(t[(o<<2)+3]===0){i=s[o]=255;continue}const c=s[o]=t[o<<2];c>i&&(i=c),c<n&&(n=c)}const a=255/(i-n);for(let o=0;o<e;o++)s[o]=(s[o]-n)*a;return s},kd=function(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(h=>h!==0);let a=n,o=n;for(e=n;e<256;e++){const h=t[e];h>s&&(e-a>i&&(i=e-a,o=e-1),s=h,a=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e},jp=function(t){const e=t,{width:s,height:i}=t,{maxDim:n}=r(this,fr);let a=s,o=i;if(s>n||i>n){let p=s,b=i,S=Math.log2(Math.max(s,i)/n);const A=Math.floor(S);S=S===A?A-1:A;for(let C=0;C<S;C++){a=p,o=b,a>n&&(a=Math.ceil(a/2)),o>n&&(o=Math.ceil(o/2));const T=new OffscreenCanvas(a,o);T.getContext("2d").drawImage(t,0,0,p,b,0,0,a,o),p=a,b=o,t!==e&&t.close(),t=T.transferToImageBitmap()}const x=Math.min(n/a,n/o);a=Math.round(a*x),o=Math.round(o*x)}const l=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});l.filter="grayscale(1)",l.drawImage(t,0,0,t.width,t.height,0,0,a,o);const c=l.getImageData(0,0,a,o).data;return[w(this,st,Ld).call(this,c),a,o]},y(ci,st),y(ci,fr,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),y(ci,es,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class iu extends Fp{constructor(){super(),super.updateProperties({fill:"CanvasText","stroke-width":0})}clone(){const t=new iu;return t.updateAll(this),t}}class nu extends fc{constructor(t){super(t),super.updateProperties({stroke:"CanvasText","stroke-width":1})}clone(){const t=new nu(this._viewParameters);return t.updateAll(this),t}}var qi,Re,Xi,Yi;const be=class be extends $l{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});y(this,qi,!1);y(this,Re,null);y(this,Xi,null);y(this,Yi,null);this._willKeepAspectRatio=!0,g(this,Xi,e.signatureData||null),g(this,Re,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,s){pt.initialize(e,s),this._defaultDrawingOptions=new iu,this._defaultDrawnSignatureOptions=new nu(s.viewParameters)}static getDefaultDrawingOptions(e){const s=this._defaultDrawingOptions.clone();return s.updateProperties(e),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return Q(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!r(this,Re)}}static computeTelemetryFinalData(e){const s=e.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,s=this.y),super.render(),this._drawId===null)if(r(this,Xi)){const{lines:n,mustSmooth:a,areContours:o,description:h,uuid:l,heightInPage:c}=r(this,Xi),{rawDims:{pageWidth:f,pageHeight:p},rotation:b}=this.parent.viewport,S=ci.processDrawnLines({lines:n,pageWidth:f,pageHeight:p,rotation:b,innerMargin:be._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(S,c,h,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(e,s)),this.div}setUuid(e){g(this,Yi,e),this.addEditToolbar()}getUuid(){return r(this,Yi)}get description(){return r(this,Re)}set description(e){g(this,Re,e),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(e)})}getSignaturePreview(){const{newCurves:e,areContours:s,thickness:i,width:n,height:a}=r(this,Xi),o=Math.max(n,a),h=ci.processDrawnLines({lines:{curves:e.map(l=>({points:l})),thickness:i,width:n,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:h.outline}}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.signatureManager&&r(this,Re)!==null&&(await e.addEditSignatureButton(this._uiManager.signatureManager,r(this,Yi),r(this,Re)),e.show()),e):null}addSignature(e,s,i,n){const{x:a,y:o}=this,{outline:h}=g(this,Xi,e);g(this,qi,h instanceof Rd),g(this,Re,i),this.div.setAttribute("data-l10n-args",JSON.stringify({description:i}));let l;r(this,qi)?l=be.getDefaultDrawingOptions():(l=be._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:l});const[c,f]=this.parentDimensions,[,p]=this.pageDimensions;let b=s/p;b=b>=1?.5:b,this.width*=b/this.height,this.width>=1&&(b*=.9/this.width,this.width=.9),this.height=b,this.setDims(c*this.width,f*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ci.process(e,s,i,n,be._INNER_MARGIN)}getFromText(e,s){const{rawDims:{pageWidth:i,pageHeight:n},rotation:a}=this.parent.viewport;return ci.extractContoursFromText(e,s,i,n,a,be._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ci.processDrawnLines({lines:e,pageWidth:s,pageHeight:i,rotation:n,innerMargin:be._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:s}){e?this._drawingOptions=be.getDefaultDrawingOptions():(this._drawingOptions=be._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:s,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:j.SIGNATURE,isSignature:!0,areContours:r(this,qi),color:[0,0,0],thickness:r(this,qi)?0:a,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(o.paths={lines:s,points:i},o.uuid=r(this,Yi),o.isCopy=!0):o.lines=s,r(this,Re)&&(o.accessibilityData={type:"Figure",alt:r(this,Re)}),o}static deserializeDraw(e,s,i,n,a,o){return o.areContours?Rd.deserialize(e,s,i,n,a,o):jh.deserialize(e,s,i,n,a,o)}static async deserialize(e,s,i){var a;const n=await super.deserialize(e,s,i);return g(n,qi,e.areContours),g(n,Re,((a=e.accessibilityData)==null?void 0:a.alt)||""),g(n,Yi,e.uuid),n}};qi=new WeakMap,Re=new WeakMap,Xi=new WeakMap,Yi=new WeakMap,O(be,"_type","signature"),O(be,"_editorType",j.SIGNATURE),O(be,"_defaultDrawingOptions",null);let Dd=be;var dt,Ht,Ki,ni,Qi,Ha,ri,pr,Es,Ie,$a,tt,co,uo,Pl,Tl,Rl,Nd,Il,qp;class Fd extends pt{constructor(e){super({...e,name:"stampEditor"});y(this,tt);y(this,dt,null);y(this,Ht,null);y(this,Ki,null);y(this,ni,null);y(this,Qi,null);y(this,Ha,"");y(this,ri,null);y(this,pr,!1);y(this,Es,null);y(this,Ie,!1);y(this,$a,!1);g(this,ni,e.bitmapUrl),g(this,Qi,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,s){pt.initialize(e,s)}static isHandlingMimeForPasting(e){return Tc.includes(e)}static paste(e,s){s.pasteEditor(j.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const s=e.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(e=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,h=await i.guess({name:"altText",request:{data:n,width:a,height:o,channels:n.length/(a*o)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const l=h.output;return await this.setGuessedAltText(l),s&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}remove(){var e;r(this,Ht)&&(g(this,dt,null),this._uiManager.imageManager.deleteId(r(this,Ht)),(e=r(this,ri))==null||e.remove(),g(this,ri,null),r(this,Es)&&(clearTimeout(r(this,Es)),g(this,Es,null))),super.remove()}rebuild(){if(!this.parent){r(this,Ht)&&w(this,tt,Pl).call(this);return}super.rebuild(),this.div!==null&&(r(this,Ht)&&r(this,ri)===null&&w(this,tt,Pl).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(r(this,Ki)||r(this,dt)||r(this,ni)||r(this,Qi)||r(this,Ht)||r(this,pr))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,s;return this._isCopy&&(e=this.x,s=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),r(this,pr)||(r(this,dt)?w(this,tt,Tl).call(this):w(this,tt,Pl).call(this)),this._isCopy&&this._moveAfterPaste(e,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,s){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(g(this,Ht,i),n&&g(this,dt,n),g(this,pr,!1),w(this,tt,Tl).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;r(this,Es)!==null&&clearTimeout(r(this,Es)),g(this,Es,setTimeout(()=>{g(this,Es,null),w(this,tt,Nd).call(this)},200))}copyCanvas(e,s,i=!1){var b;e||(e=224);const{width:n,height:a}=r(this,dt),o=new pi;let h=r(this,dt),l=n,c=a,f=null;if(s){if(n>s||a>s){const P=Math.min(s/n,s/a);l=Math.floor(n*P),c=Math.floor(a*P)}f=document.createElement("canvas");const S=f.width=Math.ceil(l*o.sx),A=f.height=Math.ceil(c*o.sy);r(this,Ie)||(h=w(this,tt,Rl).call(this,S,A));const x=f.getContext("2d");x.filter=this._uiManager.hcmFilter;let C="white",T="#cfcfd8";this._uiManager.hcmFilter!=="none"?T="black":(b=window.matchMedia)!=null&&b.call(window,"(prefers-color-scheme: dark)").matches&&(C="#8f8f9d",T="#42414d");const E=15,u=E*o.sx,m=E*o.sy,v=new OffscreenCanvas(u*2,m*2),_=v.getContext("2d");_.fillStyle=C,_.fillRect(0,0,u*2,m*2),_.fillStyle=T,_.fillRect(0,0,u,m),_.fillRect(u,m,u,m),x.fillStyle=x.createPattern(v,"repeat"),x.fillRect(0,0,S,A),x.drawImage(h,0,0,h.width,h.height,0,0,S,A)}let p=null;if(i){let S,A;if(o.symmetric&&h.width<e&&h.height<e)S=h.width,A=h.height;else if(h=r(this,dt),n>e||a>e){const T=Math.min(e/n,e/a);S=Math.floor(n*T),A=Math.floor(a*T),r(this,Ie)||(h=w(this,tt,Rl).call(this,S,A))}const C=new OffscreenCanvas(S,A).getContext("2d",{willReadFrequently:!0});C.drawImage(h,0,0,h.width,h.height,0,0,S,A),p={width:S,height:A,data:C.getImageData(0,0,S,A).data}}return{canvas:f,width:l,height:c,imageData:p}}static async deserialize(e,s,i){var x;let n=null,a=!1;if(e instanceof hp){const{data:{rect:C,rotation:T,id:E,structParent:u,popupRef:m},container:v,parent:{page:{pageNumber:_}},canvas:P}=e;let R,M;P?(delete e.canvas,{id:R,bitmap:M}=i.imageManager.getFromCanvas(v.id,P),P.remove()):(a=!0,e._hasNoCanvas=!0);const I=((x=await s._structTree.getAriaAttributes(`${qd}${E}`))==null?void 0:x.get("aria-label"))||"";n=e={annotationType:j.STAMP,bitmapId:R,bitmap:M,pageIndex:_-1,rect:C.slice(0),rotation:T,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:I},isSvg:!1,structParent:u,popupRef:m}}const o=await super.deserialize(e,s,i),{rect:h,bitmap:l,bitmapUrl:c,bitmapId:f,isSvg:p,accessibilityData:b}=e;a?(i.addMissingCanvas(e.id,o),g(o,pr,!0)):f&&i.imageManager.isValidId(f)?(g(o,Ht,f),l&&g(o,dt,l)):g(o,ni,c),g(o,Ie,p);const[S,A]=o.pageDimensions;return o.width=(h[2]-h[0])/S,o.height=(h[3]-h[1])/A,o.annotationElementId=e.id||null,b&&(o.altTextData=b),o._initialData=n,g(o,$a,!!n),o}serialize(e=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:j.STAMP,bitmapId:r(this,Ht),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:r(this,Ie),structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=w(this,tt,Il).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:a}=this.serializeAltText(!1);if(!n&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const h=w(this,tt,qp).call(this,i);if(h.isSame)return null;h.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=r(this,Ie)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(r(this,Ht)))s.stamps.set(r(this,Ht),{area:o,serialized:i}),i.bitmap=w(this,tt,Il).call(this,!1);else if(r(this,Ie)){const h=s.stamps.get(r(this,Ht));o>h.area&&(h.area=o,h.serialized.bitmap.close(),h.serialized.bitmap=w(this,tt,Il).call(this,!1))}return i}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}dt=new WeakMap,Ht=new WeakMap,Ki=new WeakMap,ni=new WeakMap,Qi=new WeakMap,Ha=new WeakMap,ri=new WeakMap,pr=new WeakMap,Es=new WeakMap,Ie=new WeakMap,$a=new WeakMap,tt=new WeakSet,co=function(e,s=!1){if(!e){this.remove();return}g(this,dt,e.bitmap),s||(g(this,Ht,e.id),g(this,Ie,e.isSvg)),e.file&&g(this,Ha,e.file.name),w(this,tt,Tl).call(this)},uo=function(){if(g(this,Ki,null),this._uiManager.enableWaiting(!1),!!r(this,ri)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,dt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,dt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Pl=function(){if(r(this,Ht)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(r(this,Ht)).then(i=>w(this,tt,co).call(this,i,!0)).finally(()=>w(this,tt,uo).call(this));return}if(r(this,ni)){const i=r(this,ni);g(this,ni,null),this._uiManager.enableWaiting(!0),g(this,Ki,this._uiManager.imageManager.getFromUrl(i).then(n=>w(this,tt,co).call(this,n)).finally(()=>w(this,tt,uo).call(this)));return}if(r(this,Qi)){const i=r(this,Qi);g(this,Qi,null),this._uiManager.enableWaiting(!0),g(this,Ki,this._uiManager.imageManager.getFromFile(i).then(n=>w(this,tt,co).call(this,n)).finally(()=>w(this,tt,uo).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=Tc.join(",");const s=this._uiManager._signal;g(this,Ki,new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,tt,co).call(this,n)}i()},{signal:s}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>w(this,tt,uo).call(this))),e.click()},Tl=function(){var f;const{div:e}=this;let{width:s,height:i}=r(this,dt);const[n,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*a;else if(s>o*n||i>o*a){const p=Math.min(o*n/s,o*a/i);s*=p,i*=p}const[h,l]=this.parentDimensions;this.setDims(s*h/n,i*l/a),this._uiManager.enableWaiting(!1);const c=g(this,ri,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=s/n,this.height=i/a,(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),w(this,tt,Nd).call(this),r(this,$a)||(this.parent.addUndoableEditor(this),g(this,$a,!0)),this._reportTelemetry({action:"inserted_image"}),r(this,Ha)&&this.div.setAttribute("aria-description",r(this,Ha))},Rl=function(e,s){const{width:i,height:n}=r(this,dt);let a=i,o=n,h=r(this,dt);for(;a>2*e||o>2*s;){const l=a,c=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const f=new OffscreenCanvas(a,o);f.getContext("2d").drawImage(h,0,0,l,c,0,0,a,o),h=f.transferToImageBitmap()}return h},Nd=function(){const[e,s]=this.parentDimensions,{width:i,height:n}=this,a=new pi,o=Math.ceil(i*e*a.sx),h=Math.ceil(n*s*a.sy),l=r(this,ri);if(!l||l.width===o&&l.height===h)return;l.width=o,l.height=h;const c=r(this,Ie)?r(this,dt):w(this,tt,Rl).call(this,o,h),f=l.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(c,0,0,c.width,c.height,0,0,o,h)},Il=function(e){if(e){if(r(this,Ie)){const n=this._uiManager.imageManager.getSvgUrl(r(this,Ht));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=r(this,dt),s.getContext("2d").drawImage(r(this,dt),0,0),s.toDataURL()}if(r(this,Ie)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*sn.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*sn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,a);return o.getContext("2d").drawImage(r(this,dt),0,0,r(this,dt).width,r(this,dt).height,0,0,n,a),o.transferToImageBitmap()}return structuredClone(r(this,dt))},qp=function(e){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=e.pageIndex===s,a=(((o=e.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&a,isSameAltText:a}},O(Fd,"_type","stamp"),O(Fd,"_editorType",j.STAMP);var gr,Ga,Cs,Zi,ai,ze,Ji,za,mr,ss,oi,ee,hi,H,tn,ft,Xp,cs,Bd,Hd,Ml;const Ve=class Ve{constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:h,viewport:l,l10n:c}){y(this,ft);y(this,gr);y(this,Ga,!1);y(this,Cs,null);y(this,Zi,null);y(this,ai,null);y(this,ze,new Map);y(this,Ji,!1);y(this,za,!1);y(this,mr,!1);y(this,ss,null);y(this,oi,null);y(this,ee,null);y(this,hi,null);y(this,H);const f=[...r(Ve,tn).values()];if(!Ve._initialized){Ve._initialized=!0;for(const p of f)p.initialize(c,t)}t.registerEditorTypes(f),g(this,H,t),this.pageIndex=e,this.div=s,g(this,gr,n),g(this,Cs,a),this.viewport=l,g(this,ee,h),this.drawLayer=o,this._structTree=i,r(this,H).addLayer(this)}get isEmpty(){return r(this,ze).size===0}get isInvisible(){return this.isEmpty&&r(this,H).getMode()===j.NONE}updateToolbar(t){r(this,H).updateToolbar(t)}updateMode(t=r(this,H).getMode()){switch(w(this,ft,Ml).call(this),t){case j.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of r(Ve,tn).values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=r(this,ee))==null?void 0:e.div)}setEditingState(t){r(this,H).setEditingState(t)}addCommands(t){r(this,H).addCommands(t)}cleanUndoStack(t){r(this,H).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=r(this,Cs))==null||e.div.classList.toggle("disabled",!t)}async enable(){g(this,mr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const s of r(this,ze).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(r(this,H).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!r(this,Cs)){g(this,mr,!1);return}const e=r(this,Cs).getEditableAnnotations();for(const s of e){if(s.hide(),r(this,H).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}g(this,mr,!1)}disable(){var i;g(this,za,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const n of r(this,ze).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else e.set(n.annotationElementId,n);(i=this.getEditableAnnotation(n.annotationElementId))==null||i.show(),n.remove()}if(r(this,Cs)){const n=r(this,Cs).getEditableAnnotations();for(const a of n){const{id:o}=a.data;if(r(this,H).isDeletedAnnotationElement(o))continue;let h=e.get(o);if(h){h.resetAnnotationElement(a),h.show(!1),a.show();continue}h=t.get(o),h&&(r(this,H).addChangedExistingAnnotation(h),h.renderAnnotationElement(a)&&h.show(!1)),a.show()}}w(this,ft,Ml).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of r(Ve,tn).values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),g(this,za,!1)}getEditableAnnotation(t){var e;return((e=r(this,Cs))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){r(this,H).getActive()!==t&&r(this,H).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=r(this,ee))!=null&&t.div&&!r(this,hi)){g(this,hi,new AbortController);const e=r(this,H).combinedSignal(r(this,hi));r(this,ee).div.addEventListener("pointerdown",w(this,ft,Xp).bind(this),{signal:e}),r(this,ee).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=r(this,ee))!=null&&t.div&&r(this,hi)&&(r(this,hi).abort(),g(this,hi,null),r(this,ee).div.classList.remove("highlighting"))}enableClick(){if(r(this,Zi))return;g(this,Zi,new AbortController);const t=r(this,H).combinedSignal(r(this,Zi));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=r(this,Zi))==null||t.abort(),g(this,Zi,null)}attach(t){r(this,ze).set(t.id,t);const{annotationElementId:e}=t;e&&r(this,H).isDeletedAnnotationElement(e)&&r(this,H).removeDeletedAnnotationElement(t)}detach(t){var e;r(this,ze).delete(t.id),(e=r(this,gr))==null||e.removePointerInTextLayer(t.contentDiv),!r(this,za)&&t.annotationElementId&&r(this,H).addDeletedAnnotationElement(t)}remove(t){this.detach(t),r(this,H).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(r(this,H).addDeletedAnnotationElement(t.annotationElementId),pt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),r(this,H).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!r(this,mr)),r(this,H).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var s;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!r(this,ai)&&(t._focusEventsAllowed=!1,g(this,ai,setTimeout(()=>{g(this,ai,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:r(this,H)._signal}),e.focus())},0))),t._structTreeParentId=(s=r(this,gr))==null?void 0:s.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return r(this,H).getId()}combinedSignal(t){return r(this,H).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=r(this,ft,cs))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){r(this,H).updateToolbar(t),await r(this,H).updateMode(t);const{offsetX:s,offsetY:i}=w(this,ft,Hd).call(this),n=this.getNextId(),a=w(this,ft,Bd).call(this,{parent:this,id:n,x:s,y:i,uiManager:r(this,H),isCentered:!0,...e});a&&this.add(a)}async deserialize(t){var e;return await((e=r(Ve,tn).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,r(this,H)))||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=w(this,ft,Bd).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:r(this,H),isCentered:e,...s});return n&&this.add(n),n}addNewEditor(t={}){this.createAndAddNewEditor(w(this,ft,Hd).call(this),!0,t)}setSelected(t){r(this,H).setSelected(t)}toggleSelected(t){r(this,H).toggleSelected(t)}unselect(t){r(this,H).unselect(t)}pointerup(t){var i;const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!r(this,Ji)||(g(this,Ji,!1),(i=r(this,ft,cs))!=null&&i.isDrawer&&r(this,ft,cs).supportMultipleDrawings))return;if(!r(this,Ga)){g(this,Ga,!0);return}const s=r(this,H).getMode();if(s===j.STAMP||s===j.SIGNATURE){r(this,H).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var i;if(r(this,H).getMode()===j.HIGHLIGHT&&this.enableTextSelection(),r(this,Ji)){g(this,Ji,!1);return}const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(g(this,Ji,!0),(i=r(this,ft,cs))!=null&&i.isDrawer){this.startDrawingSession(t);return}const s=r(this,H).getActive();g(this,Ga,!s||s.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),r(this,ss)){r(this,ft,cs).startDrawing(this,r(this,H),!1,t);return}r(this,H).setCurrentDrawingSession(this),g(this,ss,new AbortController);const e=r(this,H).combinedSignal(r(this,ss));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(g(this,oi,null),this.commitOrRemove())},{signal:e}),r(this,ft,cs).startDrawing(this,r(this,H),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&g(this,oi,e);return}r(this,oi)&&setTimeout(()=>{var e;(e=r(this,oi))==null||e.focus(),g(this,oi,null)},0)}endDrawingSession(t=!1){return r(this,ss)?(r(this,H).setCurrentDrawingSession(null),r(this,ss).abort(),g(this,ss,null),g(this,oi,null),r(this,ft,cs).endDrawing(t)):null}findNewParent(t,e,s){const i=r(this,H).findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return r(this,ss)?(this.endDrawingSession(),!0):!1}onScaleChanging(){r(this,ss)&&r(this,ft,cs).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=r(this,H).getActive())==null?void 0:t.parent)===this&&(r(this,H).commitOrRemove(),r(this,H).setActiveEditor(null)),r(this,ai)&&(clearTimeout(r(this,ai)),g(this,ai,null));for(const s of r(this,ze).values())(e=r(this,gr))==null||e.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,r(this,ze).clear(),r(this,H).removeLayer(this)}render({viewport:t}){this.viewport=t,yr(this.div,t);for(const e of r(this,H).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){r(this,H).commitOrRemove(),w(this,ft,Ml).call(this);const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,yr(this.div,{rotation:s}),e!==s)for(const i of r(this,ze).values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return r(this,H).viewParameters.realScale}};gr=new WeakMap,Ga=new WeakMap,Cs=new WeakMap,Zi=new WeakMap,ai=new WeakMap,ze=new WeakMap,Ji=new WeakMap,za=new WeakMap,mr=new WeakMap,ss=new WeakMap,oi=new WeakMap,ee=new WeakMap,hi=new WeakMap,H=new WeakMap,tn=new WeakMap,ft=new WeakSet,Xp=function(t){r(this,H).unselectAll();const{target:e}=t;if(e===r(this,ee).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&r(this,ee).div.contains(e)){const{isMac:s}=Xt.platform;if(t.button!==0||t.ctrlKey&&s)return;r(this,H).showAllEditors("highlight",!0,!0),r(this,ee).div.classList.add("free"),this.toggleDrawing(),Hl.startHighlighting(this,r(this,H).direction==="ltr",{target:r(this,ee).div,x:t.x,y:t.y}),r(this,ee).div.addEventListener("pointerup",()=>{r(this,ee).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:r(this,H)._signal}),t.preventDefault()}},cs=function(){return r(Ve,tn).get(r(this,H).getMode())},Bd=function(t){const e=r(this,ft,cs);return e?new e.prototype.constructor(t):null},Hd=function(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,t),a=Math.max(0,e),o=Math.min(window.innerWidth,t+s),h=Math.min(window.innerHeight,e+i),l=(n+o)/2-t,c=(a+h)/2-e,[f,p]=this.viewport.rotation%180===0?[l,c]:[c,l];return{offsetX:f,offsetY:p}},Ml=function(){for(const t of r(this,ze).values())t.isEmpty()&&t.remove()},O(Ve,"_initialized",!1),y(Ve,tn,new Map([gd,Td,Fd,Hl,Dd].map(t=>[t._editorType,t])));let Od=Ve;var is,oe,br,Hh,oc,Yp,Ps,Gd,Kp,zd;const Rt=class Rt{constructor({pageIndex:t}){y(this,Ps);y(this,is,null);y(this,oe,new Map);y(this,br,new Map);this.pageIndex=t}setParent(t){if(!r(this,is)){g(this,is,t);return}if(r(this,is)!==t){if(r(this,oe).size>0)for(const e of r(this,oe).values())e.remove(),t.append(e);g(this,is,t)}}static get _svgFactory(){return Q(this,"_svgFactory",new Nl)}draw(t,e=!1,s=!1){const i=se(Rt,Hh)._++,n=w(this,Ps,Gd).call(this),a=Rt._svgFactory.createElement("defs");n.append(a);const o=Rt._svgFactory.createElement("path");a.append(o);const h=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",h),o.setAttribute("vector-effect","non-scaling-stroke"),e&&r(this,br).set(i,o);const l=s?w(this,Ps,Kp).call(this,a,h):null,c=Rt._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${h}`),this.updateProperties(n,t),r(this,oe).set(i,n),{id:i,clipPathId:`url(#${l})`}}drawOutline(t,e){const s=se(Rt,Hh)._++,i=w(this,Ps,Gd).call(this),n=Rt._svgFactory.createElement("defs");i.append(n);const a=Rt._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let h;if(e){const f=Rt._svgFactory.createElement("mask");n.append(f),h=`mask_p${this.pageIndex}_${s}`,f.setAttribute("id",h),f.setAttribute("maskUnits","objectBoundingBox");const p=Rt._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const b=Rt._svgFactory.createElement("use");f.append(b),b.setAttribute("href",`#${o}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const l=Rt._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${o}`),h&&l.setAttribute("mask",`url(#${h})`);const c=l.cloneNode();return i.append(c),l.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,t),r(this,oe).set(s,i),s}finalizeDraw(t,e){r(this,br).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var h;if(!e)return;const{root:s,bbox:i,rootClass:n,path:a}=e,o=typeof t=="number"?r(this,oe).get(t):t;if(o){if(s&&w(this,Ps,zd).call(this,o,s),i&&w(h=Rt,oc,Yp).call(h,o,i),n){const{classList:l}=o;for(const[c,f]of Object.entries(n))l.toggle(c,f)}if(a){const c=o.firstChild.firstChild;w(this,Ps,zd).call(this,c,a)}}}updateParent(t,e){if(e===this)return;const s=r(this,oe).get(t);s&&(r(e,is).append(s),r(this,oe).delete(t),r(e,oe).set(t,s))}remove(t){r(this,br).delete(t),r(this,is)!==null&&(r(this,oe).get(t).remove(),r(this,oe).delete(t))}destroy(){g(this,is,null);for(const t of r(this,oe).values())t.remove();r(this,oe).clear(),r(this,br).clear()}};is=new WeakMap,oe=new WeakMap,br=new WeakMap,Hh=new WeakMap,oc=new WeakSet,Yp=function(t,[e,s,i,n]){const{style:a}=t;a.top=`${100*s}%`,a.left=`${100*e}%`,a.width=`${100*i}%`,a.height=`${100*n}%`},Ps=new WeakSet,Gd=function(){const t=Rt._svgFactory.create(1,1,!0);return r(this,is).append(t),t.setAttribute("aria-hidden",!0),t},Kp=function(t,e){const s=Rt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=Rt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i},zd=function(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)},y(Rt,oc),y(Rt,Hh,0);let $d=Rt;globalThis.pdfjsTestingUtils={HighlightOutliner:bd};W.AbortException;W.AnnotationEditorLayer;W.AnnotationEditorParamsType;W.AnnotationEditorType;W.AnnotationEditorUIManager;W.AnnotationLayer;W.AnnotationMode;W.AnnotationType;W.ColorPicker;W.DOMSVGFactory;W.DrawLayer;W.FeatureTest;var Zm=W.GlobalWorkerOptions;W.ImageKind;W.InvalidPDFException;W.MathClamp;W.OPS;W.OutputScale;W.PDFDataRangeTransport;W.PDFDateString;W.PDFWorker;W.PasswordResponses;W.PermissionFlag;W.PixelsPerInch;W.RenderingCancelledException;W.ResponseException;W.SignatureExtractor;W.SupportedImageMimeTypes;W.TextLayer;W.TouchManager;W.Util;W.VerbosityLevel;W.XfaLayer;W.build;W.createValidAbsoluteUrl;W.fetchData;var Jm=W.getDocument;W.getFilenameFromUrl;W.getPdfFilenameFromUrl;W.getUuid;W.getXfaPageViewport;W.isDataScheme;W.isPdfFile;W.isValidExplicitDest;W.noContextMenu;W.normalizeUnicode;W.setLayerDimensions;W.shadow;W.stopEvent;W.version;var fo={exports:{}},tb=fo.exports,Bu;function eb(){return Bu||(Bu=1,function(d,t){(function(e,s){s(t)})(tb,function(e){class s{constructor(u,m){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=m,this.nowDrawingDensity=this.createdDensity,this.render=u}setDensity(u){this.createdDensity=u,this.nowDrawingDensity=u}setDrawingDensity(u){this.nowDrawingDensity=u}setPosition(u){this.state.position=u}setAngle(u){this.state.angle=u}setArea(u){this.state.area=u}setHardDrawingAngle(u){this.state.hardDrawingAngle=u}setHardAngle(u){this.state.hardAngle=u,this.state.hardDrawingAngle=u}setOrientation(u){this.orientation=u}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class i extends s{constructor(u,m,v){super(u,v),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=m}draw(u){const m=this.render.getContext(),v=this.render.convertToGlobal(this.state.position),_=this.render.getRect().pageWidth,P=this.render.getRect().height;m.save(),m.translate(v.x,v.y),m.beginPath();for(let R of this.state.area)R!==null&&(R=this.render.convertToGlobal(R),m.lineTo(R.x-v.x,R.y-v.y));m.rotate(this.state.angle),m.clip(),this.isLoad?m.drawImage(this.image,0,0,_,P):this.drawLoader(m,{x:0,y:0},_,P),m.restore()}simpleDraw(u){const m=this.render.getRect(),v=this.render.getContext(),_=m.pageWidth,P=m.height,R=u===1?m.left+m.pageWidth:m.left,M=m.top;this.isLoad?v.drawImage(this.image,R,M,_,P):this.drawLoader(v,{x:R,y:M},_,P)}drawLoader(u,m,v,_){u.beginPath(),u.strokeStyle="rgb(200, 200, 200)",u.fillStyle="rgb(255, 255, 255)",u.lineWidth=1,u.rect(m.x+1,m.y+1,v-1,_-1),u.stroke(),u.fill();const P={x:m.x+v/2,y:m.y+_/2};u.beginPath(),u.lineWidth=10,u.arc(P.x,P.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),u.stroke(),u.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class n{constructor(u,m){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=m,this.app=u,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let m=0;m<this.pages.length;m++)this.portraitSpread.push([m]);let u=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([u]),u++);for(let m=u;m<this.pages.length;m+=2)m<this.pages.length-1?this.landscapeSpread.push([m,m+1]):(this.landscapeSpread.push([m]),this.pages[m].setDensity("hard"))}getSpread(){return this.render.getOrientation()==="landscape"?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(u){const m=this.getSpread();for(let v=0;v<m.length;v++)if(u===m[v][0]||u===m[v][1])return v;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(u){if(u>=0&&u<this.pages.length)return this.pages[u];throw new Error("Invalid page number")}nextBy(u){const m=this.pages.indexOf(u);return m<this.pages.length-1?this.pages[m+1]:null}prevBy(u){const m=this.pages.indexOf(u);return m>0?this.pages[m-1]:null}getFlippingPage(u){const m=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return u===0?this.pages[m].newTemporaryCopy():this.pages[m-1];{const v=u===0?this.getSpread()[m+1]:this.getSpread()[m-1];return v.length===1||u===0?this.pages[v[0]]:this.pages[v[1]]}}getBottomPage(u){const m=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return u===0?this.pages[m+1]:this.pages[m-1];{const v=u===0?this.getSpread()[m+1]:this.getSpread()[m-1];return v.length===1?this.pages[v[0]]:u===0?this.pages[v[1]]:this.pages[v[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(u=null){if(u===null&&(u=this.currentPageIndex),u<0||u>=this.pages.length)return;const m=this.getSpreadIndexByPage(u);m!==null&&(this.currentSpreadIndex=m,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(u){if(!(u>=0&&u<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=u}showSpread(){const u=this.getSpread()[this.currentSpreadIndex];u.length===2?(this.render.setLeftPage(this.pages[u[0]]),this.render.setRightPage(this.pages[u[1]])):this.render.getOrientation()==="landscape"&&u[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[u[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[u[0]])),this.currentPageIndex=u[0],this.app.updatePageIndex(this.currentPageIndex)}}class a extends n{constructor(u,m,v){super(u,m),this.imagesHref=v}load(){for(const u of this.imagesHref){const m=new i(this.render,u,"soft");m.load(),this.pages.push(m)}this.createSpread()}}class o{static GetDistanceBetweenTwoPoint(u,m){return u===null||m===null?1/0:Math.sqrt(Math.pow(m.x-u.x,2)+Math.pow(m.y-u.y,2))}static GetSegmentLength(u){return o.GetDistanceBetweenTwoPoint(u[0],u[1])}static GetAngleBetweenTwoLine(u,m){const v=u[0].y-u[1].y,_=m[0].y-m[1].y,P=u[1].x-u[0].x,R=m[1].x-m[0].x;return Math.acos((v*_+P*R)/(Math.sqrt(v*v+P*P)*Math.sqrt(_*_+R*R)))}static PointInRect(u,m){return m===null?null:m.x>=u.left&&m.x<=u.width+u.left&&m.y>=u.top&&m.y<=u.top+u.height?m:null}static GetRotatedPoint(u,m,v){return{x:u.x*Math.cos(v)+u.y*Math.sin(v)+m.x,y:u.y*Math.cos(v)-u.x*Math.sin(v)+m.y}}static LimitPointToCircle(u,m,v){if(o.GetDistanceBetweenTwoPoint(u,v)<=m)return v;const _=u.x,P=u.y,R=v.x,M=v.y;let I=Math.sqrt(Math.pow(m,2)*Math.pow(_-R,2)/(Math.pow(_-R,2)+Math.pow(P-M,2)))+_;v.x<0&&(I*=-1);let $=(I-_)*(P-M)/(_-R)+P;return _-R+P===0&&($=m),{x:I,y:$}}static GetIntersectBetweenTwoSegment(u,m,v){return o.PointInRect(u,o.GetIntersectBeetwenTwoLine(m,v))}static GetIntersectBeetwenTwoLine(u,m){const v=u[0].y-u[1].y,_=m[0].y-m[1].y,P=u[1].x-u[0].x,R=m[1].x-m[0].x,M=u[0].x*u[1].y-u[1].x*u[0].y,I=m[0].x*m[1].y-m[1].x*m[0].y,$=v*I-_*M,U=P*I-R*M,V=-(M*R-I*P)/(v*R-_*P),mt=-(v*I-_*M)/(v*R-_*P);if(isFinite(V)&&isFinite(mt))return{x:V,y:mt};if(Math.abs($-U)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(u,m){const v=Math.abs(u.x-m.x),_=Math.abs(u.y-m.y),P=Math.max(v,_),R=[u];function M(I,$,U,V,mt){return $>I?I+mt*(U/V):$<I?I-mt*(U/V):I}for(let I=1;I<=P;I+=1)R.push({x:M(u.x,m.x,v,P,I),y:M(u.y,m.y,_,P,I)});return R}}class h extends s{constructor(u,m,v){super(u,v),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=m,this.element.classList.add("stf__item"),this.element.classList.add("--"+v)}newTemporaryCopy(){return this.nowDrawingDensity==="hard"?this:(this.temporaryCopy===null&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new h(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){this.temporaryCopy!==null&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(u){const m=u||this.nowDrawingDensity,v=this.render.convertToGlobal(this.state.position),_=this.render.getRect().pageWidth,P=this.render.getRect().height;this.element.classList.remove("--simple");const R=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${_}px;
            height: ${P}px;
        `;m==="hard"?this.drawHard(R):this.drawSoft(v,R)}drawHard(u=""){const m=this.render.getRect().left+this.render.getRect().width/2,v=this.state.hardDrawingAngle,_=u+`
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                clip-path: none;
                -webkit-clip-path: none;
            `+(this.orientation===0?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${v}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${m}px, 0, 0) rotateY(${v}deg);`);this.element.style.cssText=_}drawSoft(u,m=""){let v="polygon( ";for(const P of this.state.area)if(P!==null){let R=this.render.getDirection()===1?{x:-P.x+this.state.position.x,y:P.y-this.state.position.y}:{x:P.x-this.state.position.x,y:P.y-this.state.position.y};R=o.GetRotatedPoint(R,{x:0,y:0},this.state.angle),v+=R.x+"px "+R.y+"px, "}v=v.slice(0,-2),v+=")";const _=m+`transform-origin: 0 0; clip-path: ${v}; -webkit-clip-path: ${v};`+(this.render.isSafari()&&this.state.angle===0?`transform: translate(${u.x}px, ${u.y}px);`:`transform: translate3d(${u.x}px, ${u.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=_}simpleDraw(u){const m=this.render.getRect(),v=m.pageWidth,_=m.height,P=u===1?m.left+m.pageWidth:m.left,R=m.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${_}px; 
            left: ${P}px; 
            top: ${R}px; 
            width: ${v}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(u){super.setOrientation(u),this.element.classList.remove("--left","--right"),this.element.classList.add(u===1?"--right":"--left")}setDrawingDensity(u){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+u),super.setDrawingDensity(u)}}class l extends n{constructor(u,m,v,_){super(u,m),this.element=v,this.pagesElement=_}load(){for(const u of this.pagesElement){const m=new h(this.render,u,u.dataset.density==="hard"?"hard":"soft");m.load(),this.pages.push(m)}this.createSpread()}}class c{constructor(u,m,v,_){this.direction=u,this.corner=m,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(v,10),this.pageHeight=parseInt(_,10)}calc(u){try{return this.position=this.calcAngleAndPosition(u),this.calculateIntersectPoint(this.position),!0}catch{return!1}}getFlippingClipArea(){const u=[];let m=!1;return u.push(this.rect.topLeft),u.push(this.topIntersectPoint),this.sideIntersectPoint===null?m=!0:(u.push(this.sideIntersectPoint),this.bottomIntersectPoint===null&&(m=!1)),u.push(this.bottomIntersectPoint),(m||this.corner==="bottom")&&u.push(this.rect.bottomLeft),u}getBottomClipArea(){const u=[];return u.push(this.topIntersectPoint),this.corner==="top"?u.push({x:this.pageWidth,y:0}):(this.topIntersectPoint!==null&&u.push({x:this.pageWidth,y:0}),u.push({x:this.pageWidth,y:this.pageHeight})),this.sideIntersectPoint!==null?o.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&u.push(this.sideIntersectPoint):this.corner==="top"&&u.push({x:this.pageWidth,y:this.pageHeight}),u.push(this.bottomIntersectPoint),u.push(this.topIntersectPoint),u}getAngle(){return this.direction===0?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===0?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return this.direction===1?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return this.corner==="top"?this.topIntersectPoint:this.sideIntersectPoint!==null?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const u=o.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===0?u:Math.PI-u}calcAngleAndPosition(u){let m=u;if(this.updateAngleAndGeometry(m),m=this.corner==="top"?this.checkPositionAtCenterLine(m,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(m,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(m.x-this.pageWidth)<1&&Math.abs(m.y)<1)throw new Error("Point is too small");return m}updateAngleAndGeometry(u){this.angle=this.calculateAngle(u),this.rect=this.getPageRect(u)}calculateAngle(u){const m=this.pageWidth-u.x+1,v=this.corner==="bottom"?this.pageHeight-u.y:u.y;let _=2*Math.acos(m/Math.sqrt(v*v+m*m));v<0&&(_=-_);const P=Math.PI-_;if(!isFinite(_)||P>=0&&P<.003)throw new Error("The G point is too small");return this.corner==="bottom"&&(_=-_),_}getPageRect(u){return this.corner==="top"?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],u):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],u)}getRectFromBasePoint(u,m){return{topLeft:this.getRotatedPoint(u[0],m),topRight:this.getRotatedPoint(u[1],m),bottomLeft:this.getRotatedPoint(u[2],m),bottomRight:this.getRotatedPoint(u[3],m)}}getRotatedPoint(u,m){return{x:u.x*Math.cos(this.angle)+u.y*Math.sin(this.angle)+m.x,y:u.y*Math.cos(this.angle)-u.x*Math.sin(this.angle)+m.y}}calculateIntersectPoint(u){const m={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner==="top"?(this.topIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[u,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[u,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[u,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=o.GetIntersectBetweenTwoSegment(m,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(u,m,v){let _=u;const P=o.LimitPointToCircle(m,this.pageWidth,_);_!==P&&(_=P,this.updateAngleAndGeometry(_));const R=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let M=this.rect.bottomRight,I=this.rect.topLeft;if(this.corner==="bottom"&&(M=this.rect.topRight,I=this.rect.bottomLeft),M.x<=0){const $=o.LimitPointToCircle(v,R,I);$!==_&&(_=$,this.updateAngleAndGeometry(_))}return _}getSegmentToShadowLine(){const u=this.getShadowStartPoint();return[u,u!==this.sideIntersectPoint&&this.sideIntersectPoint!==null?this.sideIntersectPoint:this.bottomIntersectPoint]}}class f{constructor(u,m){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=u,this.app=m}fold(u){this.setState("user_fold"),this.calc===null&&this.start(u),this.do(this.render.convertToPage(u))}flip(u){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(u)||(this.calc!==null&&this.render.finishAnimation(),!this.start(u)))return;const m=this.getBoundsRect();this.setState("flipping");const v=m.height/10,_=this.calc.getCorner()==="bottom"?m.height-v:v,P=this.calc.getCorner()==="bottom"?m.height:0;this.calc.calc({x:m.pageWidth-v,y:_}),this.animateFlippingTo({x:m.pageWidth-v,y:_},{x:-m.pageWidth,y:P},!0)}start(u){this.reset();const m=this.render.convertToBook(u),v=this.getBoundsRect(),_=this.getDirectionByPoint(m),P=m.y>=v.height/2?"bottom":"top";if(!this.checkDirection(_))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(_),this.bottomPage=this.app.getPageCollection().getBottomPage(_),this.render.getOrientation()==="landscape")if(_===1){const R=this.app.getPageCollection().nextBy(this.flippingPage);R!==null&&this.flippingPage.getDensity()!==R.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),R.setDrawingDensity("hard"))}else{const R=this.app.getPageCollection().prevBy(this.flippingPage);R!==null&&this.flippingPage.getDensity()!==R.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),R.setDrawingDensity("hard"))}return this.render.setDirection(_),this.calc=new c(_,P,v.pageWidth.toString(10),v.height.toString(10)),!0}catch{return!1}}do(u){if(this.calc!==null&&this.calc.calc(u)){const m=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.calc.getDirection()===0?this.flippingPage.setHardAngle(90*(200-2*m)/100):this.flippingPage.setHardAngle(-90*(200-2*m)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),m,this.calc.getDirection())}}flipToPage(u,m){const v=this.app.getPageCollection().getCurrentSpreadIndex(),_=this.app.getPageCollection().getSpreadIndexByPage(u);try{_>v&&(this.app.getPageCollection().setCurrentSpreadIndex(_-1),this.flipNext(m)),_<v&&(this.app.getPageCollection().setCurrentSpreadIndex(_+1),this.flipPrev(m))}catch{}}flipNext(u){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:u==="top"?1:this.render.getRect().height-2})}flipPrev(u){this.flip({x:10,y:u==="top"?1:this.render.getRect().height-2})}stopMove(){if(this.calc===null)return;const u=this.calc.getPosition(),m=this.getBoundsRect(),v=this.calc.getCorner()==="bottom"?m.height:0;u.x<=0?this.animateFlippingTo(u,{x:-m.pageWidth,y:v},!0):this.animateFlippingTo(u,{x:m.pageWidth,y:v},!1)}showCorner(u){if(!this.checkState("read","fold_corner"))return;const m=this.getBoundsRect(),v=m.pageWidth;if(this.isPointOnCorners(u))if(this.calc===null){if(!this.start(u))return;this.setState("fold_corner"),this.calc.calc({x:v-1,y:1});const _=50,P=this.calc.getCorner()==="bottom"?m.height-1:1,R=this.calc.getCorner()==="bottom"?m.height-_:_;this.animateFlippingTo({x:v-1,y:P},{x:v-_,y:R},!1,!1)}else this.do(this.render.convertToPage(u));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(u,m,v,_=!0){const P=o.GetCordsFromTwoPoint(u,m),R=[];for(const I of P)R.push(()=>this.do(I));const M=this.getAnimationDuration(P.length);this.render.startAnimation(R,M,()=>{this.calc&&(v&&(this.calc.getDirection()===1?this.app.turnToPrevPage():this.app.turnToNextPage()),_&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(u){this.state!==u&&(this.app.updateState(u),this.state=u)}getDirectionByPoint(u){const m=this.getBoundsRect();if(this.render.getOrientation()==="portrait"){if(u.x-m.pageWidth<=m.width/5)return 1}else if(u.x<m.width/2)return 1;return 0}getAnimationDuration(u){const m=this.app.getSettings().flippingTime;return u>=1e3?m:u/1e3*m}checkDirection(u){return u===0?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...u){for(const m of u)if(this.state===m)return!0;return!1}isPointOnCorners(u){const m=this.getBoundsRect(),v=m.pageWidth,_=Math.sqrt(Math.pow(v,2)+Math.pow(m.height,2))/5,P=this.render.convertToBook(u);return P.x>0&&P.y>0&&P.x<m.width&&P.y<m.height&&(P.x<_||P.x>m.width-_)&&(P.y<_||P.y>m.height-_)}}class p{constructor(u,m){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=m,this.app=u;const v=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=v.exec(window.navigator.userAgent)!==null}render(u){if(this.animation!==null){const m=Math.round((u-this.animation.startedAt)/this.animation.durationFrame);m<this.animation.frames.length?this.animation.frames[m]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=u,this.drawFrame()}start(){this.update();const u=m=>{this.render(m),requestAnimationFrame(u)};requestAnimationFrame(u)}startAnimation(u,m,v){this.finishAnimation(),this.animation={frames:u,duration:m,durationFrame:m/u.length,onAnimateEnd:v,startedAt:this.timer}}finishAnimation(){this.animation!==null&&(this.animation.frames[this.animation.frames.length-1](),this.animation.onAnimateEnd!==null&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const u=this.calculateBoundsRect();this.orientation!==u&&(this.orientation=u,this.app.updateOrientation(u))}calculateBoundsRect(){let u="landscape";const m=this.getBlockWidth(),v=m/2,_=this.getBlockHeight()/2,P=this.setting.width/this.setting.height;let R=this.setting.width,M=this.setting.height,I=v-R;return this.setting.size==="stretch"?(m<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(u="portrait"),R=u==="portrait"?this.getBlockWidth():this.getBlockWidth()/2,R>this.setting.maxWidth&&(R=this.setting.maxWidth),M=R/P,M>this.getBlockHeight()&&(M=this.getBlockHeight(),R=M*P),I=u==="portrait"?v-R/2-R:v-R):m<2*R&&this.app.getSettings().usePortrait&&(u="portrait",I=v-R/2-R),this.boundsRect={left:I,top:_-M/2,width:2*R,height:M,pageWidth:R},u}setShadowData(u,m,v,_){if(!this.app.getSettings().drawShadow)return;const P=100*this.getSettings().maxShadowOpacity;this.shadow={pos:u,angle:m,width:3*this.getRect().pageWidth/4*v/100,opacity:(100-v)*P/100/100,direction:_,progress:2*v}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return this.boundsRect===null&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(u){this.pageRect=u}setDirection(u){this.direction=u}setRightPage(u){u!==null&&u.setOrientation(1),this.rightPage=u}setLeftPage(u){u!==null&&u.setOrientation(0),this.leftPage=u}setBottomPage(u){u!==null&&u.setOrientation(this.direction===1?0:1),this.bottomPage=u}setFlippingPage(u){u!==null&&u.setOrientation(this.direction===0&&this.orientation!=="portrait"?0:1),this.flippingPage=u}convertToBook(u){const m=this.getRect();return{x:u.x-m.left,y:u.y-m.top}}isSafari(){return this.safari}convertToPage(u,m){m||(m=this.direction);const v=this.getRect();return{x:m===0?u.x-v.left-v.width/2:v.width/2-u.x+v.left,y:u.y-v.top}}convertToGlobal(u,m){if(m||(m=this.direction),u==null)return null;const v=this.getRect();return{x:m===0?u.x+v.left+v.width/2:v.width/2-u.x+v.left,y:u.y+v.top}}convertRectToGlobal(u,m){return m||(m=this.direction),{topLeft:this.convertToGlobal(u.topLeft,m),topRight:this.convertToGlobal(u.topRight,m),bottomLeft:this.convertToGlobal(u.bottomLeft,m),bottomRight:this.convertToGlobal(u.bottomRight,m)}}}class b extends p{constructor(u,m,v){super(u,m),this.canvas=v,this.ctx=v.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),this.orientation!=="portrait"&&this.leftPage!=null&&this.leftPage.simpleDraw(0),this.rightPage!=null&&this.rightPage.simpleDraw(1),this.bottomPage!=null&&this.bottomPage.draw(),this.drawBookShadow(),this.flippingPage!=null&&this.flippingPage.draw(),this.shadow!=null&&(this.drawOuterShadow(),this.drawInnerShadow());const u=this.getRect();this.orientation==="portrait"&&(this.ctx.beginPath(),this.ctx.rect(u.left+u.pageWidth,u.top,u.width,u.height),this.ctx.clip())}drawBookShadow(){const u=this.getRect();this.ctx.save(),this.ctx.beginPath();const m=u.width/20;this.ctx.rect(u.left,u.top,u.width,u.height);const v={x:u.left+u.width/2-m/2,y:0};this.ctx.translate(v.x,v.y);const _=this.ctx.createLinearGradient(0,0,m,0);_.addColorStop(0,"rgba(0, 0, 0, 0)"),_.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),_.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),_.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),_.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),_.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=_,this.ctx.fillRect(0,0,m,2*u.height),this.ctx.restore()}drawOuterShadow(){const u=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(u.left,u.top,u.width,u.height);const m=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(m.x,m.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const v=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===0?(this.ctx.translate(0,-100),v.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),v.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),v.addColorStop(0,"rgba(0, 0, 0, 0)"),v.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=v,this.ctx.fillRect(0,0,this.shadow.width,2*u.height),this.ctx.restore()}drawInnerShadow(){const u=this.getRect();this.ctx.save(),this.ctx.beginPath();const m=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),v=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(v.topLeft.x,v.topLeft.y),this.ctx.lineTo(v.topRight.x,v.topRight.y),this.ctx.lineTo(v.bottomRight.x,v.bottomRight.y),this.ctx.lineTo(v.bottomLeft.x,v.bottomLeft.y),this.ctx.translate(m.x,m.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const _=3*this.shadow.width/4,P=this.ctx.createLinearGradient(0,0,_,0);this.shadow.direction===0?(this.ctx.translate(-_,-100),P.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),P.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),P.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),P.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),P.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),P.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),P.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),P.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=P,this.ctx.fillRect(0,0,_,2*u.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class S{constructor(u,m,v){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=P=>{if(this.checkTarget(P.target)){const R=this.getMousePos(P.clientX,P.clientY);this.app.startUserTouch(R),P.preventDefault()}},this.onTouchStart=P=>{if(this.checkTarget(P.target)&&P.changedTouches.length>0){const R=P.changedTouches[0],M=this.getMousePos(R.clientX,R.clientY);this.touchPoint={point:M,time:Date.now()},setTimeout(()=>{this.touchPoint!==null&&this.app.startUserTouch(M)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||P.preventDefault()}},this.onMouseUp=P=>{const R=this.getMousePos(P.clientX,P.clientY);this.app.userStop(R)},this.onMouseMove=P=>{const R=this.getMousePos(P.clientX,P.clientY);this.app.userMove(R,!1)},this.onTouchMove=P=>{if(P.changedTouches.length>0){const R=P.changedTouches[0],M=this.getMousePos(R.clientX,R.clientY);this.app.getSettings().mobileScrollSupport?(this.touchPoint!==null&&(Math.abs(this.touchPoint.point.x-M.x)>10||this.app.getState()!=="read")&&P.cancelable&&this.app.userMove(M,!0),this.app.getState()!=="read"&&P.preventDefault()):this.app.userMove(M,!0)}},this.onTouchEnd=P=>{if(P.changedTouches.length>0){const R=P.changedTouches[0],M=this.getMousePos(R.clientX,R.clientY);let I=!1;if(this.touchPoint!==null){const $=M.x-this.touchPoint.point.x,U=Math.abs(M.y-this.touchPoint.point.y);Math.abs($)>this.swipeDistance&&U<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&($>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),I=!0),this.touchPoint=null}this.app.userStop(M,I)}},this.parentElement=u,u.classList.add("stf__parent"),u.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=u.querySelector(".stf__wrapper"),this.app=m;const _=this.app.getSettings().usePortrait?1:2;u.style.minWidth=v.minWidth*_+"px",u.style.minHeight=v.minHeight+"px",v.size==="fixed"&&(u.style.minWidth=v.width*_+"px",u.style.minHeight=v.height+"px"),v.autoSize&&(u.style.width="100%",u.style.maxWidth=2*v.maxWidth+"px"),u.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=v.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(u){this.wrapper.classList.remove("--portrait","--landscape"),u==="portrait"?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(u,m){const v=this.distElement.getBoundingClientRect();return{x:u-v.left,y:m-v.top}}checkTarget(u){return!this.app.getSettings().clickEventForward||!["a","button"].includes(u.tagName.toLowerCase())}}class A extends S{constructor(u,m,v,_){super(u,m,v),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=u.querySelector(".stf__block"),this.items=_;for(const P of _)this.distElement.appendChild(P);this.setHandlers()}clear(){for(const u of this.items)this.parentElement.appendChild(u)}updateItems(u){this.removeHandlers(),this.distElement.innerHTML="";for(const m of u)this.distElement.appendChild(m);this.items=u,this.setHandlers()}update(){this.app.getRender().update()}}class x extends S{constructor(u,m,v){super(u,m,v),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=u.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const u=getComputedStyle(this.canvas),m=parseInt(u.getPropertyValue("width"),10),v=parseInt(u.getPropertyValue("height"),10);this.canvas.width=m,this.canvas.height=v}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class C extends p{constructor(u,m,v){super(u,m),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=v,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",`<div class="stf__outerShadow"></div>
             <div class="stf__innerShadow"></div>
             <div class="stf__hardShadow"></div>
             <div class="stf__hardInnerShadow"></div>`),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const u=this.getRect(),m=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let v=(100-m)*(2.5*u.pageWidth)/100+20;v>u.pageWidth&&(v=u.pageWidth);let _=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${v}px;
            height: ${u.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*m/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${u.left+u.width/2}px;
            transform-origin: 0 0;
        `;_+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=_}drawHardOuterShadow(){const u=this.getRect();let m=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*u.pageWidth)/100+20;m>u.pageWidth&&(m=u.pageWidth);let v=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${m}px;
            height: ${u.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${u.left+u.width/2}px;
            transform-origin: 0 0;
        `;v+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=v}drawInnerShadow(){const u=this.getRect(),m=3*this.shadow.width/4,v=this.getDirection()===0?m:0,_=this.getDirection()===0?"to left":"to right",P=this.convertToGlobal(this.shadow.pos),R=this.shadow.angle+3*Math.PI/2,M=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let I="polygon( ";for(const U of M){let V=this.getDirection()===1?{x:-U.x+this.shadow.pos.x,y:U.y-this.shadow.pos.y}:{x:U.x-this.shadow.pos.x,y:U.y-this.shadow.pos.y};V=o.GetRotatedPoint(V,{x:v,y:100},R),I+=V.x+"px "+V.y+"px, "}I=I.slice(0,-2),I+=")";const $=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${m}px;
            height: ${2*u.height}px;
            background: linear-gradient(${_},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${v}px 100px;
            transform: translate3d(${P.x-v}px, ${P.y-100}px, 0) rotate(${R}rad);
            clip-path: ${I};
            -webkit-clip-path: ${I};
        `;this.innerShadow.style.cssText=$}drawOuterShadow(){const u=this.getRect(),m=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),v=this.shadow.angle+3*Math.PI/2,_=this.getDirection()===1?this.shadow.width:0,P=this.getDirection()===0?"to right":"to left",R=[{x:0,y:0},{x:u.pageWidth,y:0},{x:u.pageWidth,y:u.height},{x:0,y:u.height}];let M="polygon( ";for(const $ of R)if($!==null){let U=this.getDirection()===1?{x:-$.x+this.shadow.pos.x,y:$.y-this.shadow.pos.y}:{x:$.x-this.shadow.pos.x,y:$.y-this.shadow.pos.y};U=o.GetRotatedPoint(U,{x:_,y:100},v),M+=U.x+"px "+U.y+"px, "}M=M.slice(0,-2),M+=")";const I=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*u.height}px;
            background: linear-gradient(${P}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${_}px 100px;
            transform: translate3d(${m.x-_}px, ${m.y-100}px, 0) rotate(${v}rad);
            clip-path: ${M};
            -webkit-clip-path: ${M};
        `;this.outerShadow.style.cssText=I}drawLeftPage(){this.orientation!=="portrait"&&this.leftPage!==null&&(this.direction===1&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){this.rightPage!==null&&(this.direction===0&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(this.bottomPage===null)return;const u=this.flippingPage!=null?this.flippingPage.getDrawingDensity():null;this.orientation==="portrait"&&this.direction===1||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(u))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),this.flippingPage!=null&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),this.shadow!=null&&this.flippingPage!==null&&(this.flippingPage.getDrawingDensity()==="soft"?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const u of this.app.getPageCollection().getPages())u!==this.leftPage&&u!==this.rightPage&&u!==this.flippingPage&&u!==this.bottomPage&&(u.getElement().style.cssText="display: none"),u.getTemporaryCopy()!==this.flippingPage&&u.hideTemporaryCopy()}update(){super.update(),this.rightPage!==null&&this.rightPage.setOrientation(1),this.leftPage!==null&&this.leftPage.setOrientation(0)}}class T{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(u){const m=this._default;if(Object.assign(m,u),m.size!=="stretch"&&m.size!=="fixed")throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(m.width<=0||m.height<=0)throw new Error("Invalid width or height");if(m.flippingTime<=0)throw new Error("Invalid flipping time");return m.size==="stretch"?(m.minWidth<=0&&(m.minWidth=100),m.maxWidth<m.minWidth&&(m.maxWidth=2e3),m.minHeight<=0&&(m.minHeight=100),m.maxHeight<m.minHeight&&(m.maxHeight=2e3)):(m.minWidth=m.width,m.maxWidth=m.width,m.minHeight=m.height,m.maxHeight=m.height),m}}(function(E,u){u===void 0&&(u={});var m=u.insertAt;if(typeof document<"u"){var v=document.head||document.getElementsByTagName("head")[0],_=document.createElement("style");_.type="text/css",m==="top"&&v.firstChild?v.insertBefore(_,v.firstChild):v.appendChild(_),_.styleSheet?_.styleSheet.cssText=E:_.appendChild(document.createTextNode(E))}})(`.stf__parent {
  position: relative;
  display: block;
  box-sizing: border-box;
  transform: translateZ(0);

  -ms-touch-action: pan-y;
  touch-action: pan-y;
}

.sft__wrapper {
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.stf__parent canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}

.stf__block {
  position: absolute;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  perspective: 2000px;
}

.stf__item {
  display: none;
  position: absolute;
  transform-style: preserve-3d;
}

.stf__outerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__innerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardInnerShadow {
  position: absolute;
  left: 0;
  top: 0;
}`),e.PageFlip=class extends class{constructor(){this.events=new Map}on(E,u){return this.events.has(E)?this.events.get(E).push(u):this.events.set(E,[u]),this}off(E){this.events.delete(E)}trigger(E,u,m=null){if(this.events.has(E))for(const v of this.events.get(E))v({data:m,object:u})}}{constructor(E,u){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=new T().getSettings(u),this.block=E}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(E){this.ui=new x(this.block,this,this.setting);const u=this.ui.getCanvas();this.render=new b(this,this.setting,u),this.flipController=new f(this.render,this),this.pages=new a(this,this.render,E),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(E){this.ui=new A(this.block,this,this.setting,E),this.render=new C(this,this.setting,this.ui.getDistElement()),this.flipController=new f(this.render,this),this.pages=new l(this,this.render,this.ui.getDistElement(),E),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(E){const u=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new a(this,this.render,E),this.pages.load(),this.pages.show(u),this.trigger("update",this,{page:u,mode:this.render.getOrientation()})}updateFromHtml(E){const u=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new l(this,this.render,this.ui.getDistElement(),E),this.pages.load(),this.ui.updateItems(E),this.render.reload(),this.pages.show(u),this.trigger("update",this,{page:u,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(E){this.pages.show(E)}flipNext(E="top"){this.flipController.flipNext(E)}flipPrev(E="top"){this.flipController.flipPrev(E)}flip(E,u="top"){this.flipController.flipToPage(E,u)}updateState(E){this.trigger("changeState",this,E)}updatePageIndex(E){this.trigger("flip",this,E)}updateOrientation(E){this.ui.setOrientationStyle(E),this.update(),this.trigger("changeOrientation",this,E)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(E){return this.pages.getPage(E)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(E){this.mousePosition=E,this.isUserTouch=!0,this.isUserMove=!1}userMove(E,u){this.isUserTouch||u||!this.setting.showPageCorners?this.isUserTouch&&o.GetDistanceBetweenTwoPoint(this.mousePosition,E)>5&&(this.isUserMove=!0,this.flipController.fold(E)):this.flipController.showCorner(E)}userStop(E,u=!1){this.isUserTouch&&(this.isUserTouch=!1,u||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(E)))}},Object.defineProperty(e,"__esModule",{value:!0})})}(fo,fo.exports)),fo.exports}var sb=eb();const Hu="i will paste the svg string after analyzing the code",$u="i will paste the svg string after analyzing the code",ib="i will paste the svg string after analyzing the code",nb="i will paste the svg string after analyzing the code",rb="i will paste the svg string after analyzing the code";document.addEventListener("DOMContentLoaded",()=>{try{document.body.style.visibility="visible",document.body.style.opacity="1"}catch(d){console.error("Error setting body visibility:",d)}});try{Zm.workerSrc="/Portofoliu-FurduNicole/assets/pdfjs/pdf.worker.mjs"}catch(d){console.error("Error setting PDF worker source:",d)}function Qp(){try{const d=document.querySelector(".pdf-container");if(d){d.classList.remove("active"),d.style.removeProperty("visibility"),d.style.removeProperty("opacity"),d.style.removeProperty("pointer-events");const t=document.getElementById("flipbook");t&&(t.innerHTML="")}}catch(d){console.error("Error in hideAllPdfContainers:",d)}}function Zp(){try{const d=document.querySelector(".interactive-container");d&&(d.classList.remove("active"),d.style.removeProperty("visibility"),d.style.removeProperty("opacity"),d.style.removeProperty("pointer-events"),d.innerHTML="")}catch(d){console.error("Error in hideAllSvgContainers:",d)}}function Jp(){try{const t=new DOMParser().parseFromString(Hu,"image/svg+xml");if(t.querySelector("parsererror"))throw new Error("SVG parsing error");const e=document.querySelector("#loading-spinner");if(!e)throw new Error("Loading spinner element not found");e.innerHTML="",e.appendChild(t.documentElement),t.documentElement&&tg(t.documentElement)}catch(d){console.error("Error inserting loading SVG:",d)}}const Gl=document.getElementById("loading-spinner");Gl?Gl.querySelectorAll('[id^="loading"]'):console.error("SVG loading spinner not found!");function tg(d){try{let t=function(){try{if(s<e.length){const i=e[s];if(!i)throw new Error(`Loading element at index ${s} not found`);i.style.transition="opacity 0.5s ease",i.style.opacity="1",s++,setTimeout(t,500)}}catch(i){console.error("Error in loading animation step:",i)}};if(!d)throw new Error("SVG element is null in startLoadingAnimation");const e=d.querySelectorAll('[id^="loading"]');if(!e.length)throw new Error("No loading elements found in SVG");let s=0;t()}catch(t){console.error("Error in startLoadingAnimation:",t)}}function ru(){try{const d=document.getElementById("loading-spinner");if(!d)throw new Error("Loading spinner not found");const t=d.querySelector("svg");if(!t)throw new Error("SVG element not found in loading spinner");t.querySelectorAll('[id^="loading"]').forEach(s=>{try{s.style.opacity="0",s.style.transition="opacity 0.5s"}catch(i){console.error("Error resetting loading element:",i)}})}catch(d){console.error("Error in resetLoadingAnimation:",d)}}function ab(d,t,e){try{const i=new DOMParser().parseFromString(d,"image/svg+xml");if(i.querySelector("parsererror"))throw new Error("SVG parsing error");const n=document.querySelector(t);if(!n)throw new Error(`Container ${t} not found`);n.innerHTML="";const a=i.documentElement;n.appendChild(a),e&&e(a)}catch(s){console.error("Error inserting SVG:",s)}}function ob(d){try{[{layer:"HARD-SKILLS",buttonId:"Pana_roz_button1",textId:"text1"},{layer:"PROFESSIONAL",buttonId:"Pana_roz_button2",textId:"text2"},{layer:"CV",buttonId:"Pana_roz_button3",textId:"text3"},{layer:"ACADEMIC",buttonId:"Pana_roz_button4",textId:"text4"},{layer:"SOFT-SKILLS",buttonId:"Pana_roz_button5",textId:"text5"}].forEach(e=>{try{const s=d.querySelector(`#${e.layer}`);if(!s)throw new Error(`Layer group ${e.layer} not found`);const i=s.querySelector(`[id^="${e.buttonId}"]`),n=s.querySelector(`#${e.textId}`);if(!i||!n)throw new Error(`Elements not found for target: ${JSON.stringify(e)}`);const a=i.getAttribute("fill")||getComputedStyle(i).fill,o=n.getAttribute("fill")||getComputedStyle(n).fill,h=n.style.fontWeight||"",l=n.style.fontFamily||"";let c=0;const f=()=>{i.style.transition="fill 0.3s ease",i.style.fill="#e3125f",n.style.transition="fill 0.3s ease",n.style.fill="#ffca31",n.style.fontFamily="Segoe UI",n.style.fontWeight="bold"},p=()=>{i.style.fill=a,n.style.fill=o,n.style.fontWeight=h,n.style.fontFamily=l},b=()=>{c++,c===1&&f()},S=()=>{c--,c===0&&p()};i.addEventListener("mouseenter",b),i.addEventListener("mouseleave",S),n.addEventListener("mouseenter",b),n.addEventListener("mouseleave",S),n.addEventListener("click",A=>{A.stopPropagation(),i.dispatchEvent(new Event("click",{bubbles:!0}))})}catch(s){console.error("Error setting up hover effects for target:",e,s)}})}catch(t){console.error("Error in addHoverEffects:",t)}}function hb(d){try{[{layer:"HARD-SKILLS",id:"Pana_roz_button1",action:()=>{try{xc("hard-skills",d),Xa(d)}catch(e){console.error("Error in button1 action:",e)}}},{layer:"PROFESSIONAL",id:"Pana_roz_button2",action:()=>{try{Gu("professional.pdf",d),Xa(d)}catch(e){console.error("Error in button2 action:",e)}}},{layer:"CV",id:"Pana_roz_button3",action:()=>{try{xc("cv",d),Xa(d)}catch(e){console.error("Error in button3 action:",e)}}},{layer:"ACADEMIC",id:"Pana_roz_button4",action:()=>{try{Gu("academic.pdf",d),Xa(d)}catch(e){console.error("Error in button4 action:",e)}}},{layer:"SOFT-SKILLS",id:"Pana_roz_button5",action:()=>{try{xc("soft-skills",d),Xa(d)}catch(e){console.error("Error in button5 action:",e)}}},{layer:null,id:"HOME-BUTTON",action:()=>{try{lb(d)}catch(e){console.error("Error in HOME-BUTTON action:",e)}}}].forEach(e=>{try{let s;if(e.layer){const i=d.querySelector(`#${e.layer}`);if(!i)throw new Error(`Layer group ${e.layer} not found`);s=i.querySelector(`[id^="${e.id}"]`)}else s=d.querySelector(`#${e.id}`);if(!s)throw new Error(`Button with ID ${e.id} not found in the SVG.`);s.style.cursor="pointer",s.addEventListener("click",e.action)}catch(s){console.error(`Error setting up button ${e.id}:`,s)}})}catch(t){console.error("Error in attachButtonEvents:",t)}}function lb(d){try{console.log("Home button clicked. Hiding containers, reversing fog, and performing soft reset..."),Zp(),Qp(),cb(d,()=>{try{console.log("Reverse fog effect completed. Performing soft reset...");const t=document.getElementById("content-container");t&&(t.innerHTML="");const e=document.getElementById("loading-overlay");e&&(e.style.visibility="hidden",e.style.opacity="0"),console.log("Soft reset completed. Reloading the page..."),setTimeout(()=>{try{location.reload()}catch(s){console.error("Error reloading page:",s)}},500)}catch(t){console.error("Error in reverse fog callback:",t)}})}catch(t){console.error("Error in handleHomeButtonClick:",t)}}function au(){try{const d=document.getElementById("loading-overlay");if(!d)throw new Error("Loading overlay element not found");d.style.visibility="visible",d.style.opacity="1"}catch(d){console.error("Error in showLoadingOverlay:",d)}}function di(){try{const d=document.getElementById("loading-overlay");if(!d)throw new Error("Loading overlay element not found");d.style.opacity="0",setTimeout(()=>{try{d.style.visibility="hidden"}catch(t){console.error("Error in hideLoadingOverlay timeout:",t)}},300)}catch(d){console.error("Error in hideLoadingOverlay:",d)}}function Xa(d){try{const t=d.querySelectorAll('[id^="blockcolor"]');if(!t.length)throw new Error("No fog layers found");t.forEach((e,s)=>{try{const i=e.querySelector("g");if(!i)throw new Error("Group element not found in fog layer");const n=s*250;setTimeout(()=>{try{i.style.transition="opacity 1s ease",i.style.opacity="0.35"}catch(a){console.error("Error setting fog layer opacity:",a)}},n)}catch(i){console.error("Error processing fog layer:",i)}})}catch(t){console.error("Error in triggerFogEffect:",t)}}function cb(d,t){try{au(),ru();const e=document.getElementById("loading-spinner");if(e){const n=e.querySelector("svg");n&&tg(n)}const s=Array.from(d.querySelectorAll('[id^="blockcolor"]')).reverse();if(!s.length)throw new Error("No fog layers found for reversal");let i=0;s.forEach((n,a)=>{try{const o=n.querySelector("g");if(!o)throw new Error("Group element not found in fog layer");const h=a*250;setTimeout(()=>{try{o.style.transition="opacity 1s ease",o.style.opacity="0",i++,i===s.length&&(di(),t&&t())}catch(l){console.error("Error in fog layer reversal:",l)}},h)}catch(o){console.error("Error processing fog layer for reversal:",o)}})}catch(e){console.error("Error in reverseFogEffect:",e)}}async function Gu(d){try{let t=function(h){const l=Math.floor(h*a);n.forEach((c,f)=>{c.style.opacity=f<l?"1":"0"})};const e=document.querySelector(".pdf-container"),s=document.getElementById("flipbook");if(!e||!s)throw new Error("PDF container or flipbook not found");Zp(),au();const i=document.getElementById("loading-spinner");i&&!i.querySelector("svg")&&Jp(),ru();const n=Gl?Gl.querySelectorAll('[id^="loading"]'):[],a=n.length;let o=0;try{s.innerHTML="";const h=`/Portofoliu-FurduNicole/pdfs/${d}`,c=await Jm(h).promise,f=c.numPages,p=Math.max(100,1e3/Math.max(f,a)),b=[];for(let S=1;S<=f;S++)try{const A=await c.getPage(S),x=A.getViewport({scale:1.5}),C=document.createElement("canvas");C.width=x.width,C.height=x.height,await A.render({canvasContext:C.getContext("2d"),viewport:x}).promise,b.push(C.toDataURL()),t(S/f),await new Promise(T=>setTimeout(T,p))}catch(A){console.error(`Error rendering page ${S}:`,A)}b.forEach(S=>{try{const A=document.createElement("div");A.className="page";const x=document.createElement("img");x.src=S,x.style.width="100%",x.style.height="100%",A.appendChild(x),s.appendChild(A)}catch(A){console.error("Error creating page element:",A)}}),setTimeout(()=>{try{e.classList.add("active"),di()}catch(S){console.error("Error finalizing PDF display:",S)}},100);try{let S,A;window.innerWidth<700?(S=Math.max(window.innerWidth*.95,320),A=Math.max(window.innerHeight*.65,400)):(S=710,A=1100),new sb.PageFlip(s,{size:"fixed",width:S,height:A,maxShadowOpacity:.5,showCover:!1,mobileScrollSupport:!0}).loadFromHTML(document.querySelectorAll("#flipbook .page"))}catch(S){console.error("Error initializing PageFlip:",S)}}catch(h){console.error("Error loading or rendering PDF:",h),di()}}catch(t){console.error("Error in showPDF:",t),di()}}async function xc(d,t){const e=document.querySelector(".interactive-container");if(!e){di();return}Qp(),au();const s=document.getElementById("loading-spinner");s&&!s.querySelector("svg")&&Jp(),ru();const i=s==null?void 0:s.querySelector("svg"),n=i?i.querySelectorAll('[id^="loading"]'):[],a=n.length;let o=0,h;switch(d){case"hard-skills":h=ib;break;case"cv":h=nb;break;case"soft-skills":h=rb;break;default:di();return}if(!h){di();return}const c=new DOMParser().parseFromString(h,"image/svg+xml");if(c.querySelector("parsererror")){di();return}const f=c.documentElement,p=f.querySelectorAll("g, path"),b=Math.max(p.length,1),S=Math.max(100,1e3/Math.max(b,a));for(let A=0;A<b;A++)o<a&&(n[o].style.opacity="1",o++),await new Promise(x=>setTimeout(x,S));for(;o<a;)n[o].style.opacity="1",o++,await new Promise(A=>setTimeout(A,S));await new Promise(A=>setTimeout(A,500)),e.innerHTML="",e.appendChild(f),e.classList.add("active"),e.style.visibility="visible",e.style.opacity="1",di()}function db(){try{document.addEventListener("mousemove",d=>{try{const t=d.clientX,e=d.clientY;document.querySelectorAll('[id*="Pana_roz_degrade"], [id*="Pana_roz_opac"], [id*="Pana_gri_opac"], #HARD-SKILLS, #PROFESSIONAL, #CV, #ACADEMIC, #SOFT-SKILLS, #HOME-BUTTON').forEach(i=>{try{const n=i.getBoundingClientRect(),a=t>=n.left&&t<=n.right&&e>=n.top&&e<=n.bottom;i.style.transition="transform 0.3s ease",i.id==="HOME-BUTTON"?i.style.transform=a?"translateY(5px)":"translateY(0px)":i.style.transform=a?"translateY(30px)":"translateY(0px) scale(1)"}catch(n){console.error("Error processing hover effect for element:",i,n)}})}catch(t){console.error("Error in mousemove handler:",t)}})}catch(d){console.error("Error in addHoverEffectToMainElements:",d)}}let zu,tl=!1,Wd,zl=!0;const Ud=5e3,Wu=400;function ub(d){const t=d.match(/(\d+)_(\d+)$/);return t?{col:parseInt(t[1],10),row:parseInt(t[2],10)}:{col:0,row:0}}function Vd(){if(window.innerWidth<700&&document.body.classList.contains("no-wave")||tl)return;if(tl=!0,window.innerWidth<700){const n=Array.from(document.querySelectorAll('[id*="Pana_roz_degrade"], [id*="Pana_roz_opac"], [id*="Pana_gri_opac"]')),a=Math.floor(Math.random()*6)+8;n.sort(()=>Math.random()-.5).slice(0,a).forEach((l,c)=>{setTimeout(()=>{l.style.transition="transform 1s cubic-bezier(.4,1.4,.4,1)",l.style.transform="translateY(50px)",setTimeout(()=>{l.style.transition="transform 0.7s cubic-bezier(.4,1.4,.4,1)",l.style.transform="translateY(0px)"},350)},c*80)}),setTimeout(()=>{tl=!1,zl||(Wd=setTimeout(Vd,Ud))},a*60+400);return}const t=Array.from(document.querySelectorAll('[id*="Pana_roz_degrade"], [id*="Pana_roz_opac"], [id*="Pana_gri_opac"]')).map(n=>{const{col:a,row:o}=ub(n.id);return{el:n,col:a,row:o}}),e={};t.forEach(({el:n,col:a,row:o})=>{const h=a+o;e[h]||(e[h]=[]),e[h].push(n)});const s=Object.keys(e).map(Number).sort((n,a)=>n-a);s.forEach((n,a)=>{e[n].forEach((o,h)=>{setTimeout(()=>{o.style.transition="transform 0.7s cubic-bezier(.4,1.6,.4,1)",o.style.transform="translateY(30px)",setTimeout(()=>{o.style.transition="transform 0.7s cubic-bezier(.4,1.6,.4,1)",o.style.transform="translateY(0px)"},Wu+120)},a*120+h*10)})});const i=s.length*120+Wu+400;setTimeout(()=>{tl=!1,zl||(Wd=setTimeout(Vd,Ud))},i)}function ou(){zl=!0,clearTimeout(zu),clearTimeout(Wd),zu=setTimeout(()=>{zl=!1,Vd()},Ud)}["mousemove","mousedown","keydown","touchstart","scroll"].forEach(d=>window.addEventListener(d,ou,{passive:!0}));document.addEventListener("mouseover",d=>{d.target.matches('[id*="Pana_roz_degrade"], [id*="Pana_roz_opac"], [id*="Pana_gri_opac"]')&&ou()});ou();window.onload=function(){try{$u&&ab($u,".svg1",d=>{try{ob(d),hb(d),db()}catch(t){console.error("Error in SVG initialization callback:",t)}})}catch(d){console.error("Error in window.onload:",d)}};
